import{c as Re,r,j as e,m as I,u as G,a as W,L as $,A as F,U as J,H as pe,W as Z,S as fe,M as ne,b as le,d as Ie,Z as Ae,e as de,f as oe,g as Le,X as D,h as ge,i as re,k as be,T as $e,l as V,C as X,n as ve,B as je,P as De,o as Fe,p as we,q as Oe,s as ee,t as qe,v as Ue,w as We,x as Be,y as Q,z as he,D as ae,E as ye,F as Ne,I as He,G as Ve,J as Ge,K as Ye,N as Ke,O as Xe,Q as Je,R as Ze,V as Qe,Y as et,_ as tt,$ as st,a0 as rt,a1 as at,a2 as it,a3 as nt,a4 as A,a5 as ke,a6 as lt}from"./vendor-BnQ2wVNY.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))l(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const x of a.addedNodes)x.tagName==="LINK"&&x.rel==="modulepreload"&&l(x)}).observe(document,{childList:!0,subtree:!0});function c(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function l(s){if(s.ep)return;s.ep=!0;const a=c(s);fetch(s.href,a)}})();const ot="https://bvmcchnxpcvifcblbisa.supabase.co",ct="sb_publishable_lfQTIS91bkBxwjrVzI-x6w_JE45Bmzg",w=Re(ot,ct),_e=r.createContext({}),O=()=>r.useContext(_e),dt=({children:t})=>{const[n,c]=r.useState(null),[l,s]=r.useState(!0);r.useEffect(()=>{(async()=>{const{data:{session:h}}=await w.auth.getSession();c(h?.user??null),s(!1)})();const{data:{subscription:y}}=w.auth.onAuthStateChange((h,j)=>{c(j?.user??null),s(!1)});return()=>y.unsubscribe()},[]);const a=async()=>{await w.auth.signOut()};return e.jsx(_e.Provider,{value:{user:n,loading:l,signOut:a},children:!l&&t})},Ce=r.createContext(),ht=({children:t})=>{const[n,c]=r.useState([]),l=a=>{c(x=>[...x,a])},s=a=>{c(x=>x.filter(y=>y.id!==a))};return e.jsx(Ce.Provider,{value:{cartItems:n,addToCart:l,removeFromCart:s},children:t})},xt=()=>r.useContext(Ce),Se=r.createContext(),ut=({children:t})=>{const[n,c]=r.useState(new Set),[l,s]=r.useState(!1),[a,x]=r.useState(!1),[y,h]=r.useState(!0),j=()=>s(!0),m=()=>s(!1),f=()=>x(P=>!P),S=()=>x(!0),b=()=>x(!1),o=P=>{c(C=>{const k=new Set(C);return k.add(P),k})},u=P=>{c(C=>{const k=new Set(C);return k.delete(P),k})};return e.jsx(Se.Provider,{value:{isAuthModalOpen:l,openAuthModal:j,closeAuthModal:m,isChatOpen:a,toggleChat:f,openChat:S,closeChat:b,unreadCount:n.size,unreadSenders:n,addUnreadSender:o,removeUnreadSender:u,isSidebarCollapsed:y,setIsSidebarCollapsed:h},children:t})},B=()=>{const t=r.useContext(Se);if(!t)throw new Error("useUI must be used within a UIProvider");return t},te=({className:t="w-10 h-10"})=>e.jsxs("svg",{viewBox:"0 0 100 100",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:t,children:[e.jsx("path",{d:"M 80 30 C 70 10, 30 10, 20 50 C 10 90, 70 90, 80 70",stroke:"white",strokeWidth:"4",strokeLinecap:"round"}),e.jsx("circle",{cx:"80",cy:"30",r:"6",fill:"white"}),e.jsx("circle",{cx:"20",cy:"50",r:"6",fill:"white"}),e.jsx("circle",{cx:"80",cy:"70",r:"6",fill:"white"}),e.jsx("line",{x1:"80",y1:"30",x2:"50",y2:"20",stroke:"white",strokeWidth:"2",opacity:"0.5"}),e.jsx("line",{x1:"50",y1:"20",x2:"20",y2:"50",stroke:"white",strokeWidth:"2",opacity:"0.5"}),e.jsx("line",{x1:"20",y1:"50",x2:"50",y2:"80",stroke:"white",strokeWidth:"2",opacity:"0.5"}),e.jsx("line",{x1:"50",y1:"80",x2:"80",y2:"70",stroke:"white",strokeWidth:"2",opacity:"0.5"}),e.jsx("circle",{cx:"50",cy:"20",r:"4",fill:"white"}),e.jsx("circle",{cx:"50",cy:"80",r:"4",fill:"white"})]}),xe=({children:t})=>{const n=r.useRef(null),[c,l]=r.useState({x:0,y:0}),s=h=>{const{clientX:j,clientY:m}=h,{height:f,width:S,left:b,top:o}=n.current.getBoundingClientRect(),u=j-(b+S/2),P=m-(o+f/2);l({x:u*.3,y:P*.3})},a=()=>{l({x:0,y:0})},{x,y}=c;return e.jsx(I.div,{ref:n,className:"magnetic-wrap inline-block",onMouseMove:s,onMouseLeave:a,animate:{x,y},transition:{type:"spring",stiffness:150,damping:15,mass:.1},children:t})},mt=[{name:"Home",path:"/",icon:e.jsx(pe,{size:20})},{name:"Market",path:"/market",icon:e.jsx(fe,{size:20})},{name:"Services",path:"/services",isPopup:!0,icon:e.jsx(Z,{size:20})},{name:"Forum",path:"/forum",icon:e.jsx(le,{size:20})},{name:"Social",path:"/connections",icon:e.jsx(Ie,{size:20})},{name:"Chat",path:"/messages",icon:e.jsx(ne,{size:20}),isMessages:!0}],pt=()=>{const{user:t}=O(),{openAuthModal:n,unreadCount:c}=B(),l=G(),s=W(),[a,x]=r.useState(!1),[y,h]=r.useState(!1),j=()=>{t?s("/profile"):n()};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden md:flex fixed top-6 left-0 right-0 justify-center z-50 pointer-events-none",children:e.jsx(I.div,{className:"pointer-events-auto bg-black/80 backdrop-blur-xl border border-white/10 rounded-full shadow-2xl overflow-hidden",initial:{height:60,padding:"0px 24px"},animate:{height:y?80:60,width:"auto"},onHoverStart:()=>h(!0),onHoverEnd:()=>h(!1),transition:{type:"spring",stiffness:300,damping:25},children:e.jsxs("div",{className:"flex items-center gap-2 h-full",children:[e.jsx($,{to:"/",className:"mr-4 flex items-center gap-2",children:e.jsx("div",{className:"scale-75",children:e.jsx(te,{})})}),e.jsx("div",{className:"h-6 w-[1px] bg-white/10 mx-1"}),mt.map(m=>{const f=l.pathname===m.path;return m.isPopup?e.jsxs("button",{onClick:()=>x(!0),className:`relative group flex flex-col items-center justify-center w-16 h-full transition-colors ${a?"text-accent":"text-gray-400 hover:text-white"}`,children:[e.jsx("div",{className:"relative z-10 p-2",children:m.icon}),e.jsx(F,{children:y&&e.jsx(I.span,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"text-[10px] font-medium mt-1 whitespace-nowrap",children:m.name})})]},m.name):e.jsxs($,{to:m.path,className:`relative group flex flex-col items-center justify-center w-16 h-full transition-colors ${f?"text-accent":"text-gray-400 hover:text-white"}`,children:[e.jsxs("div",{className:"relative z-10 p-2",children:[m.icon,m.isMessages&&c>0&&e.jsx("div",{className:"absolute top-1 right-1 w-2.5 h-2.5 bg-red-500 rounded-full border border-black"})]}),e.jsx(F,{children:y&&e.jsx(I.span,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"text-[10px] font-medium mt-1 whitespace-nowrap",children:m.name})}),f&&!y&&e.jsx(I.div,{layoutId:"navDot",className:"absolute bottom-2 w-1 h-1 bg-accent rounded-full"})]},m.name)})]})})}),e.jsx("div",{className:"hidden md:block fixed top-6 right-6 z-50",children:e.jsxs("button",{onClick:j,className:"flex items-center gap-3 bg-black/50 backdrop-blur-md border border-white/10 pl-1 pr-4 py-1 rounded-full hover:bg-black/70 transition-all hover:border-white/30 group",children:[e.jsx("div",{className:"w-9 h-9 rounded-full bg-gray-700 overflow-hidden border border-white/20 relative group-hover:scale-105 transition-transform",children:t?.user_metadata?.avatar_url?e.jsx("img",{src:t.user_metadata.avatar_url,alt:"",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-xs font-bold text-white",children:t?.user_metadata?.first_name?t.user_metadata.first_name[0]:e.jsx(J,{size:16})})}),e.jsx("div",{className:"text-left",children:t?e.jsx("p",{className:"text-xs font-bold text-white group-hover:text-accent transition-colors",children:t.user_metadata?.first_name}):e.jsx("p",{className:"text-xs font-bold text-white group-hover:text-accent transition-colors",children:"Sign In"})})]})}),e.jsx("div",{className:"md:hidden fixed bottom-0 left-0 right-0 bg-black/95 backdrop-blur-xl border-t border-white/10 z-[70] safe-area-bottom pb-safe",children:e.jsxs("div",{className:"flex items-center justify-around py-2 px-2",children:[e.jsxs($,{to:"/",className:`flex flex-col items-center gap-1 py-1.5 px-3 rounded-xl transition-all ${l.pathname==="/"?"text-accent":"text-white/50"}`,children:[e.jsx(pe,{size:22}),e.jsx("span",{className:"text-[10px] font-medium",children:"Home"})]}),e.jsxs("button",{onClick:()=>x(!0),className:`flex flex-col items-center gap-1 py-1.5 px-3 rounded-xl transition-all ${a?"text-accent":"text-white/50"}`,children:[e.jsx(Z,{size:22}),e.jsx("span",{className:"text-[10px] font-medium",children:"Services"})]}),e.jsxs($,{to:"/market",className:`flex flex-col items-center gap-1 py-1.5 px-3 rounded-xl transition-all ${l.pathname==="/market"?"text-accent":"text-white/50"}`,children:[e.jsx(fe,{size:22}),e.jsx("span",{className:"text-[10px] font-medium",children:"Market"})]}),e.jsxs($,{to:"/messages",className:`flex flex-col items-center gap-1 py-1.5 px-3 rounded-xl transition-all relative ${l.pathname==="/messages"?"text-accent":"text-white/50"}`,children:[e.jsxs("div",{className:"relative",children:[e.jsx(ne,{size:22}),c>0&&e.jsx("div",{className:"absolute -top-1 -right-1.5 w-4 h-4 bg-red-500 rounded-full flex items-center justify-center border border-black",children:e.jsx("span",{className:"text-[8px] font-bold text-white",children:c})})]}),e.jsx("span",{className:"text-[10px] font-medium",children:"Chat"})]}),e.jsxs("button",{onClick:j,className:`flex flex-col items-center gap-1 py-1 px-3 rounded-xl relative ${l.pathname==="/profile"?"text-accent":"text-white/50"}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-full overflow-hidden border-2 transition-all ${l.pathname==="/profile"?"border-accent scale-110":"border-white/20"}`,children:t?.user_metadata?.avatar_url?e.jsx("img",{src:t.user_metadata.avatar_url,alt:"",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-gray-700 flex items-center justify-center text-xs text-white",children:e.jsx(J,{size:14})})}),e.jsx("span",{className:"text-[10px] font-medium",children:"Profile"})]})]})}),e.jsx(F,{children:a&&e.jsxs(e.Fragment,{children:[e.jsx(I.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>x(!1),className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-[80]"}),e.jsxs(I.div,{initial:{y:"100%"},animate:{y:0},exit:{y:"100%"},transition:{type:"spring",stiffness:300,damping:30},className:"fixed bottom-0 left-0 right-0 md:left-1/2 md:right-auto md:-translate-x-1/2 md:w-[400px] md:bottom-24 md:rounded-3xl z-[90] bg-[#1a1a1a] border border-white/10 rounded-t-3xl p-6 pb-safe safe-area-bottom shadow-2xl",children:[e.jsx("div",{className:"w-12 h-1 bg-white/20 rounded-full mx-auto mb-6 md:hidden"}),e.jsx("h3",{className:"text-xl font-bold text-white mb-6 text-center font-display",children:"Where to go?"}),e.jsxs("div",{className:"grid gap-3",children:[e.jsxs($,{to:"/services",onClick:()=>x(!1),className:"flex items-center gap-4 p-4 rounded-2xl bg-white/5 hover:bg-white/10 active:scale-95 transition-all border border-white/5",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-blue-500/20 flex items-center justify-center text-blue-400",children:e.jsx(Z,{size:24})}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsx("h4",{className:"font-bold text-white",children:"Marketplace Services"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Freelancing & Gigs"})]})]}),e.jsxs($,{to:"/forum",onClick:()=>x(!1),className:"flex items-center gap-4 p-4 rounded-2xl bg-white/5 hover:bg-white/10 active:scale-95 transition-all border border-white/5",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-purple-500/20 flex items-center justify-center text-purple-400",children:e.jsx(le,{size:24})}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsx("h4",{className:"font-bold text-white",children:"Community Forum"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Posts & Discussions"})]})]})]}),e.jsx("button",{onClick:()=>x(!1),className:"mt-6 w-full py-4 text-center text-gray-500 font-medium hover:text-white transition-colors",children:"Cancel"})]})]})})]})},ft=()=>{const t=r.useRef(null),n=r.useRef(null),c=G(),l=r.useRef({x:0,y:0}),s=r.useRef({x:0,y:0}),[a,x]=r.useState(!1),[y,h]=r.useState(!1),[j,m]=r.useState(!1),[f,S]=r.useState(!1);r.useEffect(()=>{S(window.matchMedia("(pointer: coarse)").matches)},[]);const b=.15;return r.useEffect(()=>{const P=C=>{const k=C.target.closest('a, button, [role="button"], input[type="submit"], .clickable');m(!!k)};return document.addEventListener("mouseover",P),()=>document.removeEventListener("mouseover",P)},[c]),r.useEffect(()=>{let P;const C=g=>{x(!1),l.current={x:g.clientX,y:g.clientY},t.current&&(t.current.style.transform=`translate(${g.clientX-4}px, ${g.clientY-4}px)`),Math.random()>.7&&_(g.clientX,g.clientY)},k=()=>h(!0),E=()=>h(!1),d=()=>x(!1),p=g=>{g.relatedTarget===null&&x(!0)},_=(g,i)=>{if(!document.body)return;const v=document.createElement("div"),z=Math.random()*4+2,R=j?"polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%)":"polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%)",T=Math.random()*360;Object.assign(v.style,{position:"fixed",left:"0",top:"0",width:`${z}px`,height:`${z}px`,backgroundColor:"white",clipPath:R,pointerEvents:"none",zIndex:9998,transform:`translate(${g}px, ${i}px) rotate(${T}deg)`,opacity:.6,transition:"transform 0.6s ease-out, opacity 0.6s ease-out",willChange:"transform, opacity"}),document.body.appendChild(v);const q=(Math.random()-.5)*60,Y=(Math.random()-.5)*60;requestAnimationFrame(()=>{v&&(v.style.transform=`translate(${g-q}px, ${i-Y}px) rotate(${T+180}deg) scale(0)`,v.style.opacity=0)}),setTimeout(()=>{v&&v.parentNode&&v.remove()},600)},N=()=>{n.current&&(s.current.x+=(l.current.x-s.current.x)*b,s.current.y+=(l.current.y-s.current.y)*b,n.current.style.transform=`translate(${s.current.x-20}px, ${s.current.y-20}px)`,P=requestAnimationFrame(N))};return N(),document.addEventListener("mousemove",C),document.addEventListener("mousedown",k),document.addEventListener("mouseup",E),document.addEventListener("mouseenter",d),document.addEventListener("mouseout",p),()=>{cancelAnimationFrame(P),document.removeEventListener("mousemove",C),document.removeEventListener("mousedown",k),document.removeEventListener("mouseup",E),document.removeEventListener("mouseenter",d),document.removeEventListener("mouseout",p)}},[j]),f?null:e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:t,className:"fixed top-0 left-0 z-[9999] pointer-events-none will-change-transform",style:{top:0,left:0},children:e.jsx("div",{className:`w-2 h-2 bg-white rounded-full shadow-[0_0_10px_rgba(255,255,255,0.8)] transition-all duration-300 ease-out ${a?"scale-0 opacity-0":y?"scale-50 opacity-100":j?"scale-150 opacity-100":"scale-100 opacity-100"}`})}),e.jsx("div",{ref:n,className:"fixed top-0 left-0 w-10 h-10 pointer-events-none z-[9998] mix-blend-difference will-change-transform",style:{top:0,left:0},children:e.jsx("svg",{className:`w-full h-full transition-all duration-500 ease-out ${a?"scale-0 opacity-0":y?"scale-75 opacity-100":j?"scale-125 rotate-180 opacity-100":"scale-100 opacity-100"}`,viewBox:"0 0 40 40",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:j?"M 20 1 L 37 10.5 L 37 29.5 L 20 39 L 3 29.5 L 3 10.5 Z":"M 20 1 A 19 19 0 1 1 20 39 A 19 19 0 1 1 20 1 Z",stroke:"white",strokeWidth:"2",strokeLinecap:"round",style:{transition:"d 0.3s ease-out"}})})})]})},Ee=()=>{const t=r.useRef(null),n=r.useRef(null),c=r.useRef([]),l=r.useRef({width:0,height:0}),s=2,a=25,x=100,y=35,h=.08,j=4,m=r.useCallback((b,o)=>{const u=[],P=Math.floor(b/a),C=Math.floor(o/a);for(let E=0;E<C;E++)for(let d=0;d<P;d++)u.push({x:d*a+a/2,y:E*a+a/2,brightness:0,targetBrightness:0,pulsePhase:Math.random()*Math.PI*2});const k=[...Array(u.length).keys()].sort(()=>Math.random()-.5);for(let E=0;E<Math.min(y,u.length);E++)u[k[E]].targetBrightness=1;return u},[]),f=r.useCallback(()=>{const b=c.current;if(b.length===0)return;const o=[],u=[];b.forEach((C,k)=>{C.targetBrightness>.5?o.push(k):u.push(k)});const P=Math.min(j,o.length,u.length);for(let C=0;C<P&&!(o.length===0||u.length===0);C++){const k=o.splice(Math.floor(Math.random()*o.length),1)[0],E=u.splice(Math.floor(Math.random()*u.length),1)[0];b[k].targetBrightness=0,b[E].targetBrightness=1}},[]),S=r.useCallback(()=>{const b=t.current;if(!b)return;const o=b.getContext("2d"),{width:u,height:P}=l.current;o.clearRect(0,0,u,P);const C=c.current,k=Date.now()*.002;for(let d=0;d<C.length;d++){const p=C[d],_=Math.sin(k+p.pulsePhase)*.3+.7,N=p.targetBrightness*_;p.brightness+=(N-p.brightness)*h}o.lineWidth=1;const E=[];for(let d=0;d<C.length;d++)C[d].brightness>.15&&E.push(C[d]);o.beginPath();for(let d=0;d<E.length;d++)for(let p=d+1;p<E.length;p++){const _=E[d],N=E[p],g=N.x-_.x,i=N.y-_.y,v=g*g+i*i;if(v<x*x){const z=(1-Math.sqrt(v)/x)*Math.min(_.brightness,N.brightness)*.4;o.strokeStyle=`rgba(255, 255, 255, ${z})`,o.beginPath(),o.moveTo(_.x,_.y),o.lineTo(N.x,N.y),o.stroke()}}for(let d=0;d<C.length;d++){const p=C[d];if(p.brightness>.05){const _=p.brightness;o.beginPath(),o.arc(p.x,p.y,s*2,0,Math.PI*2),o.fillStyle=`rgba(255, 255, 255, ${_*.15})`,o.fill(),o.beginPath(),o.arc(p.x,p.y,s,0,Math.PI*2),o.fillStyle=`rgba(255, 255, 255, ${_*.9})`,o.fill()}else o.beginPath(),o.arc(p.x,p.y,s*.5,0,Math.PI*2),o.fillStyle="rgba(255, 255, 255, 0.03)",o.fill()}n.current=requestAnimationFrame(S)},[]);return r.useEffect(()=>{const b=()=>{if(t.current){const o=window.innerWidth,u=window.innerHeight;l.current={width:o,height:u},t.current.width=o,t.current.height=u,c.current=m(o,u)}};return b(),window.addEventListener("resize",b),()=>window.removeEventListener("resize",b)},[m]),r.useEffect(()=>{S();const b=setInterval(f,300);return()=>{n.current&&cancelAnimationFrame(n.current),clearInterval(b)}},[S,f]),e.jsx("canvas",{ref:t,className:"absolute inset-0 z-0 pointer-events-none",style:{background:"transparent"}})},ue=["Finishing the prompt...","Stuck in traffic...","Uploading the assignment...","Wearing ID card...","Taking the fish for a walk...","Mass bunking...","Eating ice cream...","ICA farming...","Checking Defalter List...","Avoiding eye contact with faculty...","Avoiding the library...","Connecting to VPN...","Pretending to understand quantum physics...","Attempting Re-Exam... ","Finding an empty class...","Scrolling Reels..."],gt=()=>{const[t,n]=r.useState(!0),[c,l]=r.useState([]),[s,a]=r.useState(0),[x,y]=r.useState(!1),[h,j]=r.useState(0);return r.useEffect(()=>{const m=[...ue];for(let f=m.length-1;f>0;f--){const S=Math.floor(Math.random()*(f+1));[m[f],m[S]]=[m[S],m[f]]}l(m),a(Math.floor(Math.random()*m.length))},[]),r.useEffect(()=>{if(!t)return;const m=setInterval(()=>{a(f=>(f+1)%ue.length)},1500);return()=>clearInterval(m)},[t]),r.useEffect(()=>{const m=setInterval(()=>{j(f=>f>=100?100:f+Math.random()*15+5)},200);return()=>clearInterval(m)},[]),r.useEffect(()=>{const m=setTimeout(()=>{y(!0),setTimeout(()=>n(!1),500)},2e3);return()=>clearTimeout(m)},[]),t?e.jsxs("div",{className:`fixed inset-0 z-[10000] bg-black flex flex-col items-center justify-center transition-opacity duration-500 ${x?"opacity-0":"opacity-100"}`,children:[e.jsx("div",{className:"absolute inset-0 opacity-30",children:e.jsx(Ee,{})}),e.jsxs("div",{className:"relative z-10 flex flex-col items-center",children:[e.jsx("div",{className:"text-white text-3xl md:text-4xl font-display font-bold mb-4 tracking-widest animate-pulse text-center px-4",children:"CAMPUS NODES"}),e.jsx("div",{className:"text-zinc-400 font-mono text-xs md:text-sm h-6 text-center px-4",children:c.length>0?c[s]:"Loading..."}),e.jsx("div",{className:"w-48 md:w-64 h-1 bg-zinc-800 mt-8 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-white transition-all duration-300 ease-out",style:{width:`${Math.min(h,100)}%`}})})]})]}):null},L=({children:t,variant:n="primary",onClick:c,className:l="",type:s="button",fullWidth:a=!1,to:x,href:y,withDoodles:h=!0,disabled:j})=>{const m=r.useRef(null),[f,S]=r.useState(!1),b=p=>{j||(S(!0),setTimeout(()=>S(!1),700),c&&c(p))},o="relative group/btn font-display font-bold uppercase tracking-widest text-xs px-8 py-4 transition-all duration-300 transform active:scale-95 disabled:opacity-50 disabled:cursor-none flex items-center justify-center gap-2",u={primary:"bg-white text-black border border-transparent hover:bg-zinc-200",outline:"border border-white/20 text-white hover:border-white hover:bg-white/5",ghost:"text-gray-400 hover:text-white hover:bg-white/5",accent:"bg-accent text-white border border-transparent hover:bg-accent/90"},P=a?"w-full":"",C=`${o} ${u[n]} ${P} ${l}`,k=(p,_,N)=>f?`opacity-0 ${N} transition-all duration-700 ease-out z-50`:`opacity-0 group-hover/btn:opacity-100 ${_} transition-all duration-300 ease-out ${p}`,E=()=>e.jsxs("span",{className:"absolute inset-0 pointer-events-none overflow-visible",children:[e.jsx("span",{className:`absolute left-1/2 -translate-x-1/2 ${k("-top-12","-top-8","-translate-y-[80vh]")} delay-75 text-white`,children:e.jsx(Ae,{size:20,fill:"currentColor"})}),e.jsx("span",{className:`absolute left-0 ${k("-top-10","-top-6","-translate-y-[80vh] -translate-x-[20vw]")} delay-0 text-white -rotate-12`,children:e.jsx(de,{size:20,strokeWidth:3})}),e.jsx("span",{className:`absolute right-0 ${k("-top-10","-top-6","-translate-y-[80vh] translate-x-[20vw]")} delay-100 text-white rotate-12`,children:e.jsx(oe,{size:16,fill:"currentColor"})}),e.jsx("span",{className:`absolute left-1/2 -translate-x-1/2 ${k("-bottom-12","-bottom-8","translate-y-[80vh]")} delay-75 text-white`,children:e.jsx(Le,{size:18,strokeWidth:3})}),e.jsx("span",{className:`absolute left-0 ${k("-bottom-10","-bottom-6","translate-y-[80vh] -translate-x-[20vw]")} delay-0 text-white rotate-12`,children:e.jsx(D,{size:16,strokeWidth:4})}),e.jsx("span",{className:`absolute right-0 ${k("-bottom-10","-bottom-6","translate-y-[80vh] translate-x-[20vw]")} delay-100 text-white -rotate-12`,children:e.jsx(de,{size:20,strokeWidth:3,className:"rotate-180"})}),e.jsx("span",{className:`absolute top-1/2 -translate-y-1/2 ${k("-left-12","-left-8","-translate-x-[80vw]")} delay-50 text-white`,children:e.jsx(ge,{size:20,strokeWidth:3})}),e.jsx("span",{className:`absolute top-0 ${k("-left-8","-left-5","-translate-x-[80vw] -translate-y-[20vh]")} delay-100 text-white`,children:e.jsx(re,{size:16,fill:"currentColor"})}),e.jsx("span",{className:`absolute top-1/2 -translate-y-1/2 ${k("-right-12","-right-8","translate-x-[80vw]")} delay-50 text-white`,children:e.jsx(be,{size:20,strokeWidth:3})}),e.jsx("span",{className:`absolute bottom-0 ${k("-right-8","-right-5","translate-x-[80vw] translate-y-[20vh]")} delay-100 text-white rotate-45`,children:e.jsx($e,{size:16,fill:"currentColor"})})]}),d=e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"relative z-10",children:t}),h&&e.jsx(E,{})]});return x?e.jsx($,{to:x,className:C,ref:m,onClick:b,children:d}):y?e.jsx("a",{href:y,className:C,target:"_blank",rel:"noopener noreferrer",ref:m,onClick:b,children:d}):e.jsx("button",{ref:m,type:s,className:C,onClick:b,disabled:j,children:d})},bt=()=>{const{user:t}=O();return e.jsxs("section",{className:"relative w-full h-screen flex flex-col justify-center items-center overflow-hidden bg-transparent",children:[e.jsx("div",{className:"absolute inset-0 bg-grid-white/[0.02] -z-10"}),e.jsx("div",{className:"absolute top-1/4 -left-20 w-96 h-96 bg-accent/10 rounded-full blur-[100px] pointer-events-none"}),e.jsxs("div",{className:"z-10 text-center px-4 max-w-5xl mx-auto pointer-events-none",children:[e.jsx("h1",{className:"text-6xl md:text-9xl font-bold font-display tracking-tighter text-white mb-6 animate-fade-in pointer-events-auto",children:"CAMPUS NODES"}),e.jsxs("p",{className:"text-gray-400 text-lg md:text-2xl max-w-2xl mx-auto font-light tracking-wide mb-12 animate-fade-in pointer-events-auto",style:{animationDelay:"200ms"},children:["The decentralized marketplace for everything on campus.",e.jsx("br",{}),"Trade gears, find mentors, build your network."]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-6 justify-center items-center animate-fade-in pointer-events-auto",style:{animationDelay:"400ms"},children:[e.jsx(xe,{children:e.jsxs(L,{to:t?"/market":"/signup",variant:"primary",className:"px-8 py-4 text-sm",children:[t?"Go to Market":"Start Trading"," ",e.jsx(ge,{size:18,className:"inline ml-2"})]})}),e.jsx(xe,{children:e.jsx(L,{to:"/services",variant:"outline",className:"px-8 py-4 text-sm",children:"Explore Services"})})]})]})]})},ie=[{id:1,title:"Casio FX-991EX Classwiz (Used)",category:"Stationary",price:"â‚¹600",images:[],seller:"Aarya Nadiger",trustScore:95,description:"Used for 1 semester. Perfect condition. Includes original sliding cover. Essential for engineering exams."},{id:2,title:"Engineering Drafter & Roller Scale",category:"Stationary",price:"â‚¹450",images:[],seller:"Rushi Shah",trustScore:98,description:"Mini drafter suitable for ED/EGD labs. Roller scale included. Brand: Omega."},{id:3,title:"Arduino Uno Starter Kit",category:"Tech",price:"â‚¹850",images:[],seller:"Meemoh Shukla",trustScore:90,description:"Includes Uno board, breadboard, jumper wires, LEDs, resistors, and sensors. Great for First Year projects."},{id:4,title:"Electric Kettle (1.5L)",category:"Essentials",price:"â‚¹500",images:[],seller:"Prithish Gurbani",trustScore:85,description:"Prestige 1.5L Kettle. Works perfectly. Boils water in 2 mins. Cable included."},{id:5,title:"Lab Coat (Size M) + Goggles",category:"Essentials",price:"â‚¹200",images:[],seller:"Tanish Parekh",trustScore:100,description:"Cotton lab coat, Size M. Hardly used. Safety goggles included for Chem lab."},{id:6,title:"Hercules Cycle (Black)",category:"Transport",price:"â‚¹2,500",images:[],seller:"Sarvesh Nimbalkar",trustScore:92,description:"Single speed Hercules cycle. Tyres replaced recently. Good condition for campus commuting."},{id:7,title:"Engineering Math (K.A. Stroud)",category:"Textbooks",price:"â‚¹350",images:[],seller:"Arjun Shetty",trustScore:97,description:"Fifth Edition. No highlighting/markings inside. Essential for first year calculus."},{id:8,title:"Extension Board (4 Socket)",category:"Essentials",price:"â‚¹300",images:[],seller:"Viyomm",trustScore:88,description:"Belkin 4-socket surge protector. 1.5m wire length. Must have for hostel rooms."}],vt=({item:t})=>{const n=r.useRef(null),c=t.images&&t.images.length>0,l=s=>{if(n.current){const{clientWidth:a}=n.current,x=s==="left"?-a:a;n.current.scrollBy({left:x,behavior:"smooth"})}};return e.jsxs("div",{className:"group relative bg-surface border border-white/5 hover:border-white/20 hover:z-[50] transition-colors duration-300",children:[e.jsx("div",{className:"relative aspect-[4/3] overflow-hidden bg-white/5",children:c?e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:n,className:"w-full h-full overflow-x-auto flex snap-x snap-mandatory scrollbar-hide",children:t.images.map((s,a)=>e.jsx("img",{src:s,alt:`${t.title} ${a+1}`,className:"w-full h-full object-cover shrink-0 snap-center"},a))}),e.jsx("button",{onClick:s=>{s.preventDefault(),l("left")},className:"absolute left-2 top-1/2 -translate-y-1/2 bg-black/50 text-white p-1 rounded-full opacity-0 group-hover:opacity-100 transition-opacity hover:bg-black/70 z-10",children:e.jsx(X,{size:20})}),e.jsx("button",{onClick:s=>{s.preventDefault(),l("right")},className:"absolute right-2 top-1/2 -translate-y-1/2 bg-black/50 text-white p-1 rounded-full opacity-0 group-hover:opacity-100 transition-opacity hover:bg-black/70 z-10",children:e.jsx(ve,{size:20})})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full p-6 text-center opacity-50",children:[e.jsx(te,{className:"w-12 h-12 mb-3"}),e.jsx("p",{className:"text-[10px] uppercase tracking-wider text-gray-400 font-medium",children:"Seller has not uploaded any images for this product"})]})}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("span",{className:"text-xs font-bold text-accent uppercase tracking-wider",children:t.category}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-400",children:[e.jsx(oe,{size:12,className:"text-yellow-500 fill-current"})," ",t.trustScore]})]}),e.jsx("h3",{className:"text-white font-medium truncate mb-1",children:t.title}),e.jsx("p",{className:"text-lg font-bold text-white",children:t.price}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-white/10 flex justify-between items-center text-sm text-gray-400",children:[e.jsxs("span",{children:["@",t.seller]}),e.jsx(L,{to:`/market/${t.id}`,variant:"primary",className:"px-4 py-2 text-xs",children:"View"})]})]})]})},jt=()=>{const[t,n]=r.useState("All"),c=["All","Stationary","Tech","Essentials","Transport","Textbooks"],l=t==="All"?ie:ie.filter(s=>s.category===t);return r.useEffect(()=>{V({targets:".market-card",opacity:[0,1],translateY:[20,0],delay:V.stagger(100),easing:"easeOutExpo"})},[t]),e.jsx("div",{className:"min-h-screen bg-background pt-24 pb-20 px-6 md:px-12",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center mb-12",children:[e.jsx("h1",{className:"text-5xl font-display font-bold text-white mb-6 md:mb-0",children:"Marketplace"}),e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2 md:pb-0 w-full md:w-auto p-1",children:c.map(s=>e.jsx("button",{onClick:()=>n(s),className:`px-4 py-2 text-sm font-medium border transition-all duration-300 whitespace-nowrap
                  ${t===s?"bg-white text-black border-white":"text-gray-400 border-white/10 hover:border-white/50 hover:text-white"}`,children:s},s))})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:l.map((s,a)=>e.jsx("div",{className:"market-card opacity-0",children:e.jsx(vt,{item:s})},s.id))})]})})},wt=[{id:"tutoring",title:"Peer Tutoring",description:"Ace your mid-terms with help from seniors who topped the class.",icon:e.jsx(je,{size:40}),availableCount:42,provider:"Aarya Nadiger"},{id:"printing",title:"Print & Bind",description:"Fast, cheap printing delivered to your hostel room. Assignments & theses.",icon:e.jsx(De,{size:40}),availableCount:8,provider:"Rushi Shah"},{id:"repair",title:"Tech Repair",description:"Broken laptop screen or phone issues? Student-run reliable fixes.",icon:e.jsx(Z,{size:40}),availableCount:12,provider:"Meemoh Shukla"},{id:"coding",title:"Coding Mentorship",description:"Debug help for C++, Python, and Java semester projects.",icon:e.jsx(Fe,{size:40}),availableCount:25,provider:"Prithish Gurbani"},{id:"photography",title:"Event Media",description:"Hire photographers and videographers for your club events.",icon:e.jsx(we,{size:40}),availableCount:5,provider:"Tanish Parekh"},{id:"events",title:"Committee Events",description:"Find committees recruiting new members or hosting workshops.",icon:e.jsx(Oe,{size:40}),availableCount:7,provider:"Sarvesh Nimbalkar"}],yt=({service:t,index:n})=>e.jsxs("div",{className:"service-card group relative p-8 bg-surface border border-white/5 hover:border-white/20 hover:z-[50] transition-all duration-500 min-h-[300px] flex flex-col justify-end",children:[e.jsx("div",{className:"absolute top-8 right-8 text-gray-700 group-hover:text-accent transition-colors duration-500",children:t.icon}),e.jsxs("div",{className:"relative z-10",children:[e.jsx("h3",{className:"text-3xl font-display font-bold text-white mb-4 group-hover:translate-x-2 transition-transform duration-300",children:t.title}),e.jsx("p",{className:"text-gray-400 max-w-sm mb-6 opacity-80 group-hover:opacity-100 transition-opacity",children:t.description}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:"text-xs font-bold uppercase tracking-wider text-accent mb-1",children:[t.availableCount," Active Listed"]}),e.jsxs("span",{className:"text-[10px] uppercase tracking-widest text-gray-500",children:["Head: ",t.provider]})]}),e.jsx(L,{variant:"outline",className:"px-6 py-2 ml-auto",children:"View"})]})]}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/80 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500 pointer-events-none"})]}),Nt=()=>e.jsx("div",{className:"min-h-screen bg-background pt-32 pb-20 px-6 md:px-12",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-16 animate-fade-in",children:[e.jsx("span",{className:"text-accent text-sm font-bold uppercase tracking-widest mb-2 block",children:"Our Ecosystem"}),e.jsx("h1",{className:"text-5xl md:text-7xl font-display font-bold text-white mb-8",children:"Campus Services"}),e.jsx("p",{className:"text-xl text-gray-400 max-w-2xl font-light",children:"Everything you need to survive and thrive on campus. From academic support to logistical solutions."})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:wt.map((t,n)=>e.jsx("div",{style:{animationDelay:`${n*150}ms`},className:"opacity-0 animate-fade-in fill-mode-forwards",children:e.jsx(yt,{service:t,index:n})},t.id))}),e.jsxs("div",{className:"mt-20 p-12 bg-zinc-900 border border-white/5 relative overflow-hidden text-center opacity-0 animate-fade-in fill-mode-forwards",style:{animationDelay:"600ms"},children:[e.jsx("h2",{className:"text-3xl font-display font-bold text-white mb-6",children:"Need a custom service?"}),e.jsx("p",{className:"text-gray-400 mb-8 max-w-xl mx-auto",children:"Post a request for tasks, tutoring, or help. The community is here to support you."}),e.jsx(L,{variant:"primary",className:"px-8 py-3",children:"Post Request"})]})]})}),kt=t=>{const n=new Date(t),l=Math.floor((new Date-n)/1e3);if(l<60)return"Just now";const s=Math.floor(l/60);if(s<60)return`${s}m`;const a=Math.floor(s/60);if(a<24)return`${a}h`;const x=Math.floor(a/24);return x<7?`${x}d`:n.toLocaleDateString()},_t=()=>{const{user:t}=O(),{openAuthModal:n}=B(),[c,l]=r.useState([]),[s,a]=r.useState(!0),[x,y]=r.useState(""),[h,j]=r.useState(!1),m=async()=>{try{const{data:o,error:u}=await w.from("posts").select(`
                    *,
                    profiles:user_id (
                        id,
                        first_name,
                        last_name,
                        avatar_url,
                        role
                    )
                `).order("created_at",{ascending:!1});if(u)throw u;l(o||[])}catch(o){console.error("Error fetching posts:",o)}finally{a(!1)}};r.useEffect(()=>{m();const o=w.channel("public:posts").on("postgres_changes",{event:"*",schema:"public",table:"posts"},()=>{m()}).subscribe();return()=>{w.removeChannel(o)}},[]);const f=async o=>{if(o.preventDefault(),!t)return n();if(x.trim()){j(!0);try{const{error:u}=await w.from("posts").insert({user_id:t.id,content:x.trim()});if(u)throw u;y("")}catch(u){console.error("Error creating post:",u),alert("Failed to post. Please try again.")}finally{j(!1)}}},S=async o=>{if(confirm("Are you sure you want to delete this post?"))try{const{error:u}=await w.from("posts").delete().eq("id",o);if(u)throw u}catch(u){console.error("Error deleting post:",u)}},b=async o=>{if(!t)return n();alert("Likes coming soon!")};return e.jsx("div",{className:"min-h-screen bg-background pt-24 pb-24 px-4 md:px-8",children:e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsx("header",{className:"mb-8 flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold font-display text-white",children:"Campus Feed"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"See what's happening around campus."})]})}),e.jsx("div",{className:"bg-surface border border-white/10 rounded-2xl p-4 mb-8",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-700 overflow-hidden shrink-0 border border-white/10",children:t?.user_metadata?.avatar_url?e.jsx("img",{src:t.user_metadata.avatar_url,alt:"",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-white",children:e.jsx(J,{size:20})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("textarea",{value:x,onChange:o=>y(o.target.value),placeholder:"What's on your mind?",className:"w-full bg-transparent text-white placeholder-gray-500 resize-none focus:outline-none min-h-[60px] text-base",rows:2}),e.jsxs("div",{className:"flex justify-between items-center mt-2 pt-3 border-t border-white/5",children:[e.jsx("div",{className:"text-xs text-gray-500"}),e.jsx(L,{onClick:f,disabled:!x.trim()||h,className:"px-4 py-1.5 h-8 text-xs rounded-full",children:h?"Posting...":"Post"})]})]})]})}),s?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-accent"})}):e.jsxs("div",{className:"space-y-4",children:[e.jsx(F,{mode:"popLayout",children:c.map(o=>e.jsx(I.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,scale:.95},layout:!0,className:"bg-surface border border-white/5 p-5 rounded-2xl group hover:bg-white/5 transition-colors",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-700 overflow-hidden shrink-0 border border-white/10",children:o.profiles?.avatar_url?e.jsx("img",{src:o.profiles.avatar_url,alt:"",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-white font-bold text-xs bg-gradient-to-br from-blue-500 to-purple-600",children:o.profiles?.first_name?.[0]||"?"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:"font-bold text-white text-sm hover:underline cursor-pointer",children:[o.profiles?.first_name," ",o.profiles?.last_name]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-400",children:[e.jsxs("span",{children:["@",o.profiles?.role||"Student"]}),e.jsx("span",{children:"â€¢"}),e.jsx("span",{children:kt(o.created_at)})]})]}),t&&t.id===o.user_id&&e.jsx("button",{onClick:()=>S(o.id),className:"text-gray-500 hover:text-red-500 transition-colors p-1",children:e.jsx(ee,{size:14})})]}),e.jsx("div",{className:"mt-2 text-gray-200 text-[15px] whitespace-pre-wrap leading-relaxed",children:o.content}),e.jsxs("div",{className:"flex items-center gap-6 mt-4 pt-3 border-t border-white/5",children:[e.jsxs("button",{onClick:()=>b(o.id),className:"flex items-center gap-2 text-gray-400 hover:text-red-500 transition-colors group/like",children:[e.jsx("div",{className:"p-1.5 rounded-full group-hover/like:bg-red-500/10 transition-colors",children:e.jsx(qe,{size:16})}),e.jsx("span",{className:"text-xs",children:"Like"})]}),e.jsxs("button",{className:"flex items-center gap-2 text-gray-400 hover:text-blue-400 transition-colors group/comment",children:[e.jsx("div",{className:"p-1.5 rounded-full group-hover/comment:bg-blue-400/10 transition-colors",children:e.jsx(le,{size:16})}),e.jsx("span",{className:"text-xs",children:"Comment"})]})]})]})]})},o.id))}),c.length===0&&e.jsx("div",{className:"text-center py-20 text-gray-500",children:e.jsx("p",{children:"No posts yet. Be the first to say hello! ðŸ‘‹"})})]})]})})},Ct=()=>{const{user:t}=O(),{openAuthModal:n}=B();W();const[c,l]=r.useState([]),[s,a]=r.useState([]),[x,y]=r.useState([]),[h,j]=r.useState(!0),[m,f]=r.useState(""),[S,b]=r.useState(null),[o,u]=r.useState(null),[P,C]=r.useState({top:0,left:0}),k=async()=>{try{j(!0);let i=[];if(t){const{data:M,error:U}=await w.from("friendships").select("*").or(`user1_id.eq.${t.id},user2_id.eq.${t.id}`);if(U)throw U;i=M||[]}const{data:v,error:z}=await w.from("profiles").select("*").order("created_at",{ascending:!1}).limit(50);if(z)throw z;if(!t){y(v),l([]);return}const R=i.filter(M=>M.status==="accepted"),T=R.map(M=>M.user1_id===t.id?M.user2_id:M.user1_id),Y=v.filter(M=>T.includes(M.id)).map(M=>{const U=R.find(ce=>ce.user1_id===M.id||ce.user2_id===M.id);return{...M,friendship_id:U?.id}});l(Y);const se=i.filter(M=>M.status==="pending"&&M.user1_id===t.id).map(M=>M.user2_id),K=i.filter(M=>M.status==="pending"&&M.user2_id===t.id).map(M=>M.user1_id),Pe=v.filter(M=>K.includes(M.id));a(Pe);const Te=v.filter(M=>M.id!==t.id&&!T.includes(M.id)&&!K.includes(M.id)).map(M=>{let U="none";return se.includes(M.id)&&(U="sent"),{...M,status:U}});y(Te)}catch(i){console.error("Error fetching connections:",i)}finally{j(!1)}};r.useEffect(()=>{k();const i=w.channel("connections_page_realtime").on("postgres_changes",{event:"*",schema:"public",table:"friendships"},()=>k()).subscribe();return()=>w.removeChannel(i)},[t]);const E=async i=>{if(!t)return n();b(i);try{const{error:v}=await w.from("friendships").insert({user1_id:t.id,user2_id:i,status:"pending"});if(v)throw v;k()}catch(v){console.error(v),alert("Action failed")}finally{b(null)}},d=async i=>{b(i);try{const{error:v}=await w.from("friendships").update({status:"accepted"}).eq("user1_id",i).eq("user2_id",t.id);if(v)throw v;k()}catch(v){console.error(v)}finally{b(null)}},p=async i=>{b(i);try{const{error:v}=await w.from("friendships").delete().eq("user1_id",i).eq("user2_id",t.id);if(v)throw v;k()}catch(v){console.error(v)}finally{b(null)}},_=(i,v)=>{const z=v.currentTarget,R=z.closest(".group");if(R){const T=R.getBoundingClientRect();C({top:T.top-60,left:T.left+T.width/2-105})}else{const T=z.getBoundingClientRect();C({top:T.top-60,left:T.left-100})}u(i)},N=async()=>{if(o)try{const v=c.find(z=>z.friendship_id===o)?.id;await w.from("friendships").delete().eq("id",o),v&&t&&(await w.from("messages").delete().eq("sender_id",t.id).eq("receiver_id",v),await w.from("messages").delete().eq("sender_id",v).eq("receiver_id",t.id)),u(null),k()}catch(i){console.error(i)}},g=x.filter(i=>(i.first_name+" "+i.last_name).toLowerCase().includes(m.toLowerCase()));return e.jsxs("div",{className:"min-h-screen bg-background pt-32 pb-20 px-6 md:px-12 relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 w-[500px] h-[500px] bg-blue-500/10 rounded-full blur-[100px] pointer-events-none"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-[500px] h-[500px] bg-purple-500/10 rounded-full blur-[100px] pointer-events-none"}),e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("header",{className:"mb-12",children:[e.jsx("h1",{className:"text-5xl font-display font-bold text-white mb-4",children:"Network & Circle"}),e.jsx("p",{className:"text-gray-400",children:"Manage your close circle and discover new connections."})]}),t&&e.jsxs("section",{className:"mb-16",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(Ue,{className:"text-accent",size:24}),e.jsxs("h2",{className:"text-2xl font-bold text-white",children:["Your Circle (",c.length,")"]})]}),c.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:c.map(i=>e.jsxs("div",{className:"bg-white/5 border border-white/10 p-5 rounded-xl flex items-center justify-between group hover:bg-white/10 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-gray-800 rounded-full border border-white/20 overflow-hidden",children:i.avatar_url?e.jsx("img",{src:i.avatar_url,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-white font-bold",children:i.first_name?.[0]})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-white font-bold",children:[i.first_name," ",i.last_name]}),e.jsx("p",{className:"text-gray-400 text-xs",children:i.role||"Student"})]})]}),e.jsx("button",{onClick:v=>_(i.friendship_id,v),className:"p-2 bg-white/5 text-gray-400 rounded-full hover:bg-red-600 hover:text-white transition-all opacity-100",title:"Remove Connection",children:e.jsx(We,{size:20})})]},i.id))}):e.jsx("div",{className:"p-8 border border-dashed border-white/10 rounded-xl text-center text-gray-500",children:"You haven't connected with anyone yet."})]}),t&&s.length>0&&e.jsxs("section",{className:"mb-16 animate-fade-in-up",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(Be,{className:"text-yellow-400",size:24}),e.jsxs("h2",{className:"text-2xl font-bold text-white",children:["Pending Requests (",s.length,")"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:s.map(i=>e.jsxs("div",{className:"bg-white/5 border border-yellow-500/20 p-5 rounded-xl flex items-center justify-between group hover:bg-white/10 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-gray-800 rounded-full border border-white/20 overflow-hidden",children:i.avatar_url?e.jsx("img",{src:i.avatar_url,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-white font-bold",children:i.first_name?.[0]})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-white font-bold text-lg",children:[i.first_name," ",i.last_name]}),e.jsx("p",{className:"text-yellow-400 text-xs font-semibold uppercase tracking-wider",children:"Wants to join"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>d(i.id),className:"p-2 bg-green-500/20 text-green-400 rounded-full hover:bg-green-500 hover:text-black transition-colors",title:"Accept",disabled:S===i.id,children:e.jsx(Q,{size:18})}),e.jsx("button",{onClick:()=>p(i.id),className:"p-2 bg-red-500/20 text-red-400 rounded-full hover:bg-red-500 hover:text-white transition-colors",title:"Decline",disabled:S===i.id,children:e.jsx(D,{size:18})})]})]},i.id))})]}),e.jsxs("section",{children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-end mb-8 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(he,{className:"text-purple-400",size:24}),e.jsx("h2",{className:"text-2xl font-bold text-white",children:"Discover People"})]}),e.jsxs("div",{className:"relative w-full md:w-80",children:[e.jsx("input",{type:"text",placeholder:"Search students...",value:m,onChange:i=>f(i.target.value),className:"w-full bg-black border border-white/20 rounded-full px-4 py-2 pl-10 text-white focus:outline-none focus:border-accent"}),e.jsx(he,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",size:16})]})]}),h?e.jsx("div",{className:"flex justify-center py-20",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-white"})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:g.map(i=>e.jsxs("div",{className:"bg-white/5 border border-white/10 p-6 rounded-xl hover:border-accent/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("div",{className:"w-14 h-14 bg-gray-800 rounded-full border border-white/20 overflow-hidden",children:i.avatar_url?e.jsx("img",{src:i.avatar_url,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-white font-bold",children:i.first_name?.[0]})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-white font-bold text-lg",children:[i.first_name," ",i.last_name]}),e.jsx("p",{className:"text-accent text-xs font-bold uppercase tracking-wider",children:i.role||"Student"})]})]}),e.jsx("div",{className:"pt-4 border-t border-white/10 flex justify-end",children:e.jsx(L,{onClick:()=>E(i.id),variant:i.status==="sent"||i.status==="accepted"?"outline":"primary",disabled:i.status==="sent"||S===i.id,className:"px-6 py-2 text-sm",children:S===i.id?"...":i.status==="sent"?"Requested":i.status==="received"?"Accept Request":"Connect"})})]},i.id))})]}),o&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-[99] bg-transparent",onClick:()=>u(null)}),e.jsxs("div",{className:"fixed z-[100] bg-black border border-white/20 p-2 pl-4 rounded-full flex items-center gap-3 shadow-[0_0_20px_rgba(255,255,255,0.1)] animate-fade-in",style:{top:P.top,left:P.left},children:[e.jsx("span",{className:"text-xs font-bold text-white whitespace-nowrap",children:"Remove Connection?"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:N,className:"p-1.5 bg-green-500 text-black rounded-full hover:scale-110 transition-transform shadow-[0_0_10px_rgba(34,197,94,0.5)]",title:"Confirm",children:e.jsx(Q,{size:14})}),e.jsx("button",{onClick:()=>u(null),className:"p-1.5 bg-red-600 text-white rounded-full hover:scale-110 transition-transform shadow-[0_0_10px_rgba(239,68,68,0.5)]",title:"Cancel",children:e.jsx(D,{size:14})})]})]})]})]})]})},ze=(t,n)=>[t,n].sort().join("_"),Me=(t,n,c)=>{try{if(!t)return"";const l=ze(n,c);return ae.AES.encrypt(t,l).toString()}catch(l){return console.error("Encryption failed:",l),t}},H=(t,n,c)=>{try{if(!t)return"";const l=ze(n,c),a=ae.AES.decrypt(t,l).toString(ae.enc.Utf8);return a||t}catch{return t}},St=()=>{const{user:t}=O(),{removeUnreadSender:n,unreadSenders:c}=B(),l=W(),[s,a]=r.useState(null),[x,y]=r.useState([]),[h,j]=r.useState([]),[m,f]=r.useState(""),[S,b]=r.useState(!1),o=r.useRef(null),u=()=>{o.current?.scrollIntoView({behavior:"smooth"})};r.useEffect(()=>{t&&P()},[t]),r.useEffect(()=>{if(s){n(s.id),C(s.id);const d=w.channel(`chat_mobile:${s.id}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:`sender_id=eq.${s.id}`},p=>{if(p.new.receiver_id===t.id){const _=H(p.new.content,p.new.sender_id,p.new.receiver_id),N={...p.new,content:_};j(g=>[...g,N]),u()}}).subscribe();return()=>w.removeChannel(d)}},[s]);const P=async()=>{b(!0);try{const{data:d}=await w.from("friendships").select("*").or(`user1_id.eq.${t.id},user2_id.eq.${t.id}`).eq("status","accepted");if(!d?.length){y([]);return}const p=d.map(N=>N.user1_id===t.id?N.user2_id:N.user1_id),{data:_}=await w.from("profiles").select("*").in("id",p);y(_||[])}catch(d){console.error("Error fetching friends:",d)}finally{b(!1)}},C=async d=>{b(!0);try{const{data:p}=await w.from("messages").select("*").or(`and(sender_id.eq.${t.id},receiver_id.eq.${d}),and(sender_id.eq.${d},receiver_id.eq.${t.id})`).order("created_at",{ascending:!0}),_=(p||[]).map(N=>({...N,content:H(N.content,N.sender_id,N.receiver_id)}));j(_),setTimeout(u,100)}catch(p){console.error("Error fetching messages:",p)}finally{b(!1)}},k=async d=>{if(d.preventDefault(),!m.trim()||!s)return;const p=m.trim();f("");const _={id:Date.now(),sender_id:t.id,receiver_id:s.id,content:p,created_at:new Date().toISOString()};j(N=>[...N,_]),u();try{const N=Me(p,t.id,s.id);await w.from("messages").insert({sender_id:t.id,receiver_id:s.id,content:N})}catch(N){console.error("Error sending message:",N)}},E=async()=>{if(!(!s||!window.confirm("Clear all messages with this person?")))try{await w.from("messages").delete().eq("sender_id",t.id).eq("receiver_id",s.id),await w.from("messages").delete().eq("sender_id",s.id).eq("receiver_id",t.id),j([])}catch(d){console.error("Failed to clear chat",d)}};return t?e.jsxs("div",{className:"min-h-screen bg-background pt-4 pb-28",children:[e.jsx("div",{className:"sticky top-0 bg-background/80 backdrop-blur-xl z-20 px-4 py-3 border-b border-white/10",children:e.jsx("div",{className:"flex items-center gap-3",children:s?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>a(null),className:"p-2 -ml-2 hover:bg-white/10 rounded-full",children:e.jsx(X,{size:24,className:"text-white"})}),e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-700 overflow-hidden border border-white/20",children:s.avatar_url?e.jsx("img",{src:s.avatar_url,alt:"",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-sm font-bold text-white",children:s.first_name?.[0]})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h1",{className:"font-bold text-white",children:[s.first_name," ",s.last_name]}),e.jsxs("p",{className:"text-xs text-gray-500 flex items-center gap-1",children:[e.jsx(ye,{size:10})," End-to-end encrypted"]})]}),e.jsx("button",{onClick:E,className:"p-2 hover:bg-red-500/20 rounded-full text-gray-400 hover:text-red-400",children:e.jsx(ee,{size:18})})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>l(-1),className:"p-2 -ml-2 hover:bg-white/10 rounded-full",children:e.jsx(X,{size:24,className:"text-white"})}),e.jsx("h1",{className:"text-xl font-bold text-white",children:"Messages"})]})})}),s?e.jsxs("div",{className:"flex flex-col h-[calc(100vh-180px)]",children:[e.jsxs("div",{className:"flex-1 overflow-y-auto px-4 py-4 space-y-3",children:[h.length===0?e.jsxs("div",{className:"text-center py-10 text-gray-500",children:[e.jsx("p",{children:"No messages yet."}),e.jsx("p",{className:"text-sm",children:"Say hi! ðŸ‘‹"})]}):h.map(d=>e.jsx("div",{className:`flex ${d.sender_id===t.id?"justify-end":"justify-start"}`,children:e.jsx("div",{className:`max-w-[80%] px-4 py-2 rounded-2xl ${d.sender_id===t.id?"bg-accent text-black rounded-br-md":"bg-white/10 text-white rounded-bl-md"}`,children:e.jsx("p",{className:"text-sm",children:d.content})})},d.id)),e.jsx("div",{ref:o})]}),e.jsx("form",{onSubmit:k,className:"px-4 py-3 bg-background border-t border-white/10",children:e.jsxs("div",{className:"flex items-center gap-2 bg-white/5 rounded-full px-4 py-2",children:[e.jsx("input",{type:"text",value:m,onChange:d=>f(d.target.value),placeholder:"Type a message...",className:"flex-1 bg-transparent text-white placeholder:text-gray-500 focus:outline-none text-sm"}),e.jsx("button",{type:"submit",disabled:!m.trim(),className:"p-2 bg-accent text-black rounded-full disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(Ne,{size:16})})]})})]}):e.jsx("div",{className:"px-4 py-4 space-y-2",children:S?e.jsx("div",{className:"text-center py-10 text-gray-500",children:"Loading..."}):x.length===0?e.jsxs("div",{className:"text-center py-20",children:[e.jsx("p",{className:"text-gray-400 text-lg",children:"No friends yet."}),e.jsx("p",{className:"text-gray-500 text-sm mt-1",children:"Connect with people to chat!"})]}):x.map(d=>e.jsxs("button",{onClick:()=>a(d),className:"w-full flex items-center gap-3 p-3 bg-white/5 hover:bg-white/10 rounded-xl transition-all",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gray-700 overflow-hidden border border-white/20",children:d.avatar_url?e.jsx("img",{src:d.avatar_url,alt:"",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-sm font-bold text-white",children:d.first_name?.[0]})}),c.has(d.id)&&e.jsx("div",{className:"absolute -top-1 -right-1 w-4 h-4 bg-red-500 rounded-full border-2 border-background"})]}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsxs("h3",{className:"font-semibold text-white",children:[d.first_name," ",d.last_name]}),e.jsx("p",{className:"text-sm text-gray-500",children:d.role||"Student"})]})]},d.id))})]}):e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center px-6",children:e.jsx("p",{className:"text-gray-400",children:"Please log in to access messages."})})},Et=()=>{const t=r.useRef(null),n=W(),[c,l]=r.useState(!1),[s,a]=r.useState(null),[x,y]=r.useState(""),[h,j]=r.useState("");r.useEffect(()=>{V({targets:t.current,translateY:[20,0],opacity:[0,1],easing:"easeOutExpo",duration:800})},[]);const m=async f=>{f.preventDefault(),l(!0),a(null);try{const{data:S,error:b}=await w.auth.signInWithPassword({email:x,password:h});if(b)throw b;n("/")}catch(S){a(S.message)}finally{l(!1)}};return e.jsxs("div",{className:"min-h-screen flex items-center justify-center bg-background relative overflow-hidden px-4",children:[e.jsx("div",{className:"absolute top-0 right-0 w-96 h-96 bg-accent/5 rounded-full blur-[100px] pointer-events-none"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-64 h-64 bg-white/5 rounded-full blur-[80px] pointer-events-none"}),e.jsxs("div",{ref:t,className:"w-full max-w-md bg-surface/50 backdrop-blur-md border border-white/10 p-8 md:p-12 relative z-10 opacity-0 rounded-sm shadow-2xl",children:[e.jsxs("div",{className:"mb-8 text-center",children:[e.jsx("h1",{className:"text-3xl font-display font-bold text-white mb-2",children:"Welcome Back"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Sign in to access your dashboard"})]}),s&&e.jsx("div",{className:"mb-4 p-3 bg-red-500/10 border border-red-500/50 text-red-500 text-xs rounded-sm",children:s}),e.jsxs("form",{onSubmit:m,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs uppercase tracking-wider text-gray-500 mb-2 font-bold",children:"Email or NMIMS ID"}),e.jsx("input",{type:"email",value:x,onChange:f=>y(f.target.value),className:"w-full bg-black/20 border border-white/10 p-3 text-white focus:outline-none focus:border-accent transition-colors text-sm",placeholder:"student@nmims.edu",required:!0})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("label",{className:"block text-xs uppercase tracking-wider text-gray-500 font-bold",children:"Password"}),e.jsx($,{to:"/forgot-password",class:"text-xs text-accent hover:text-white transition-colors",children:"Forgot?"})]}),e.jsx("input",{type:"password",value:h,onChange:f=>j(f.target.value),className:"w-full bg-black/20 border border-white/10 p-3 text-white focus:outline-none focus:border-accent transition-colors text-sm",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",required:!0})]}),e.jsx(L,{type:"submit",variant:"accent",fullWidth:!0,disabled:c,children:c?"Signing In...":"Sign In"})]}),e.jsxs("div",{className:"mt-8 text-center text-sm text-gray-400",children:["Don't have an account? ",e.jsx($,{to:"/signup",className:"text-white hover:text-accent font-bold transition-colors",children:"Sign Up"})]})]})]})},zt={success:e.jsx(Q,{size:18}),error:e.jsx(D,{size:18}),warning:e.jsx(Ve,{size:18}),info:e.jsx(He,{size:18})},Mt={success:"bg-green-500/20 border-green-500/50 text-green-400",error:"bg-red-500/20 border-red-500/50 text-red-400",warning:"bg-yellow-500/20 border-yellow-500/50 text-yellow-400",info:"bg-accent/20 border-accent/50 text-accent"},Pt=({message:t,type:n="info",onClose:c,duration:l=4e3,isInsideContainer:s=!1})=>(r.useEffect(()=>{const a=setTimeout(c,l);return()=>clearTimeout(a)},[c,l]),e.jsxs("div",{className:`${s?"":"fixed top-6 left-1/2 -translate-x-1/2 z-[10001]"} px-5 py-3 rounded-xl border backdrop-blur-xl shadow-2xl flex items-center gap-3 ${Mt[n]}`,children:[e.jsx("div",{className:"shrink-0",children:zt[n]}),e.jsx("span",{className:"text-sm font-medium text-white",children:t}),e.jsx("button",{onClick:c,className:"shrink-0 ml-2 text-white/50 hover:text-white transition-colors",children:e.jsx(D,{size:14})})]})),Tt=({toasts:t,removeToast:n})=>e.jsx("div",{className:"fixed top-6 left-1/2 -translate-x-1/2 z-[10001] pointer-events-none flex flex-col items-center gap-3",children:e.jsx(F,{children:t.map(c=>e.jsx(I.div,{initial:{opacity:0,y:-20,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-20,scale:.95},className:"pointer-events-auto",children:e.jsx(Pt,{message:c.message,type:c.type,onClose:()=>n(c.id),duration:c.duration,isInsideContainer:!0})},c.id))})});let Rt=0;const It=()=>{const[t,n]=r.useState([]);return r.useEffect(()=>()=>{},[]),{toasts:t,addToast:(s,a="info",x=4e3)=>{const y=++Rt;return n(h=>[...h,{id:y,message:s,type:a,duration:x}]),y},removeToast:s=>{n(a=>a.filter(x=>x.id!==s))}}},At=()=>{const t=r.useRef(null),n=W(),[c,l]=r.useState(!1),[s,a]=r.useState(null),[x,y]=r.useState(!1),[h,j]=r.useState(!1),[m,f]=r.useState(""),{toasts:S,addToast:b,removeToast:o}=It(),[u,P]=r.useState({firstName:"",lastName:"",email:"",password:""});r.useEffect(()=>{V({targets:t.current,translateY:[20,0],opacity:[0,1],easing:"easeOutExpo",duration:800})},[x]);const C=p=>{P({...u,[p.target.name]:p.target.value})},k=async p=>{if(p.preventDefault(),l(!0),a(null),console.log("Starting signup process"),console.log("Email:",u.email),!u.email.toLowerCase().endsWith("@gmail.com")){a("Email must be a valid @gmail.com address."),l(!1);return}try{const{data:N,error:g}=await w.auth.signUp({email:u.email,password:u.password,options:{data:{first_name:u.firstName,last_name:u.lastName}}});if(console.log("Signup response:",{data:N,error:g}),g)throw g;y(!0),l(!1),console.log("Signup successful, OTP sent")}catch(N){console.error("Signup error:",N),a(N.message),l(!1)}},E=async p=>{p.preventDefault(),l(!0),a(null),console.log("Starting OTP verification"),console.log("Email:",u.email),console.log("OTP token:",m),console.log("OTP length:",m.length);try{const{data:_,error:N}=await w.auth.verifyOtp({email:u.email,token:m,type:"signup"});if(console.log("Supabase response:",{data:_,error:N}),N)throw console.error("OTP verification failed:",N),N.message.includes("Invalid")?a("Invalid verification code. Please check the code and try again."):N.message.includes("expired")?a("Verification code has expired. Please request a new code."):a(N.message||"Verification failed. Please try again."),N;const{error:g}=await w.from("profiles").upsert({id:_.user.id,first_name:u.firstName,last_name:u.lastName,role:"Student",email:u.email},{onConflict:"id"});g&&console.warn("Profile creation note:",g),b("Verification successful! Account created.","success"),j(!0),setTimeout(()=>n("/"),2e3)}catch(_){console.error("Full error object:",_),a(_.message||"Invalid verification code. Please check the code and try again.")}finally{l(!1)}},d=async()=>{l(!0),a(null),console.log("Resending OTP to:",u.email);try{const{data:p,error:_}=await w.auth.resend({type:"signup",email:u.email});if(console.log("Resend response:",{data:p,error:_}),_)throw console.error("Resend error:",_),_;b("Verification code resent! Check your inbox.","success")}catch(p){console.error("Resend error:",p),a(p.message)}finally{l(!1)}};return e.jsxs("div",{className:"min-h-screen flex items-center justify-center bg-background relative overflow-hidden px-4 py-20",children:[e.jsx(Tt,{toasts:S,removeToast:o}),e.jsx("div",{className:"absolute top-0 left-0 w-96 h-96 bg-accent/5 rounded-full blur-[100px] pointer-events-none"}),e.jsx("div",{ref:t,className:"w-full max-w-md bg-surface/50 backdrop-blur-md border border-white/10 p-8 md:p-12 relative z-10 opacity-0 rounded-sm shadow-2xl",children:h?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx(I.div,{initial:{scale:0},animate:{scale:1,rotate:360},transition:{type:"spring",stiffness:260,damping:20},className:"w-20 h-20 bg-green-500/20 rounded-full flex items-center justify-center mb-6 text-green-500 border border-green-500/30",children:e.jsx(Q,{size:40})}),e.jsx("h2",{className:"text-3xl font-display font-bold text-white mb-2",children:"Success!"}),e.jsx("p",{className:"text-gray-400",children:"Your account has been verified."}),e.jsx("p",{className:"text-gray-500 text-sm mt-1",children:"Redirecting to campus nodes..."})]}):x?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-8 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-accent/20 rounded-full flex items-center justify-center mx-auto mb-4 text-accent",children:e.jsx(Ge,{size:32})}),e.jsx("h1",{className:"text-2xl font-display font-bold text-white mb-2",children:"Check Your Email"}),e.jsxs("p",{className:"text-gray-400 text-sm",children:["We sent a 6-digit code to ",e.jsx("span",{className:"text-white font-bold",children:u.email})]})]}),s&&e.jsx("div",{className:"mb-4 p-3 bg-red-500/10 border border-red-500/50 text-red-500 text-xs rounded-sm",children:s}),e.jsxs("form",{onSubmit:E,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs uppercase tracking-wider text-gray-500 mb-2 font-bold text-center",children:"Verification Code"}),e.jsx("input",{type:"text",value:m,onChange:p=>f(p.target.value.replace(/\D/g,"").slice(0,6)),className:"w-full bg-black/20 border border-white/10 p-4 text-center text-2xl font-mono tracking-[0.5em] text-white focus:outline-none focus:border-accent transition-colors",placeholder:"000000",required:!0})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"button",onClick:d,disabled:c,className:"text-xs text-accent hover:text-white underline disabled:opacity-50",children:"Resend Code"})}),e.jsx(L,{type:"submit",variant:"accent",fullWidth:!0,disabled:c||m.length<6,children:c?"Verifying...":"Verify Email"}),e.jsx("button",{type:"button",onClick:()=>y(!1),className:"w-full text-xs text-gray-500 hover:text-white transition-colors mt-4",children:"Incorrect email? Go back"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-8 text-center",children:[e.jsx("h1",{className:"text-3xl font-display font-bold text-white mb-2",children:"Join Campus Nodes"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Create an account to start trading & connecting"})]}),s&&e.jsx("div",{className:"mb-4 p-3 bg-red-500/10 border border-red-500/50 text-red-500 text-xs rounded-sm",children:s}),e.jsxs("form",{onSubmit:k,className:"space-y-5",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs uppercase tracking-wider text-gray-500 mb-2 font-bold",children:"First Name"}),e.jsx("input",{type:"text",name:"firstName",value:u.firstName,onChange:C,className:"w-full bg-black/20 border border-white/10 p-3 text-white focus:outline-none focus:border-accent transition-colors text-sm",placeholder:"Rohan",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs uppercase tracking-wider text-gray-500 mb-2 font-bold",children:"Last Name"}),e.jsx("input",{type:"text",name:"lastName",value:u.lastName,onChange:C,className:"w-full bg-black/20 border border-white/10 p-3 text-white focus:outline-none focus:border-accent transition-colors text-sm",placeholder:"Sharma",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs uppercase tracking-wider text-gray-500 mb-2 font-bold",children:"Email Address"}),e.jsx("input",{type:"email",name:"email",value:u.email,onChange:C,className:"w-full bg-black/20 border border-white/10 p-3 text-white focus:outline-none focus:border-accent transition-colors text-sm",placeholder:"john.doe@gmail.com",required:!0}),e.jsx("p",{className:"text-[10px] text-gray-500 mt-1",children:"Please use your Gmail address for verification."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs uppercase tracking-wider text-gray-500 mb-2 font-bold",children:"Create Password"}),e.jsx("input",{type:"password",name:"password",value:u.password,onChange:C,className:"w-full bg-black/20 border border-white/10 p-3 text-white focus:outline-none focus:border-accent transition-colors text-sm",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",required:!0})]}),e.jsxs("div",{className:"pt-2",children:[e.jsxs("div",{className:"flex items-start gap-2 mb-4",children:[e.jsx("input",{type:"checkbox",className:"mt-1 bg-black border-white/20 accent-accent",required:!0}),e.jsxs("span",{className:"text-xs text-gray-400 leading-tight",children:["I agree to the ",e.jsx("a",{href:"#",className:"text-white hover:underline",children:"Terms of Service"})," and ",e.jsx("a",{href:"#",className:"text-white hover:underline",children:"Privacy Policy"}),"."]})]}),e.jsx(L,{type:"submit",variant:"primary",fullWidth:!0,disabled:c,children:c?"Sending Code...":"Create Account"})]})]}),e.jsxs("div",{className:"mt-8 text-center text-sm text-gray-400",children:["Already have an account? ",e.jsx($,{to:"/login",className:"text-white hover:text-accent font-bold transition-colors",children:"Sign In"})]})]})})]})},Lt=()=>{const{user:t,signOut:n}=O(),[c,l]=r.useState(!1),[s,a]=r.useState(!1),[x,y]=r.useState(!1),[h,j]=r.useState(!1),m=r.useRef(null),[f,S]=r.useState({firstName:t?.user_metadata?.first_name||"",lastName:t?.user_metadata?.last_name||"",bio:t?.user_metadata?.bio||""});if(r.useEffect(()=>{V({targets:".trust-score-counter",innerHTML:[0,95],round:1,easing:"easeInOutExpo",duration:2e3}),V({targets:".trust-ring-path",strokeDashoffset:[283,283-283*95/100],easing:"easeInOutExpo",duration:2500,delay:500})},[]),!t)return e.jsx("div",{className:"pt-32 px-12 text-white",children:"Please log in to view profile."});const b=t.user_metadata?.first_name?t.user_metadata.first_name[0]:t.email[0].toUpperCase(),o=t.user_metadata?.avatar_url,u=()=>{l(!0)},P=async()=>{await n(),l(!1)},C=async d=>{d.preventDefault(),y(!0);const{error:p}=await w.auth.updateUser({data:{first_name:f.firstName,last_name:f.lastName,bio:f.bio}}),{error:_}=await w.from("profiles").update({first_name:f.firstName,last_name:f.lastName,bio:f.bio}).eq("id",t.id);y(!1),_&&console.error("Profile update failed:",_),!p&&!_&&a(!1)},k=async d=>{try{j(!0);const p=d.target.files[0];if(!p)return;const _=p.name.split(".").pop(),g=`${`${t.id}/${Date.now()}.${_}`}`,{error:i}=await w.storage.from("avatars").upload(g,p);if(i)throw i;const{data:{publicUrl:v}}=w.storage.from("avatars").getPublicUrl(g),{error:z}=await w.auth.updateUser({data:{avatar_url:v}});if(await w.from("profiles").update({avatar_url:v}).eq("id",t.id),z||z)throw z}catch(p){console.error("Error uploading avatar:",p.message),alert(`Error: ${p.message}`)}finally{j(!1)}},E=async()=>{try{j(!0);const{error:d}=await w.auth.updateUser({data:{avatar_url:null}});if(await w.from("profiles").update({avatar_url:null}).eq("id",t.id),d)throw d}catch(d){console.error("Error removing avatar:",d.message)}finally{j(!1)}};return e.jsxs("div",{className:"min-h-screen bg-background pt-32 pb-20 px-6 md:px-12",children:[e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-8 items-start mb-12 relative group/profile",children:[!s&&e.jsxs("div",{className:"absolute top-0 right-0 flex gap-2 z-50",children:[e.jsx("button",{onClick:u,className:"p-3 text-red-500 hover:text-red-400 border border-red-500/30 rounded-full hover:bg-red-500/10 transition-colors",title:"Sign Out",children:e.jsx(Ye,{size:20})}),e.jsx("button",{onClick:d=>{d.preventDefault(),a(!0)},className:"p-3 text-gray-400 hover:text-white border border-white/10 rounded-full hover:bg-white/10 transition-colors cursor-pointer",title:"Edit Profile",children:e.jsx(Ke,{size:20})})]}),e.jsxs("div",{className:"relative group w-32 h-32 shrink-0",children:[e.jsx("div",{className:"w-full h-full rounded-full bg-gradient-to-br from-gray-800 to-black border-2 border-white/20 flex items-center justify-center text-4xl font-bold text-white shadow-2xl overflow-hidden relative",children:h?e.jsx(Xe,{className:"animate-spin text-white",size:32}):o?e.jsx("img",{src:o,alt:"Profile",className:"w-full h-full object-cover"}):b}),e.jsxs("div",{className:"absolute inset-0 bg-black/60 rounded-full opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-center justify-center gap-2 backdrop-blur-sm z-10",children:[e.jsx("button",{onClick:()=>m.current.click(),className:"p-2 bg-white/10 rounded-full hover:bg-white/20 text-white transition-colors",title:"Upload Photo",children:e.jsx(we,{size:18})}),o&&e.jsx("button",{onClick:E,className:"p-2 bg-red-500/20 rounded-full hover:bg-red-500/40 text-red-500 transition-colors",title:"Remove Photo",children:e.jsx(ee,{size:18})})]}),e.jsx("input",{type:"file",ref:m,onChange:k,className:"hidden",accept:"image/*"})]}),e.jsx("div",{className:"flex-1 w-full relative",children:s?e.jsxs("form",{onSubmit:C,className:"bg-white/5 border border-white/10 p-6 rounded-lg space-y-4 animate-fade-in relative",children:[e.jsx("button",{type:"button",onClick:()=>a(!1),className:"absolute top-4 right-4 text-gray-400 hover:text-white",children:e.jsx(D,{size:20})}),e.jsx("h3",{className:"text-xl font-bold text-white mb-4",children:"Edit Profile"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs uppercase tracking-wider text-gray-500 mb-1",children:"First Name"}),e.jsx("input",{type:"text",value:f.firstName,onChange:d=>S({...f,firstName:d.target.value}),className:"w-full bg-black border border-white/20 p-2 text-white focus:border-accent outline-none rounded"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs uppercase tracking-wider text-gray-500 mb-1",children:"Last Name"}),e.jsx("input",{type:"text",value:f.lastName,onChange:d=>S({...f,lastName:d.target.value}),className:"w-full bg-black border border-white/20 p-2 text-white focus:border-accent outline-none rounded"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs uppercase tracking-wider text-gray-500 mb-1",children:"Bio"}),e.jsx("textarea",{rows:"3",value:f.bio,onChange:d=>S({...f,bio:d.target.value}),className:"w-full bg-black border border-white/20 p-2 text-white focus:border-accent outline-none rounded"})]}),e.jsxs("button",{type:"submit",disabled:x,className:"px-6 py-2 bg-white text-black font-bold uppercase tracking-widest hover:bg-gray-200 transition-colors rounded flex items-center gap-2",children:[e.jsx(Je,{size:16})," ",x?"Saving...":"Save Changes"]})]}):e.jsxs("div",{className:"animate-fade-in",children:[e.jsxs("h1",{className:"text-4xl font-display font-bold text-white mb-2",children:[t.user_metadata?.first_name||"Student"," ",t.user_metadata?.last_name||""]}),e.jsx("p",{className:"text-gray-400 mb-4",children:t.email}),e.jsx("p",{className:"text-gray-300 italic mb-6 max-w-xl",children:t.user_metadata?.bio||"No bio yet."}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-6 bg-white/5 border border-white/10 rounded-xl flex flex-col items-center justify-center relative overflow-hidden group",children:[e.jsx("div",{className:"absolute inset-0 bg-accent/5 opacity-0 group-hover:opacity-100 transition-opacity"}),e.jsxs("div",{className:"relative w-32 h-32 flex items-center justify-center mb-4",children:[e.jsxs("svg",{className:"absolute inset-0 w-full h-full rotate-[-90deg]",viewBox:"0 0 100 100",children:[e.jsx("circle",{cx:"50",cy:"50",r:"45",fill:"none",stroke:"#222",strokeWidth:"2"}),e.jsx("circle",{className:"trust-ring-path",cx:"50",cy:"50",r:"45",fill:"none",stroke:"#fff",strokeWidth:"2",strokeDasharray:"283",strokeDashoffset:"283",strokeLinecap:"round"})]}),e.jsx("div",{className:"text-center z-10",children:e.jsx("span",{className:"trust-score-counter text-3xl font-display font-bold text-white",children:"0"})})]}),e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wider font-bold",children:"Trust Score"})]}),e.jsxs("div",{className:"p-4 bg-white/5 border border-white/10 rounded flex items-center gap-3",children:[e.jsx(je,{className:"text-blue-400",size:20}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wider",children:"Major"}),e.jsx("p",{className:"text-white",children:"Computer Engineering"})]})]})]})]})})]}),e.jsxs("div",{className:"mt-8 border-t border-white/10 pt-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-6",children:"Recent Activity"}),e.jsx("div",{className:"p-12 text-center border border-dashed border-white/10 rounded-lg text-gray-500",children:"No recent trades or services."})]})]}),c&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center px-4",children:[e.jsx("div",{className:"absolute inset-0 bg-transparent",onClick:()=>l(!1)}),e.jsxs("div",{className:"relative bg-black border border-white/10 p-6 rounded-xl w-full max-w-sm shadow-2xl animate-fade-in",children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"Sign Out"}),e.jsx("p",{className:"text-gray-400 mb-6",children:"Are you sure you want to sign out of your account?"}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>l(!1),className:"px-4 py-2 text-sm font-medium text-gray-300 hover:text-white transition-all border border-transparent hover:border-white hover:shadow-[0_0_15px_rgba(255,255,255,0.2)] rounded",children:"Cancel"}),e.jsx("button",{onClick:P,className:"px-4 py-2 text-sm font-bold bg-red-600 hover:bg-red-500 text-white rounded transition-all shadow-lg hover:shadow-[0_0_20px_rgba(220,38,38,0.6)]",children:"Sign Out"})]})]})]})]})},$t=()=>e.jsxs("div",{className:"min-h-screen bg-background flex flex-col justify-center items-center",children:[e.jsx(te,{className:"w-20 h-20 mb-8 opacity-50"}),e.jsx("h1",{className:"text-2xl font-display font-bold text-white tracking-widest",children:"SETTINGS"}),e.jsx("p",{className:"text-gray-500 mt-2",children:"Nothing to see here yet."})]}),Dt=()=>e.jsxs("div",{className:"min-h-screen bg-background flex flex-col justify-center items-center",children:[e.jsx(te,{className:"w-16 h-16 mb-8"}),e.jsxs("h1",{className:"text-3xl font-display font-bold text-white tracking-widest uppercase text-center max-w-lg leading-relaxed",children:["Payment Gateway ",e.jsx("br",{})," Integration Pending"]}),e.jsx("p",{className:"text-gray-500 mt-4 text-sm",children:"This is a secure checkout placeholder."})]}),Ft=()=>{const{id:t}=Ze(),n=W(),{addToCart:c}=xt(),{user:l}=O(),{openAuthModal:s}=B(),a=ie.find(m=>m.id===parseInt(t)),[x,y]=r.useState(0),h=()=>{if(!l){s();return}n("/payment")},j=()=>{if(!l){s();return}c(a)};return a?e.jsx("div",{className:"min-h-screen bg-background pt-24 pb-20 px-6 md:px-12",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("button",{onClick:()=>n(-1),className:"flex items-center gap-2 text-gray-400 hover:text-white mb-8 transition-colors",children:[e.jsx(be,{size:20})," Back to Market"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-12",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"aspect-[4/3] bg-surface border border-white/10 rounded-lg overflow-hidden relative",children:a.images&&a.images.length>0?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:a.images[x],alt:a.title,className:"w-full h-full object-cover",onError:m=>{m.currentTarget.style.display="none";const f=m.currentTarget.parentElement.querySelector(".fallback-placeholder");f&&f.classList.remove("hidden"),f&&f.classList.add("flex")}}),e.jsxs("div",{className:"fallback-placeholder hidden absolute inset-0 bg-zinc-900 flex-col items-center justify-center gap-4",children:[e.jsx("div",{className:"w-24 h-24 rounded-full bg-white/5 flex items-center justify-center border border-white/10",children:e.jsx("span",{className:"font-display font-bold text-5xl text-white",children:"C"})}),e.jsx("p",{className:"text-gray-400 font-bold uppercase tracking-widest text-xs",children:"Seller did not upload an image"})]})]}):e.jsxs("div",{className:"absolute inset-0 bg-zinc-900 flex flex-col items-center justify-center gap-4",children:[e.jsx("div",{className:"w-24 h-24 rounded-full bg-white/5 flex items-center justify-center border border-white/10",children:e.jsx("span",{className:"font-display font-bold text-5xl text-white",children:"C"})}),e.jsx("p",{className:"text-gray-400 font-bold uppercase tracking-widest text-xs",children:"Seller did not upload an image"})]})}),a.images&&a.images.length>1&&e.jsx("div",{className:"flex gap-4 overflow-x-auto pb-2",children:a.images.map((m,f)=>e.jsx("button",{onClick:()=>y(f),className:`w-24 h-24 shrink-0 rounded-lg overflow-hidden border-2 transition-all ${x===f?"border-accent":"border-transparent opacity-50 hover:opacity-100"}`,children:e.jsx("img",{src:m,alt:"",className:"w-full h-full object-cover"})},f))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("span",{className:"text-accent font-bold uppercase tracking-wider text-sm",children:a.category}),e.jsxs("div",{className:"flex items-center gap-1 text-yellow-500",children:[e.jsx(oe,{size:16,fill:"currentColor"}),e.jsx("span",{className:"text-white font-bold",children:a.trustScore})]})]}),e.jsx("h1",{className:"text-4xl md:text-5xl font-display font-bold text-white mb-4",children:a.title}),e.jsx("p",{className:"text-3xl text-white font-light mb-8",children:a.price}),e.jsxs("div",{className:"bg-surface border border-white/5 p-6 rounded-lg mb-8",children:[e.jsx("p",{className:"text-gray-300 leading-relaxed mb-4",children:a.description||"No description provided."}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Sold by ",e.jsxs("span",{className:"text-white font-bold",children:["@",a.seller]})]})]}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs(L,{onClick:h,variant:"primary",fullWidth:!0,className:"flex items-center justify-center gap-2",children:[e.jsx(Qe,{size:18})," Buy Now"]}),e.jsxs(L,{onClick:j,variant:"outline",fullWidth:!0,className:"flex items-center justify-center gap-2",children:[e.jsx(et,{size:18})," Add to Cart"]})]})]})]})]})}):e.jsx("div",{className:"text-white pt-32 text-center",children:"Product not found"})},me="8.1.0",Ot=[{title:"Desktop Navigation Redesign",description:"New floating top bar! Hover to see icons expand. Profile moved to top-right. ðŸ§­"},{title:"Full-Width Layout",description:"Removed the sidebar padding for a more immersive, edge-to-edge experience on desktop."},{title:"Social Feed (Forum)",description:"A new Twitter-like feed to share thoughts with the campus! ðŸ“¢"},{title:"New Mobile Navigation",description:"Reordered for better access: Home is now first! ðŸ "},{title:"Services Smart-Menu",description:"Clicking Services now opens a drawer to choose between Marketplace Gigs or the new Forum."},{title:"OTP Verification Fix",description:"Fixed critical email verification error that prevented users from completing signup."},{title:"Enhanced Error Handling",description:"Added detailed debug logging and better error messages for troubleshooting verification issues."},{title:"Chat Crash Fix",description:"Resolved ChatWidget crash that occurred when non-logged-in users tried to open chat."},{title:"Vercel Deployment",description:"Migrated to Vercel for faster builds, better performance, and preview deployments."},{title:"Publishing Workflow Update",description:"Added changelog documentation to publishing process for better release tracking."},{title:"Lighter & Faster",description:"Removed heavy 3D rendering. The app now loads faster and uses less resources."},{title:"Mobile Text Fix",description:"Loading screen text now wraps properly on smaller screens."},{title:"End-to-End Encrypted Chat",description:"Your messages are encrypted client-side. Only you and your friend can read them."},{title:"Storage Optimization",description:"Removing a friend clears chat history to save database space."},{title:"New Sidebar Style",description:"Updated sidebar design with edge-to-edge selection indicators (Supabase-style)."},{title:"Jelly Mode Activated",description:"The sidebar now bounces with a fun elastic animation! ðŸ€"},{title:"Smoother Navigation",description:"The sidebar now glides open and closed with enhanced animation physics."},{title:"Mobile Bottom Bar",description:"New 5-icon navigation bar: Services, Market, Home, Chat, and Profile."}],qt=()=>{const[t,n]=r.useState(!1),[c,l]=r.useState(!1),[s,a]=r.useState(!1),x=G();r.useEffect(()=>{const h=()=>a(window.innerWidth<768);return h(),window.addEventListener("resize",h),()=>window.removeEventListener("resize",h)},[]),r.useEffect(()=>{const h=x.pathname==="/"||x.pathname==="/campusnodes/"||x.pathname==="/CampusNodes/";n(!!h)},[x]);const y=()=>{n(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(F,{children:t&&e.jsx(I.div,{initial:{y:-50,x:"-50%",opacity:0},animate:{y:0,x:"-50%",opacity:1},exit:{y:-50,x:"-50%",opacity:0},className:"fixed top-32 left-1/2 -translate-x-1/2 w-[95%] md:w-auto min-w-[320px] md:min-w-[500px] z-[40] group",children:e.jsx("div",{className:"relative overflow-hidden rounded-full bg-black/80 backdrop-blur-md border border-blue-500/30 shadow-[0_0_15px_rgba(59,130,246,0.1)] transition-all duration-300 hover:shadow-[0_0_25px_rgba(59,130,246,0.4)] hover:border-blue-500/50",children:e.jsxs("div",{className:"px-4 py-2 flex items-center justify-between gap-4 text-xs md:text-sm",children:[e.jsxs("div",{className:"flex items-center gap-3 text-white shrink-0",children:[e.jsx("span",{className:"bg-blue-600 text-white font-bold px-2 py-0.5 rounded text-[10px] uppercase tracking-wider shadow-[0_0_10px_rgba(37,99,235,0.4)]",children:"New"}),e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx(re,{size:12,className:"text-blue-400 animate-pulse"}),e.jsx("span",{className:"text-gray-200",children:"Updated to"}),e.jsx("span",{className:"font-bold font-mono text-blue-400",children:me})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I.button,{onClick:()=>l(!0),initial:"idle",whileHover:"hover",animate:"idle",className:"relative flex items-center justify-center h-8 rounded-full transition-all duration-300 border border-transparent",children:e.jsxs(I.div,{variants:{idle:{width:"auto",paddingLeft:0,paddingRight:0,backgroundColor:"rgba(59, 130, 246, 0)"},hover:s?{width:"auto",paddingLeft:0,paddingRight:0,backgroundColor:"rgba(59, 130, 246, 0)"}:{width:"auto",paddingLeft:"12px",paddingRight:"12px",backgroundColor:"rgba(37, 99, 235, 1)"}},className:"flex items-center gap-2 overflow-hidden h-full rounded-full",children:[e.jsx("span",{className:"flex items-center justify-center w-8 h-8 rounded-full shrink-0 bg-blue-500/0 hover:bg-blue-500 hover:shadow-[0_0_15px_rgba(59,130,246,0.6)] transition-all duration-300 group/btn",children:e.jsx(tt,{size:14,className:"text-blue-400 group-hover/btn:text-white transition-colors"})}),!s&&e.jsx(I.span,{variants:{idle:{width:0,opacity:0,display:"none"},hover:{width:"auto",opacity:1,display:"block"}},transition:{duration:.2},className:"whitespace-nowrap font-medium text-white",children:"Patch Notes"})]})}),e.jsx(I.button,{onClick:y,initial:"idle",whileHover:"hover",animate:"idle",className:"relative flex items-center justify-center h-8 rounded-full transition-all duration-300 border border-transparent",children:e.jsxs(I.div,{variants:{idle:{width:"auto",paddingLeft:0,paddingRight:0,backgroundColor:"rgba(239, 68, 68, 0)"},hover:s?{width:"auto",paddingLeft:0,paddingRight:0,backgroundColor:"rgba(239, 68, 68, 0)"}:{width:"auto",paddingLeft:"12px",paddingRight:"12px",backgroundColor:"rgba(220, 38, 38, 1)"}},className:"flex items-center gap-2 overflow-hidden h-full rounded-full",children:[e.jsx("span",{className:"flex items-center justify-center w-8 h-8 rounded-full shrink-0 bg-red-500/0 hover:bg-red-500 hover:shadow-[0_0_15px_rgba(239,68,68,0.6)] transition-all duration-300 group/btn",children:e.jsx(D,{size:14,className:"text-red-400 group-hover/btn:text-white transition-colors"})}),!s&&e.jsx(I.span,{variants:{idle:{width:0,opacity:0,display:"none"},hover:{width:"auto",opacity:1,display:"block"}},transition:{duration:.2},className:"whitespace-nowrap font-medium text-white",children:"Close"})]})})]})]})})})}),e.jsx(F,{children:c&&e.jsxs("div",{className:"fixed inset-0 z-[110] flex items-center justify-center p-4",children:[e.jsx(I.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>l(!1),className:"absolute inset-0 bg-black/80"}),e.jsxs(I.div,{initial:{scale:.9,opacity:0,y:20},animate:{scale:1,opacity:1,y:0},exit:{scale:.9,opacity:0,y:20},className:"relative bg-[#0f1115] border border-blue-500/20 w-full max-w-lg rounded-2xl shadow-[0_0_50px_rgba(59,130,246,0.15)] overflow-hidden flex flex-col max-h-[70vh]",children:[e.jsxs("div",{className:"p-6 border-b border-white/5 bg-gradient-to-r from-blue-900/20 to-transparent flex items-center justify-between shrink-0",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:[e.jsx(re,{className:"text-blue-400",size:20}),"Patch Notes"]}),e.jsxs("p",{className:"text-blue-400/60 text-xs font-mono mt-1",children:["Version ",me]})]}),e.jsx("button",{onClick:()=>l(!1),className:"p-2 hover:bg-white/10 rounded-full transition-colors text-gray-400 hover:text-white",children:e.jsx(D,{size:20})})]}),e.jsx("div",{className:"p-6 overflow-y-auto custom-scrollbar",children:e.jsx("div",{className:"space-y-6",children:Ot.map((h,j)=>e.jsxs("div",{className:"group",children:[e.jsxs("h3",{className:"text-white font-medium mb-1 group-hover:text-blue-400 transition-colors flex items-center gap-2",children:[e.jsx(ve,{size:14,className:"text-blue-500/50 group-hover:text-blue-500 transition-colors"}),h.title]}),e.jsx("p",{className:"text-gray-400 text-sm leading-relaxed pl-6",children:h.description})]},j))})}),e.jsx("div",{className:"p-4 border-t border-white/5 bg-black/20 shrink-0 text-center",children:e.jsx("p",{className:"text-xs text-gray-500",children:"Thank you for being part of our beta."})})]})]})})]})},Ut=()=>{const{isAuthModalOpen:t,closeAuthModal:n}=B(),c=W(),l=s=>{n(),c(s)};return e.jsx(F,{children:t&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center px-4",children:[e.jsx(I.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:n,className:"absolute inset-0 bg-transparent"}),e.jsxs(I.div,{initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},className:"relative bg-black border border-white/10 p-8 rounded-2xl w-full max-w-sm shadow-2xl z-10",children:[e.jsx("button",{onClick:n,className:"absolute top-4 right-4 text-gray-500 hover:text-white transition-colors",children:e.jsx(D,{size:20})}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h2",{className:"text-2xl font-display font-bold text-white mb-2",children:"Join Campus Nodes"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Connect, trade, and collaborate with your campus community."})]}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("button",{onClick:()=>l("/signup"),className:"w-full py-3 bg-white text-black font-bold uppercase tracking-wider rounded flex items-center justify-center gap-2 transition-all shadow-[0_0_15px_rgba(255,255,255,0.3)] hover:shadow-[0_0_25px_rgba(255,255,255,0.5)] hover:scale-[1.02]",children:[e.jsx(st,{size:18}),"Sign Up"]}),e.jsxs("button",{onClick:()=>l("/login"),className:"w-full py-3 border border-white/10 hover:border-white text-white font-medium uppercase tracking-wider rounded flex items-center justify-center gap-2 transition-all hover:shadow-[0_0_15px_rgba(255,255,255,0.2)] hover:scale-[1.02]",children:[e.jsx(rt,{size:18}),"Sign In"]})]})]})]})})},Wt=()=>{const{user:t}=O(),{isChatOpen:n,openChat:c,closeChat:l,addUnreadSender:s,removeUnreadSender:a,unreadSenders:x,openAuthModal:y}=B(),[h,j]=r.useState(null),[m,f]=r.useState([]),[S,b]=r.useState([]),[o,u]=r.useState(""),[P,C]=r.useState(!1),k=r.useRef(null),E=()=>{k.current?.scrollIntoView({behavior:"smooth"})};r.useEffect(()=>{if(!t)return;const g=w.channel("global_chat_listener").on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:`receiver_id=eq.${t.id}`},i=>{(!n||h&&h.id!==i.new.sender_id||!h)&&s(i.new.sender_id)}).subscribe();return()=>{w.removeChannel(g)}},[t,n,h]),r.useEffect(()=>{h&&a(h.id)},[h]),r.useEffect(()=>{n&&t&&d()},[n,t]),r.useEffect(()=>{if(h){p(h.id);const g=w.channel(`chat:${h.id}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:`sender_id=eq.${h.id}`},i=>{if(i.new.receiver_id===t.id){const v=H(i.new.content,i.new.sender_id,i.new.receiver_id),z={...i.new,content:v};b(R=>[...R,z]),E()}}).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:`sender_id=eq.${t.id}`},i=>{if(i.new.receiver_id===h.id){const v=H(i.new.content,i.new.sender_id,i.new.receiver_id),z={...i.new,content:v};b(R=>R.find(T=>T.id===i.new.id)?R:[...R,z]),E()}}).subscribe();return()=>{w.removeChannel(g)}}},[h,t]);const d=async()=>{try{const{data:g,error:i}=await w.from("friendships").select("*").or(`user1_id.eq.${t.id},user2_id.eq.${t.id}`).eq("status","accepted");if(i)throw i;const v=g.map(R=>R.user1_id===t.id?R.user2_id:R.user1_id);if(v.length===0){f([]);return}const{data:z}=await w.from("profiles").select("*").in("id",v);f(z||[])}catch(g){console.error(g)}},p=async g=>{try{C(!0);const i=new Date(Date.now()-1440*60*1e3).toISOString(),{data:v,error:z}=await w.from("messages").select("*").or(`and(sender_id.eq.${t.id},receiver_id.eq.${g}),and(sender_id.eq.${g},receiver_id.eq.${t.id})`).gt("created_at",i).order("created_at",{ascending:!0}).limit(100);if(z)throw z;const R=v.filter(T=>!(T.sender_id===t.id&&T.deleted_by_sender||T.receiver_id===t.id&&T.deleted_by_receiver)).map(T=>({...T,content:H(T.content,T.sender_id,T.receiver_id)}));b(R||[]),setTimeout(E,100)}catch(i){console.error(i)}finally{C(!1)}},_=async()=>{if(!(!h||!confirm("Clear chat history? This cannot be undone.")))try{await w.from("messages").update({deleted_by_sender:!0}).eq("sender_id",t.id).eq("receiver_id",h.id),await w.from("messages").update({deleted_by_receiver:!0}).eq("receiver_id",t.id).eq("sender_id",h.id),b([])}catch(g){console.error("Failed to clear chat",g)}},N=async g=>{if(g.preventDefault(),!o.trim()||!h)return;const i=o.trim();u("");const v={id:Date.now(),sender_id:t.id,receiver_id:h.id,content:i,created_at:new Date().toISOString(),is_temp:!0};b(z=>[...z,v]),E();try{const z=Me(i,t.id,h.id),{error:R,data:T}=await w.from("messages").insert({sender_id:t.id,receiver_id:h.id,content:z}).select();if(R)throw R;const q=T[0],Y={...q,content:H(q.content,q.sender_id,q.receiver_id)};b(se=>se.map(K=>K.id===v.id?Y:K))}catch(z){console.error("Failed to send",z)}};return e.jsx(e.Fragment,{children:e.jsx(F,{children:n&&e.jsxs(I.div,{initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},transition:{type:"spring",stiffness:300,damping:30},className:`fixed z-[60] bg-black border-b border-white/20 shadow-2xl overflow-hidden\r
                                   inset-x-0 top-0 bottom-24 md:z-[9999] md:border md:inset-auto md:bottom-6 md:right-6 md:w-96 md:h-[500px] md:rounded-2xl flex flex-col`,children:[e.jsxs("div",{className:"h-16 bg-black/50 backdrop-blur-md border-b border-white/10 flex items-center justify-between px-4 shrink-0",children:[e.jsx("div",{className:"flex items-center gap-3",children:h?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>j(null),className:"md:hidden p-1 hover:bg-white/10 rounded-full",children:e.jsx(X,{size:24})}),e.jsx("button",{onClick:()=>j(null),className:"hidden md:block p-1 hover:bg-white/10 rounded-full mr-1",children:e.jsx(X,{size:18})}),e.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-700 overflow-hidden border border-white/20",children:h.avatar_url?e.jsx("img",{src:h.avatar_url,alt:"",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-xs",children:h.first_name?.[0]})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-white text-sm",children:[h.first_name," ",h.last_name]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500 animate-pulse"}),e.jsx("span",{className:"text-[10px] text-gray-400",children:"Online"})]})]})]}):e.jsxs("h3",{className:"font-bold text-white text-lg flex items-center gap-2",children:[e.jsx(ne,{size:20,className:"text-accent"}),"Messages ",e.jsx(ye,{size:12,className:"text-green-500/50 ml-1",title:"End-to-End Encrypted"})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[h&&e.jsx("button",{onClick:_,className:"p-2 hover:bg-white/10 rounded-full text-gray-400 hover:text-red-500 transition-colors",title:"Clear Chat",children:e.jsx(ee,{size:18})}),e.jsx("button",{onClick:l,className:"hidden md:block p-2 hover:bg-white/10 rounded-full text-gray-400 hover:text-white",children:e.jsx(D,{size:20})})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto bg-zinc-900/50 relative",children:[h&&e.jsx("div",{className:"sticky top-4 z-10 flex justify-center w-full pointer-events-none mb-2",children:e.jsxs("div",{className:"bg-black/60 backdrop-blur-md border border-white/10 px-3 py-1 rounded-full flex items-center gap-1.5 shadow-xl",children:[e.jsx(at,{size:12,className:"text-accent"}),e.jsx("span",{className:"text-[10px] text-white font-medium",children:"1-Day Disappearing Messages"})]})}),h?e.jsxs("div",{className:"p-4 space-y-4 min-h-full flex flex-col justify-end",children:[S.map((g,i)=>e.jsx("div",{className:`flex ${g.sender_id===t.id?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[75%] px-4 py-2 rounded-2xl text-sm ${g.sender_id===t.id?"bg-accent text-black rounded-tr-sm":"bg-white/10 text-white rounded-tl-sm border border-white/10"}`,children:[e.jsx("p",{children:g.content}),e.jsx("span",{className:`text-[9px] block mt-1 opacity-50 ${g.sender_id===t.id?"text-black":"text-gray-400"}`,children:new Date(g.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})},g.id||i)),e.jsx("div",{ref:k})]}):e.jsx("div",{className:"p-4 space-y-2",children:m.length===0?e.jsxs("div",{className:"text-center text-gray-500 mt-10",children:[e.jsx("p",{children:"No friends yet."}),e.jsx("p",{className:"text-xs",children:"Connect with people to chat!"})]}):m.map(g=>e.jsxs("button",{onClick:()=>j(g),className:"w-full p-3 rounded-lg hover:bg-white/5 flex items-center gap-3 transition-colors text-left group border border-transparent hover:border-white/10 relative",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-700 overflow-hidden border border-white/10 group-hover:border-accent/50 transition-colors",children:g.avatar_url?e.jsx("img",{src:g.avatar_url,alt:"",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-400",children:e.jsx(J,{size:20})})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h4",{className:"font-bold text-white text-sm",children:[g.first_name," ",g.last_name]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Click to chat"})]}),x.has(g.id)&&e.jsx("div",{className:"w-3 h-3 bg-accent rounded-full animate-pulse shadow-[0_0_10px_rgba(34,211,238,0.5)]"})]},g.id))})]}),h&&e.jsxs("form",{onSubmit:N,className:"p-3 bg-black/50 border-t border-white/10 shrink-0 flex gap-2",children:[e.jsx("input",{type:"text",value:o,onChange:g=>u(g.target.value),placeholder:"Type a message...",className:"flex-1 bg-white/5 border border-white/10 rounded-full px-4 py-2 text-sm text-white focus:outline-none focus:border-accent/50 transition-colors"}),e.jsx("button",{type:"submit",disabled:!o.trim(),className:"w-9 h-9 bg-accent text-black rounded-full flex items-center justify-center hover:scale-105 active:scale-95 disabled:opacity-50 disabled:hover:scale-100 transition-all font-bold",children:e.jsx(Ne,{size:16,className:o.trim()?"ml-0.5":""})})]})]})})})},Bt=()=>{const{pathname:t}=G();return r.useEffect(()=>{window.scrollTo(0,0)},[t]),null},Ht=()=>{const t=G(),n=t.pathname==="/"||t.pathname==="/campusnodes/"||t.pathname==="/CampusNodes/";return e.jsx("div",{className:`fixed inset-0 z-0 transition-opacity duration-1000 ${n?"opacity-100 pointer-events-auto":"opacity-10 pointer-events-none"}`,children:e.jsx(Ee,{})})},Vt=({children:t})=>{const n=G(),c=n.pathname==="/"||n.pathname==="/campusnodes/"||n.pathname==="/CampusNodes/";return e.jsx("div",{className:`min-h-screen text-white font-sans selection:bg-accent selection:text-white cursor-none relative z-10 transition-all duration-300 ${c?"bg-transparent":"bg-background"}`,children:t})},Gt=()=>e.jsx(dt,{children:e.jsx(ht,{children:e.jsx(ut,{children:e.jsxs(it,{children:[e.jsx(gt,{}),e.jsx(Bt,{}),e.jsx(qt,{}),e.jsx(Ht,{}),e.jsx(pt,{}),e.jsx(Vt,{children:e.jsxs(nt,{children:[e.jsx(A,{path:"/",element:e.jsx(bt,{})}),e.jsx(A,{path:"/market",element:e.jsx(jt,{})}),e.jsx(A,{path:"/services",element:e.jsx(Nt,{})}),e.jsx(A,{path:"/forum",element:e.jsx(_t,{})}),e.jsx(A,{path:"/connections",element:e.jsx(Ct,{})}),e.jsx(A,{path:"/login",element:e.jsx(Et,{})}),e.jsx(A,{path:"/signup",element:e.jsx(At,{})}),e.jsx(A,{path:"/profile",element:e.jsx(Lt,{})}),e.jsx(A,{path:"/messages",element:e.jsx(St,{})}),e.jsx(A,{path:"/settings",element:e.jsx($t,{})}),e.jsx(A,{path:"/payment",element:e.jsx(Dt,{})}),e.jsx(A,{path:"/market/:id",element:e.jsx(Ft,{})})]})}),e.jsx(Ut,{}),e.jsx(Wt,{}),e.jsx(ft,{})]})})})});class Yt extends ke.Component{constructor(n){super(n),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(n){return{hasError:!0,error:n}}componentDidCatch(n,c){console.error("Uncaught error:",n,c),this.setState({errorInfo:c})}render(){return this.state.hasError?e.jsxs("div",{className:"min-h-screen bg-black text-red-500 p-8 font-mono overflow-auto",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Something went wrong."}),e.jsxs("div",{className:"bg-gray-900 p-4 rounded border border-red-900",children:[e.jsx("h2",{className:"font-bold text-white",children:"Error Message:"}),e.jsx("pre",{className:"whitespace-pre-wrap",children:this.state.error&&this.state.error.toString()}),e.jsx("br",{}),e.jsx("h2",{className:"font-bold text-white",children:"Stack Trace:"}),e.jsx("pre",{className:"text-xs text-gray-400 whitespace-pre-wrap",children:this.state.errorInfo&&this.state.errorInfo.componentStack})]})]}):this.props.children}}lt.createRoot(document.getElementById("root")).render(e.jsx(ke.StrictMode,{children:e.jsx(Yt,{children:e.jsx(Gt,{})})}));
