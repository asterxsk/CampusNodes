import{c as Te,r,j as e,m as I,u as Y,a as q,L,A as V,C as ne,U as ee,W as ie,S as pe,M as le,b as fe,Z as Re,d as xe,e as oe,H as Ie,X as D,f as ge,g as te,h as be,T as $e,i as H,k as X,B as ve,P as Ae,l as Le,n as je,o as De,p as Oe,q as Fe,s as qe,t as J,v as he,w as se,x as we,y as ce,z as ye,I as Ue,D as We,E as Be,F as Ve,G as He,J as Ye,K as Ge,N as Ke,O as Xe,Q as Je,R as Ze,V as Qe,Y as et,_ as tt,$ as st,a0 as rt,a1 as $,a2 as Ne,a3 as at}from"./vendor-BrOCYUme.js";(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const m of a.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&i(m)}).observe(document,{childList:!0,subtree:!0});function c(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(s){if(s.ep)return;s.ep=!0;const a=c(s);fetch(s.href,a)}})();const nt="https://bvmcchnxpcvifcblbisa.supabase.co",it="sb_publishable_lfQTIS91bkBxwjrVzI-x6w_JE45Bmzg",k=Te(nt,it),ke=r.createContext({}),U=()=>r.useContext(ke),lt=({children:t})=>{const[l,c]=r.useState(null),[i,s]=r.useState(!0);r.useEffect(()=>{(async()=>{const{data:{session:d}}=await k.auth.getSession();c(d?.user??null),s(!1)})();const{data:{subscription:_}}=k.auth.onAuthStateChange((d,j)=>{c(j?.user??null),s(!1)});return()=>_.unsubscribe()},[]);const a=async()=>{await k.auth.signOut()};return e.jsx(ke.Provider,{value:{user:l,loading:i,signOut:a},children:!i&&t})},_e=r.createContext(),ot=({children:t})=>{const[l,c]=r.useState([]),i=a=>{c(m=>[...m,a])},s=a=>{c(m=>m.filter(_=>_.id!==a))};return e.jsx(_e.Provider,{value:{cartItems:l,addToCart:i,removeFromCart:s},children:t})},ct=()=>r.useContext(_e),Ce=r.createContext(),dt=({children:t})=>{const[l,c]=r.useState(new Set),[i,s]=r.useState(!1),[a,m]=r.useState(!1),[_,d]=r.useState(!0),j=()=>s(!0),g=()=>s(!1),p=()=>m(P=>!P),S=()=>m(!0),v=()=>m(!1),f=P=>{c(C=>{const y=new Set(C);return y.add(P),y})},h=P=>{c(C=>{const y=new Set(C);return y.delete(P),y})};return e.jsx(Ce.Provider,{value:{isAuthModalOpen:i,openAuthModal:j,closeAuthModal:g,isChatOpen:a,toggleChat:p,openChat:S,closeChat:v,unreadCount:l.size,unreadSenders:l,addUnreadSender:f,removeUnreadSender:h,isSidebarCollapsed:_,setIsSidebarCollapsed:d},children:t})},W=()=>{const t=r.useContext(Ce);if(!t)throw new Error("useUI must be used within a UIProvider");return t},Z=({className:t="w-10 h-10"})=>e.jsxs("svg",{viewBox:"0 0 100 100",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:t,children:[e.jsx("path",{d:"M 80 30 C 70 10, 30 10, 20 50 C 10 90, 70 90, 80 70",stroke:"white",strokeWidth:"4",strokeLinecap:"round"}),e.jsx("circle",{cx:"80",cy:"30",r:"6",fill:"white"}),e.jsx("circle",{cx:"20",cy:"50",r:"6",fill:"white"}),e.jsx("circle",{cx:"80",cy:"70",r:"6",fill:"white"}),e.jsx("line",{x1:"80",y1:"30",x2:"50",y2:"20",stroke:"white",strokeWidth:"2",opacity:"0.5"}),e.jsx("line",{x1:"50",y1:"20",x2:"20",y2:"50",stroke:"white",strokeWidth:"2",opacity:"0.5"}),e.jsx("line",{x1:"20",y1:"50",x2:"50",y2:"80",stroke:"white",strokeWidth:"2",opacity:"0.5"}),e.jsx("line",{x1:"50",y1:"80",x2:"80",y2:"70",stroke:"white",strokeWidth:"2",opacity:"0.5"}),e.jsx("circle",{cx:"50",cy:"20",r:"4",fill:"white"}),e.jsx("circle",{cx:"50",cy:"80",r:"4",fill:"white"})]}),re=({children:t})=>{const l=r.useRef(null),[c,i]=r.useState({x:0,y:0}),s=d=>{const{clientX:j,clientY:g}=d,{height:p,width:S,left:v,top:f}=l.current.getBoundingClientRect(),h=j-(v+S/2),P=g-(f+p/2);i({x:h*.3,y:P*.3})},a=()=>{i({x:0,y:0})},{x:m,y:_}=c;return e.jsx(I.div,{ref:l,className:"magnetic-wrap inline-block",onMouseMove:s,onMouseLeave:a,animate:{x:m,y:_},transition:{type:"spring",stiffness:150,damping:15,mass:.1},children:t})},xt=[{name:"Market",path:"/market",icon:e.jsx(pe,{size:20})},{name:"Services",path:"/services",icon:e.jsx(ie,{size:20})},{name:"Connections",path:"/connections",icon:e.jsx(fe,{size:20})},{name:"Chat",path:"/messages",icon:e.jsx(le,{size:20}),isMessages:!0}],ht=()=>{const{user:t}=U(),{openAuthModal:l,unreadCount:c,isSidebarCollapsed:i,setIsSidebarCollapsed:s}=W(),a=Y(),m=q(),_=()=>{t?m("/profile"):l()};return e.jsxs(e.Fragment,{children:[e.jsxs(I.div,{layout:!0,initial:!1,animate:{width:i?"72px":"260px",height:i?"auto":"100vh",top:i?"50%":"0%",y:i?"-50%":"0%",left:i?"12px":"0px",borderRadius:i?"24px":"0px"},transition:{type:"spring",stiffness:200,damping:25,mass:.8},className:"hidden md:flex flex-col fixed z-50 bg-black/90 backdrop-blur-xl border border-white/10 overflow-hidden shadow-2xl",children:[e.jsx("div",{className:`flex items-center w-full shrink-0 ${i?"py-4 justify-center":"h-20 px-6"}`,children:e.jsxs(L,{to:"/",className:"flex items-center gap-3 overflow-hidden",children:[e.jsx("div",{className:"shrink-0 scale-90",children:e.jsx(Z,{})}),e.jsx(V,{children:!i&&e.jsxs(I.span,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},exit:{opacity:0,x:-10},className:"font-display font-bold text-xl text-white whitespace-nowrap",children:[e.jsx("span",{className:"text-accent",children:"Campus"}),"Nodes"]})})]})}),e.jsx("div",{className:`flex-1 flex flex-col w-full py-2 ${i?"px-2 gap-2":"px-4 gap-1"}`,children:xt.map(d=>{const j=a.pathname===d.path;return e.jsx(L,{to:d.path,className:"block w-full",children:e.jsx(re,{children:e.jsxs("div",{className:`flex items-center relative group transition-all duration-300 rounded-xl
                                            ${i?"justify-center p-3":"px-4 py-3.5 gap-4"}
                                            ${j?"bg-accent/15 text-white":"text-gray-400 hover:text-white hover:bg-white/5"}
                                        `,children:[j&&e.jsx(I.div,{layoutId:"activeSidebar",className:"absolute inset-0 bg-accent/10 rounded-xl border border-accent/20",transition:{type:"spring",stiffness:300,damping:30}}),e.jsxs("div",{className:`relative z-10 transition-colors duration-300 ${j?"text-accent":"group-hover:text-white"}`,children:[d.icon,d.isMessages&&c>0&&i&&e.jsx("div",{className:"absolute -top-1.5 -right-1.5 w-3 h-3 bg-red-500 rounded-full border border-black"})]}),!i&&e.jsxs(I.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},exit:{opacity:0,x:-10},className:"flex-1 flex items-center justify-between z-10 overflow-hidden",children:[e.jsx("span",{className:"font-semibold whitespace-nowrap text-[15px]",children:d.name}),d.isMessages&&c>0&&e.jsx("span",{className:"bg-red-500 text-white text-[11px] font-bold px-2 py-0.5 rounded-full",children:c})]})]})})},d.name)})}),e.jsx("div",{className:`w-full shrink-0 ${i?"p-2 py-4 flex justify-center":"p-4"}`,children:e.jsxs("button",{onClick:()=>s(!i),className:`flex items-center transition-all bg-transparent hover:bg-white/5 rounded-xl text-gray-400 hover:text-white
                            ${i?"justify-center p-3":"px-4 py-3.5 gap-4 w-full"}
                        `,children:[e.jsx("div",{className:"w-5 h-5 flex items-center justify-center",children:e.jsx(ne,{size:20,className:`transition-transform duration-300 ${i?"":"rotate-180"}`})}),!i&&e.jsx("span",{className:"font-semibold text-[15px]",children:"Minimize"})]})}),e.jsx("div",{className:`w-full shrink-0 border-t border-white/10 ${i?"p-2 py-4":"p-4"}`,children:e.jsxs("button",{onClick:_,className:`flex items-center transition-all hover:bg-white/5 rounded-xl
                            ${i?"justify-center p-0":"p-2 gap-3 w-full"}
                        `,children:[e.jsx("div",{className:"w-9 h-9 rounded-full bg-gray-700 overflow-hidden border border-white/20 shrink-0 relative",children:t?.user_metadata?.avatar_url?e.jsx("img",{src:t.user_metadata.avatar_url,alt:"",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-xs font-bold text-white",children:t?.user_metadata?.first_name?t.user_metadata.first_name[0]:e.jsx(ee,{size:16})})}),!i&&e.jsx(I.div,{initial:{opacity:0},animate:{opacity:1},className:"text-left overflow-hidden flex-1",children:t?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm font-bold text-white truncate",children:t.user_metadata?.first_name}),e.jsx("p",{className:"text-xs text-gray-500 truncate",children:t.email})]}):e.jsx("p",{className:"text-sm font-medium text-gray-400",children:"Sign In"})})]})})]}),e.jsx("div",{className:"md:hidden fixed bottom-0 left-0 right-0 bg-black/95 backdrop-blur-xl border-t border-white/10 z-[70] safe-area-bottom pb-safe",children:e.jsxs("div",{className:"flex items-center justify-around py-2 px-2",children:[e.jsxs(L,{to:"/services",className:`flex flex-col items-center gap-1 py-1.5 px-3 rounded-xl transition-all ${a.pathname==="/services"?"text-accent":"text-white/50"}`,children:[e.jsx(ie,{size:22}),e.jsx("span",{className:"text-[10px] font-medium",children:"Services"})]}),e.jsxs(L,{to:"/market",className:`flex flex-col items-center gap-1 py-1.5 px-3 rounded-xl transition-all ${a.pathname==="/market"?"text-accent":"text-white/50"}`,children:[e.jsx(pe,{size:22}),e.jsx("span",{className:"text-[10px] font-medium",children:"Market"})]}),e.jsx("button",{onClick:_,className:`flex flex-col items-center gap-1 py-1 px-3 rounded-xl relative ${a.pathname==="/profile"?"text-accent":"text-white/50"}`,children:e.jsx("div",{className:`w-9 h-9 rounded-full overflow-hidden border-2 transition-all ${a.pathname==="/profile"?"border-accent scale-110":"border-white/20"}`,children:t?.user_metadata?.avatar_url?e.jsx("img",{src:t.user_metadata.avatar_url,alt:"",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-gray-700 flex items-center justify-center text-xs text-white",children:e.jsx(ee,{size:14})})})}),e.jsxs(L,{to:"/messages",className:`flex flex-col items-center gap-1 py-1.5 px-3 rounded-xl transition-all relative ${a.pathname==="/messages"?"text-accent":"text-white/50"}`,children:[e.jsxs("div",{className:"relative",children:[e.jsx(le,{size:22}),c>0&&e.jsx("div",{className:"absolute -top-1 -right-1.5 w-4 h-4 bg-red-500 rounded-full flex items-center justify-center border border-black",children:e.jsx("span",{className:"text-[8px] font-bold text-white",children:c})})]}),e.jsx("span",{className:"text-[10px] font-medium",children:"Chat"})]}),e.jsxs(L,{to:"/connections",className:`flex flex-col items-center gap-1 py-1.5 px-3 rounded-xl transition-all ${a.pathname==="/connections"?"text-accent":"text-white/50"}`,children:[e.jsx(fe,{size:22}),e.jsx("span",{className:"text-[10px] font-medium",children:"Social"})]})]})})]})},ut=()=>{const t=r.useRef(null),l=r.useRef(null),c=Y(),i=r.useRef({x:0,y:0}),s=r.useRef({x:0,y:0}),[a,m]=r.useState(!1),[_,d]=r.useState(!1),[j,g]=r.useState(!1),[p,S]=r.useState(!1);r.useEffect(()=>{S(window.matchMedia("(pointer: coarse)").matches)},[]);const v=.15;return r.useEffect(()=>{const P=C=>{const y=C.target.closest('a, button, [role="button"], input[type="submit"], .clickable');g(!!y)};return document.addEventListener("mouseover",P),()=>document.removeEventListener("mouseover",P)},[c]),r.useEffect(()=>{let P;const C=u=>{m(!1),i.current={x:u.clientX,y:u.clientY},t.current&&(t.current.style.transform=`translate(${u.clientX-4}px, ${u.clientY-4}px)`),Math.random()>.7&&N(u.clientX,u.clientY)},y=()=>d(!0),E=()=>d(!1),o=()=>m(!1),x=u=>{u.relatedTarget===null&&m(!0)},N=(u,n)=>{if(!document.body)return;const b=document.createElement("div"),z=Math.random()*4+2,R=j?"polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%)":"polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%)",T=Math.random()*360;Object.assign(b.style,{position:"fixed",left:"0",top:"0",width:`${z}px`,height:`${z}px`,backgroundColor:"white",clipPath:R,pointerEvents:"none",zIndex:9998,transform:`translate(${u}px, ${n}px) rotate(${T}deg)`,opacity:.6,transition:"transform 0.6s ease-out, opacity 0.6s ease-out",willChange:"transform, opacity"}),document.body.appendChild(b);const O=(Math.random()-.5)*60,G=(Math.random()-.5)*60;requestAnimationFrame(()=>{b&&(b.style.transform=`translate(${u-O}px, ${n-G}px) rotate(${T+180}deg) scale(0)`,b.style.opacity=0)}),setTimeout(()=>{b&&b.parentNode&&b.remove()},600)},w=()=>{l.current&&(s.current.x+=(i.current.x-s.current.x)*v,s.current.y+=(i.current.y-s.current.y)*v,l.current.style.transform=`translate(${s.current.x-20}px, ${s.current.y-20}px)`,P=requestAnimationFrame(w))};return w(),document.addEventListener("mousemove",C),document.addEventListener("mousedown",y),document.addEventListener("mouseup",E),document.addEventListener("mouseenter",o),document.addEventListener("mouseout",x),()=>{cancelAnimationFrame(P),document.removeEventListener("mousemove",C),document.removeEventListener("mousedown",y),document.removeEventListener("mouseup",E),document.removeEventListener("mouseenter",o),document.removeEventListener("mouseout",x)}},[j]),p?null:e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:t,className:"fixed top-0 left-0 z-[9999] pointer-events-none will-change-transform",style:{top:0,left:0},children:e.jsx("div",{className:`w-2 h-2 bg-white rounded-full shadow-[0_0_10px_rgba(255,255,255,0.8)] transition-all duration-300 ease-out ${a?"scale-0 opacity-0":_?"scale-50 opacity-100":j?"scale-150 opacity-100":"scale-100 opacity-100"}`})}),e.jsx("div",{ref:l,className:"fixed top-0 left-0 w-10 h-10 pointer-events-none z-[9998] mix-blend-difference will-change-transform",style:{top:0,left:0},children:e.jsx("svg",{className:`w-full h-full transition-all duration-500 ease-out ${a?"scale-0 opacity-0":_?"scale-75 opacity-100":j?"scale-125 rotate-180 opacity-100":"scale-100 opacity-100"}`,viewBox:"0 0 40 40",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:j?"M 20 1 L 37 10.5 L 37 29.5 L 20 39 L 3 29.5 L 3 10.5 Z":"M 20 1 A 19 19 0 1 1 20 39 A 19 19 0 1 1 20 1 Z",stroke:"white",strokeWidth:"2",strokeLinecap:"round",style:{transition:"d 0.3s ease-out"}})})})]})},Se=()=>{const t=r.useRef(null),l=r.useRef(null),c=r.useRef([]),i=r.useRef({width:0,height:0}),s=2,a=25,m=100,_=35,d=.08,j=4,g=r.useCallback((v,f)=>{const h=[],P=Math.floor(v/a),C=Math.floor(f/a);for(let E=0;E<C;E++)for(let o=0;o<P;o++)h.push({x:o*a+a/2,y:E*a+a/2,brightness:0,targetBrightness:0,pulsePhase:Math.random()*Math.PI*2});const y=[...Array(h.length).keys()].sort(()=>Math.random()-.5);for(let E=0;E<Math.min(_,h.length);E++)h[y[E]].targetBrightness=1;return h},[]),p=r.useCallback(()=>{const v=c.current;if(v.length===0)return;const f=[],h=[];v.forEach((C,y)=>{C.targetBrightness>.5?f.push(y):h.push(y)});const P=Math.min(j,f.length,h.length);for(let C=0;C<P&&!(f.length===0||h.length===0);C++){const y=f.splice(Math.floor(Math.random()*f.length),1)[0],E=h.splice(Math.floor(Math.random()*h.length),1)[0];v[y].targetBrightness=0,v[E].targetBrightness=1}},[]),S=r.useCallback(()=>{const v=t.current;if(!v)return;const f=v.getContext("2d"),{width:h,height:P}=i.current;f.clearRect(0,0,h,P);const C=c.current,y=Date.now()*.002;for(let o=0;o<C.length;o++){const x=C[o],N=Math.sin(y+x.pulsePhase)*.3+.7,w=x.targetBrightness*N;x.brightness+=(w-x.brightness)*d}f.lineWidth=1;const E=[];for(let o=0;o<C.length;o++)C[o].brightness>.15&&E.push(C[o]);f.beginPath();for(let o=0;o<E.length;o++)for(let x=o+1;x<E.length;x++){const N=E[o],w=E[x],u=w.x-N.x,n=w.y-N.y,b=u*u+n*n;if(b<m*m){const z=(1-Math.sqrt(b)/m)*Math.min(N.brightness,w.brightness)*.4;f.strokeStyle=`rgba(255, 255, 255, ${z})`,f.beginPath(),f.moveTo(N.x,N.y),f.lineTo(w.x,w.y),f.stroke()}}for(let o=0;o<C.length;o++){const x=C[o];if(x.brightness>.05){const N=x.brightness;f.beginPath(),f.arc(x.x,x.y,s*2,0,Math.PI*2),f.fillStyle=`rgba(255, 255, 255, ${N*.15})`,f.fill(),f.beginPath(),f.arc(x.x,x.y,s,0,Math.PI*2),f.fillStyle=`rgba(255, 255, 255, ${N*.9})`,f.fill()}else f.beginPath(),f.arc(x.x,x.y,s*.5,0,Math.PI*2),f.fillStyle="rgba(255, 255, 255, 0.03)",f.fill()}l.current=requestAnimationFrame(S)},[]);return r.useEffect(()=>{const v=()=>{if(t.current){const f=window.innerWidth,h=window.innerHeight;i.current={width:f,height:h},t.current.width=f,t.current.height=h,c.current=g(f,h)}};return v(),window.addEventListener("resize",v),()=>window.removeEventListener("resize",v)},[g]),r.useEffect(()=>{S();const v=setInterval(p,300);return()=>{l.current&&cancelAnimationFrame(l.current),clearInterval(v)}},[S,p]),e.jsx("canvas",{ref:t,className:"absolute inset-0 z-0 pointer-events-none",style:{background:"transparent"}})},ue=["Finishing the prompt...","Stuck in traffic...","Uploading the assignment...","Wearing ID card...","Taking the fish for a walk...","Mass bunking...","Eating ice cream...","ICA farming...","Checking Defalter List...","Avoiding eye contact with faculty...","Avoiding the library...","Connecting to VPN...","Pretending to understand quantum physics...","Attempting Re-Exam... ","Finding an empty class...","Scrolling Reels..."],mt=()=>{const[t,l]=r.useState(!0),[c,i]=r.useState([]),[s,a]=r.useState(0),[m,_]=r.useState(!1),[d,j]=r.useState(0);return r.useEffect(()=>{const g=[...ue];for(let p=g.length-1;p>0;p--){const S=Math.floor(Math.random()*(p+1));[g[p],g[S]]=[g[S],g[p]]}i(g),a(Math.floor(Math.random()*g.length))},[]),r.useEffect(()=>{if(!t)return;const g=setInterval(()=>{a(p=>(p+1)%ue.length)},1500);return()=>clearInterval(g)},[t]),r.useEffect(()=>{const g=setInterval(()=>{j(p=>p>=100?100:p+Math.random()*15+5)},200);return()=>clearInterval(g)},[]),r.useEffect(()=>{const g=setTimeout(()=>{_(!0),setTimeout(()=>l(!1),500)},2e3);return()=>clearTimeout(g)},[]),t?e.jsxs("div",{className:`fixed inset-0 z-[10000] bg-black flex flex-col items-center justify-center transition-opacity duration-500 ${m?"opacity-0":"opacity-100"}`,children:[e.jsx("div",{className:"absolute inset-0 opacity-30",children:e.jsx(Se,{})}),e.jsxs("div",{className:"relative z-10 flex flex-col items-center",children:[e.jsx("div",{className:"text-white text-3xl md:text-4xl font-display font-bold mb-4 tracking-widest animate-pulse text-center px-4",children:"CAMPUS NODES"}),e.jsx("div",{className:"text-zinc-400 font-mono text-xs md:text-sm h-6 text-center px-4",children:c.length>0?c[s]:"Loading..."}),e.jsx("div",{className:"w-48 md:w-64 h-1 bg-zinc-800 mt-8 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-white transition-all duration-300 ease-out",style:{width:`${Math.min(d,100)}%`}})})]})]}):null},A=({children:t,variant:l="primary",onClick:c,className:i="",type:s="button",fullWidth:a=!1,to:m,href:_,withDoodles:d=!0,disabled:j})=>{const g=r.useRef(null),[p,S]=r.useState(!1),v=x=>{j||(S(!0),setTimeout(()=>S(!1),700),c&&c(x))},f="relative group/btn font-display font-bold uppercase tracking-widest text-xs px-8 py-4 transition-all duration-300 transform active:scale-95 disabled:opacity-50 disabled:cursor-none flex items-center justify-center gap-2",h={primary:"bg-white text-black border border-transparent hover:bg-zinc-200",outline:"border border-white/20 text-white hover:border-white hover:bg-white/5",ghost:"text-gray-400 hover:text-white hover:bg-white/5",accent:"bg-accent text-white border border-transparent hover:bg-accent/90"},P=a?"w-full":"",C=`${f} ${h[l]} ${P} ${i}`,y=(x,N,w)=>p?`opacity-0 ${w} transition-all duration-700 ease-out z-50`:`opacity-0 group-hover/btn:opacity-100 ${N} transition-all duration-300 ease-out ${x}`,E=()=>e.jsxs("span",{className:"absolute inset-0 pointer-events-none overflow-visible",children:[e.jsx("span",{className:`absolute left-1/2 -translate-x-1/2 ${y("-top-12","-top-8","-translate-y-[80vh]")} delay-75 text-white`,children:e.jsx(Re,{size:20,fill:"currentColor"})}),e.jsx("span",{className:`absolute left-0 ${y("-top-10","-top-6","-translate-y-[80vh] -translate-x-[20vw]")} delay-0 text-white -rotate-12`,children:e.jsx(xe,{size:20,strokeWidth:3})}),e.jsx("span",{className:`absolute right-0 ${y("-top-10","-top-6","-translate-y-[80vh] translate-x-[20vw]")} delay-100 text-white rotate-12`,children:e.jsx(oe,{size:16,fill:"currentColor"})}),e.jsx("span",{className:`absolute left-1/2 -translate-x-1/2 ${y("-bottom-12","-bottom-8","translate-y-[80vh]")} delay-75 text-white`,children:e.jsx(Ie,{size:18,strokeWidth:3})}),e.jsx("span",{className:`absolute left-0 ${y("-bottom-10","-bottom-6","translate-y-[80vh] -translate-x-[20vw]")} delay-0 text-white rotate-12`,children:e.jsx(D,{size:16,strokeWidth:4})}),e.jsx("span",{className:`absolute right-0 ${y("-bottom-10","-bottom-6","translate-y-[80vh] translate-x-[20vw]")} delay-100 text-white -rotate-12`,children:e.jsx(xe,{size:20,strokeWidth:3,className:"rotate-180"})}),e.jsx("span",{className:`absolute top-1/2 -translate-y-1/2 ${y("-left-12","-left-8","-translate-x-[80vw]")} delay-50 text-white`,children:e.jsx(ge,{size:20,strokeWidth:3})}),e.jsx("span",{className:`absolute top-0 ${y("-left-8","-left-5","-translate-x-[80vw] -translate-y-[20vh]")} delay-100 text-white`,children:e.jsx(te,{size:16,fill:"currentColor"})}),e.jsx("span",{className:`absolute top-1/2 -translate-y-1/2 ${y("-right-12","-right-8","translate-x-[80vw]")} delay-50 text-white`,children:e.jsx(be,{size:20,strokeWidth:3})}),e.jsx("span",{className:`absolute bottom-0 ${y("-right-8","-right-5","translate-x-[80vw] translate-y-[20vh]")} delay-100 text-white rotate-45`,children:e.jsx($e,{size:16,fill:"currentColor"})})]}),o=e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"relative z-10",children:t}),d&&e.jsx(E,{})]});return m?e.jsx(L,{to:m,className:C,ref:g,onClick:v,children:o}):_?e.jsx("a",{href:_,className:C,target:"_blank",rel:"noopener noreferrer",ref:g,onClick:v,children:o}):e.jsx("button",{ref:g,type:s,className:C,onClick:v,disabled:j,children:o})},pt=()=>{const{user:t}=U();return e.jsxs("section",{className:"relative w-full h-screen flex flex-col justify-center items-center overflow-hidden bg-transparent",children:[e.jsx("div",{className:"absolute inset-0 bg-grid-white/[0.02] -z-10"}),e.jsx("div",{className:"absolute top-1/4 -left-20 w-96 h-96 bg-accent/10 rounded-full blur-[100px] pointer-events-none"}),e.jsxs("div",{className:"z-10 text-center px-4 max-w-5xl mx-auto pointer-events-none",children:[e.jsx("h1",{className:"text-6xl md:text-9xl font-bold font-display tracking-tighter text-white mb-6 animate-fade-in pointer-events-auto",children:"CAMPUS NODES"}),e.jsxs("p",{className:"text-gray-400 text-lg md:text-2xl max-w-2xl mx-auto font-light tracking-wide mb-12 animate-fade-in pointer-events-auto",style:{animationDelay:"200ms"},children:["The decentralized marketplace for everything on campus.",e.jsx("br",{}),"Trade gears, find mentors, build your network."]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-6 justify-center items-center animate-fade-in pointer-events-auto",style:{animationDelay:"400ms"},children:[e.jsx(re,{children:e.jsxs(A,{to:t?"/market":"/signup",variant:"primary",className:"px-8 py-4 text-sm",children:[t?"Go to Market":"Start Trading"," ",e.jsx(ge,{size:18,className:"inline ml-2"})]})}),e.jsx(re,{children:e.jsx(A,{to:"/services",variant:"outline",className:"px-8 py-4 text-sm",children:"Explore Services"})})]})]})]})},ae=[{id:1,title:"Casio FX-991EX Classwiz (Used)",category:"Stationary",price:"â‚¹600",images:[],seller:"Aarya Nadiger",trustScore:95,description:"Used for 1 semester. Perfect condition. Includes original sliding cover. Essential for engineering exams."},{id:2,title:"Engineering Drafter & Roller Scale",category:"Stationary",price:"â‚¹450",images:[],seller:"Rushi Shah",trustScore:98,description:"Mini drafter suitable for ED/EGD labs. Roller scale included. Brand: Omega."},{id:3,title:"Arduino Uno Starter Kit",category:"Tech",price:"â‚¹850",images:[],seller:"Meemoh Shukla",trustScore:90,description:"Includes Uno board, breadboard, jumper wires, LEDs, resistors, and sensors. Great for First Year projects."},{id:4,title:"Electric Kettle (1.5L)",category:"Essentials",price:"â‚¹500",images:[],seller:"Prithish Gurbani",trustScore:85,description:"Prestige 1.5L Kettle. Works perfectly. Boils water in 2 mins. Cable included."},{id:5,title:"Lab Coat (Size M) + Goggles",category:"Essentials",price:"â‚¹200",images:[],seller:"Tanish Parekh",trustScore:100,description:"Cotton lab coat, Size M. Hardly used. Safety goggles included for Chem lab."},{id:6,title:"Hercules Cycle (Black)",category:"Transport",price:"â‚¹2,500",images:[],seller:"Sarvesh Nimbalkar",trustScore:92,description:"Single speed Hercules cycle. Tyres replaced recently. Good condition for campus commuting."},{id:7,title:"Engineering Math (K.A. Stroud)",category:"Textbooks",price:"â‚¹350",images:[],seller:"Arjun Shetty",trustScore:97,description:"Fifth Edition. No highlighting/markings inside. Essential for first year calculus."},{id:8,title:"Extension Board (4 Socket)",category:"Essentials",price:"â‚¹300",images:[],seller:"Viyomm",trustScore:88,description:"Belkin 4-socket surge protector. 1.5m wire length. Must have for hostel rooms."}],ft=({item:t})=>{const l=r.useRef(null),c=t.images&&t.images.length>0,i=s=>{if(l.current){const{clientWidth:a}=l.current,m=s==="left"?-a:a;l.current.scrollBy({left:m,behavior:"smooth"})}};return e.jsxs("div",{className:"group relative bg-surface border border-white/5 hover:border-white/20 hover:z-[50] transition-colors duration-300",children:[e.jsx("div",{className:"relative aspect-[4/3] overflow-hidden bg-white/5",children:c?e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:l,className:"w-full h-full overflow-x-auto flex snap-x snap-mandatory scrollbar-hide",children:t.images.map((s,a)=>e.jsx("img",{src:s,alt:`${t.title} ${a+1}`,className:"w-full h-full object-cover shrink-0 snap-center"},a))}),e.jsx("button",{onClick:s=>{s.preventDefault(),i("left")},className:"absolute left-2 top-1/2 -translate-y-1/2 bg-black/50 text-white p-1 rounded-full opacity-0 group-hover:opacity-100 transition-opacity hover:bg-black/70 z-10",children:e.jsx(X,{size:20})}),e.jsx("button",{onClick:s=>{s.preventDefault(),i("right")},className:"absolute right-2 top-1/2 -translate-y-1/2 bg-black/50 text-white p-1 rounded-full opacity-0 group-hover:opacity-100 transition-opacity hover:bg-black/70 z-10",children:e.jsx(ne,{size:20})})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full p-6 text-center opacity-50",children:[e.jsx(Z,{className:"w-12 h-12 mb-3"}),e.jsx("p",{className:"text-[10px] uppercase tracking-wider text-gray-400 font-medium",children:"Seller has not uploaded any images for this product"})]})}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("span",{className:"text-xs font-bold text-accent uppercase tracking-wider",children:t.category}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-400",children:[e.jsx(oe,{size:12,className:"text-yellow-500 fill-current"})," ",t.trustScore]})]}),e.jsx("h3",{className:"text-white font-medium truncate mb-1",children:t.title}),e.jsx("p",{className:"text-lg font-bold text-white",children:t.price}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-white/10 flex justify-between items-center text-sm text-gray-400",children:[e.jsxs("span",{children:["@",t.seller]}),e.jsx(A,{to:`/market/${t.id}`,variant:"primary",className:"px-4 py-2 text-xs",children:"View"})]})]})]})},gt=()=>{const[t,l]=r.useState("All"),c=["All","Stationary","Tech","Essentials","Transport","Textbooks"],i=t==="All"?ae:ae.filter(s=>s.category===t);return r.useEffect(()=>{H({targets:".market-card",opacity:[0,1],translateY:[20,0],delay:H.stagger(100),easing:"easeOutExpo"})},[t]),e.jsx("div",{className:"min-h-screen bg-background pt-24 pb-20 px-6 md:px-12",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center mb-12",children:[e.jsx("h1",{className:"text-5xl font-display font-bold text-white mb-6 md:mb-0",children:"Marketplace"}),e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2 md:pb-0 w-full md:w-auto p-1",children:c.map(s=>e.jsx("button",{onClick:()=>l(s),className:`px-4 py-2 text-sm font-medium border transition-all duration-300 whitespace-nowrap
                  ${t===s?"bg-white text-black border-white":"text-gray-400 border-white/10 hover:border-white/50 hover:text-white"}`,children:s},s))})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:i.map((s,a)=>e.jsx("div",{className:"market-card opacity-0",children:e.jsx(ft,{item:s})},s.id))})]})})},bt=[{id:"tutoring",title:"Peer Tutoring",description:"Ace your mid-terms with help from seniors who topped the class.",icon:e.jsx(ve,{size:40}),availableCount:42,provider:"Aarya Nadiger"},{id:"printing",title:"Print & Bind",description:"Fast, cheap printing delivered to your hostel room. Assignments & theses.",icon:e.jsx(Ae,{size:40}),availableCount:8,provider:"Rushi Shah"},{id:"repair",title:"Tech Repair",description:"Broken laptop screen or phone issues? Student-run reliable fixes.",icon:e.jsx(ie,{size:40}),availableCount:12,provider:"Meemoh Shukla"},{id:"coding",title:"Coding Mentorship",description:"Debug help for C++, Python, and Java semester projects.",icon:e.jsx(Le,{size:40}),availableCount:25,provider:"Prithish Gurbani"},{id:"photography",title:"Event Media",description:"Hire photographers and videographers for your club events.",icon:e.jsx(je,{size:40}),availableCount:5,provider:"Tanish Parekh"},{id:"events",title:"Committee Events",description:"Find committees recruiting new members or hosting workshops.",icon:e.jsx(De,{size:40}),availableCount:7,provider:"Sarvesh Nimbalkar"}],vt=({service:t,index:l})=>e.jsxs("div",{className:"service-card group relative p-8 bg-surface border border-white/5 hover:border-white/20 hover:z-[50] transition-all duration-500 min-h-[300px] flex flex-col justify-end",children:[e.jsx("div",{className:"absolute top-8 right-8 text-gray-700 group-hover:text-accent transition-colors duration-500",children:t.icon}),e.jsxs("div",{className:"relative z-10",children:[e.jsx("h3",{className:"text-3xl font-display font-bold text-white mb-4 group-hover:translate-x-2 transition-transform duration-300",children:t.title}),e.jsx("p",{className:"text-gray-400 max-w-sm mb-6 opacity-80 group-hover:opacity-100 transition-opacity",children:t.description}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:"text-xs font-bold uppercase tracking-wider text-accent mb-1",children:[t.availableCount," Active Listed"]}),e.jsxs("span",{className:"text-[10px] uppercase tracking-widest text-gray-500",children:["Head: ",t.provider]})]}),e.jsx(A,{variant:"outline",className:"px-6 py-2 ml-auto",children:"View"})]})]}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/80 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500 pointer-events-none"})]}),jt=()=>e.jsx("div",{className:"min-h-screen bg-background pt-32 pb-20 px-6 md:px-12",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-16 animate-fade-in",children:[e.jsx("span",{className:"text-accent text-sm font-bold uppercase tracking-widest mb-2 block",children:"Our Ecosystem"}),e.jsx("h1",{className:"text-5xl md:text-7xl font-display font-bold text-white mb-8",children:"Campus Services"}),e.jsx("p",{className:"text-xl text-gray-400 max-w-2xl font-light",children:"Everything you need to survive and thrive on campus. From academic support to logistical solutions."})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:bt.map((t,l)=>e.jsx("div",{style:{animationDelay:`${l*150}ms`},className:"opacity-0 animate-fade-in fill-mode-forwards",children:e.jsx(vt,{service:t,index:l})},t.id))}),e.jsxs("div",{className:"mt-20 p-12 bg-zinc-900 border border-white/5 relative overflow-hidden text-center opacity-0 animate-fade-in fill-mode-forwards",style:{animationDelay:"600ms"},children:[e.jsx("h2",{className:"text-3xl font-display font-bold text-white mb-6",children:"Need a custom service?"}),e.jsx("p",{className:"text-gray-400 mb-8 max-w-xl mx-auto",children:"Post a request for tasks, tutoring, or help. The community is here to support you."}),e.jsx(A,{variant:"primary",className:"px-8 py-3",children:"Post Request"})]})]})}),wt=()=>{const{user:t}=U(),{openAuthModal:l}=W();q();const[c,i]=r.useState([]),[s,a]=r.useState([]),[m,_]=r.useState([]),[d,j]=r.useState(!0),[g,p]=r.useState(""),[S,v]=r.useState(null),[f,h]=r.useState(null),[P,C]=r.useState({top:0,left:0}),y=async()=>{try{j(!0);let n=[];if(t){const{data:M,error:F}=await k.from("friendships").select("*").or(`user1_id.eq.${t.id},user2_id.eq.${t.id}`);if(F)throw F;n=M||[]}const{data:b,error:z}=await k.from("profiles").select("*").order("created_at",{ascending:!1}).limit(50);if(z)throw z;if(!t){_(b),i([]);return}const R=n.filter(M=>M.status==="accepted"),T=R.map(M=>M.user1_id===t.id?M.user2_id:M.user1_id),G=b.filter(M=>T.includes(M.id)).map(M=>{const F=R.find(de=>de.user1_id===M.id||de.user2_id===M.id);return{...M,friendship_id:F?.id}});i(G);const Q=n.filter(M=>M.status==="pending"&&M.user1_id===t.id).map(M=>M.user2_id),K=n.filter(M=>M.status==="pending"&&M.user2_id===t.id).map(M=>M.user1_id),Me=b.filter(M=>K.includes(M.id));a(Me);const Pe=b.filter(M=>M.id!==t.id&&!T.includes(M.id)&&!K.includes(M.id)).map(M=>{let F="none";return Q.includes(M.id)&&(F="sent"),{...M,status:F}});_(Pe)}catch(n){console.error("Error fetching connections:",n)}finally{j(!1)}};r.useEffect(()=>{y();const n=k.channel("connections_page_realtime").on("postgres_changes",{event:"*",schema:"public",table:"friendships"},()=>y()).subscribe();return()=>k.removeChannel(n)},[t]);const E=async n=>{if(!t)return l();v(n);try{const{error:b}=await k.from("friendships").insert({user1_id:t.id,user2_id:n,status:"pending"});if(b)throw b;y()}catch(b){console.error(b),alert("Action failed")}finally{v(null)}},o=async n=>{v(n);try{const{error:b}=await k.from("friendships").update({status:"accepted"}).eq("user1_id",n).eq("user2_id",t.id);if(b)throw b;y()}catch(b){console.error(b)}finally{v(null)}},x=async n=>{v(n);try{const{error:b}=await k.from("friendships").delete().eq("user1_id",n).eq("user2_id",t.id);if(b)throw b;y()}catch(b){console.error(b)}finally{v(null)}},N=(n,b)=>{const z=b.currentTarget,R=z.closest(".group");if(R){const T=R.getBoundingClientRect();C({top:T.top-60,left:T.left+T.width/2-105})}else{const T=z.getBoundingClientRect();C({top:T.top-60,left:T.left-100})}h(n)},w=async()=>{if(f)try{const b=c.find(z=>z.friendship_id===f)?.id;await k.from("friendships").delete().eq("id",f),b&&t&&(await k.from("messages").delete().eq("sender_id",t.id).eq("receiver_id",b),await k.from("messages").delete().eq("sender_id",b).eq("receiver_id",t.id)),h(null),y()}catch(n){console.error(n)}},u=m.filter(n=>(n.first_name+" "+n.last_name).toLowerCase().includes(g.toLowerCase()));return e.jsxs("div",{className:"min-h-screen bg-background pt-32 pb-20 px-6 md:px-12 relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 w-[500px] h-[500px] bg-blue-500/10 rounded-full blur-[100px] pointer-events-none"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-[500px] h-[500px] bg-purple-500/10 rounded-full blur-[100px] pointer-events-none"}),e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("header",{className:"mb-12",children:[e.jsx("h1",{className:"text-5xl font-display font-bold text-white mb-4",children:"Network & Circle"}),e.jsx("p",{className:"text-gray-400",children:"Manage your close circle and discover new connections."})]}),t&&e.jsxs("section",{className:"mb-16",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(Oe,{className:"text-accent",size:24}),e.jsxs("h2",{className:"text-2xl font-bold text-white",children:["Your Circle (",c.length,")"]})]}),c.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:c.map(n=>e.jsxs("div",{className:"bg-white/5 border border-white/10 p-5 rounded-xl flex items-center justify-between group hover:bg-white/10 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-gray-800 rounded-full border border-white/20 overflow-hidden",children:n.avatar_url?e.jsx("img",{src:n.avatar_url,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-white font-bold",children:n.first_name?.[0]})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-white font-bold",children:[n.first_name," ",n.last_name]}),e.jsx("p",{className:"text-gray-400 text-xs",children:n.role||"Student"})]})]}),e.jsx("button",{onClick:b=>N(n.friendship_id,b),className:"p-2 bg-white/5 text-gray-400 rounded-full hover:bg-red-600 hover:text-white transition-all opacity-100",title:"Remove Connection",children:e.jsx(Fe,{size:20})})]},n.id))}):e.jsx("div",{className:"p-8 border border-dashed border-white/10 rounded-xl text-center text-gray-500",children:"You haven't connected with anyone yet."})]}),t&&s.length>0&&e.jsxs("section",{className:"mb-16 animate-fade-in-up",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(qe,{className:"text-yellow-400",size:24}),e.jsxs("h2",{className:"text-2xl font-bold text-white",children:["Pending Requests (",s.length,")"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:s.map(n=>e.jsxs("div",{className:"bg-white/5 border border-yellow-500/20 p-5 rounded-xl flex items-center justify-between group hover:bg-white/10 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-gray-800 rounded-full border border-white/20 overflow-hidden",children:n.avatar_url?e.jsx("img",{src:n.avatar_url,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-white font-bold",children:n.first_name?.[0]})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-white font-bold text-lg",children:[n.first_name," ",n.last_name]}),e.jsx("p",{className:"text-yellow-400 text-xs font-semibold uppercase tracking-wider",children:"Wants to join"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>o(n.id),className:"p-2 bg-green-500/20 text-green-400 rounded-full hover:bg-green-500 hover:text-black transition-colors",title:"Accept",disabled:S===n.id,children:e.jsx(J,{size:18})}),e.jsx("button",{onClick:()=>x(n.id),className:"p-2 bg-red-500/20 text-red-400 rounded-full hover:bg-red-500 hover:text-white transition-colors",title:"Decline",disabled:S===n.id,children:e.jsx(D,{size:18})})]})]},n.id))})]}),e.jsxs("section",{children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-end mb-8 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(he,{className:"text-purple-400",size:24}),e.jsx("h2",{className:"text-2xl font-bold text-white",children:"Discover People"})]}),e.jsxs("div",{className:"relative w-full md:w-80",children:[e.jsx("input",{type:"text",placeholder:"Search students...",value:g,onChange:n=>p(n.target.value),className:"w-full bg-black border border-white/20 rounded-full px-4 py-2 pl-10 text-white focus:outline-none focus:border-accent"}),e.jsx(he,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",size:16})]})]}),d?e.jsx("div",{className:"flex justify-center py-20",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-white"})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:u.map(n=>e.jsxs("div",{className:"bg-white/5 border border-white/10 p-6 rounded-xl hover:border-accent/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("div",{className:"w-14 h-14 bg-gray-800 rounded-full border border-white/20 overflow-hidden",children:n.avatar_url?e.jsx("img",{src:n.avatar_url,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-white font-bold",children:n.first_name?.[0]})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-white font-bold text-lg",children:[n.first_name," ",n.last_name]}),e.jsx("p",{className:"text-accent text-xs font-bold uppercase tracking-wider",children:n.role||"Student"})]})]}),e.jsx("div",{className:"pt-4 border-t border-white/10 flex justify-end",children:e.jsx(A,{onClick:()=>E(n.id),variant:n.status==="sent"||n.status==="accepted"?"outline":"primary",disabled:n.status==="sent"||S===n.id,className:"px-6 py-2 text-sm",children:S===n.id?"...":n.status==="sent"?"Requested":n.status==="received"?"Accept Request":"Connect"})})]},n.id))})]}),f&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-[99] bg-transparent",onClick:()=>h(null)}),e.jsxs("div",{className:"fixed z-[100] bg-black border border-white/20 p-2 pl-4 rounded-full flex items-center gap-3 shadow-[0_0_20px_rgba(255,255,255,0.1)] animate-fade-in",style:{top:P.top,left:P.left},children:[e.jsx("span",{className:"text-xs font-bold text-white whitespace-nowrap",children:"Remove Connection?"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:w,className:"p-1.5 bg-green-500 text-black rounded-full hover:scale-110 transition-transform shadow-[0_0_10px_rgba(34,197,94,0.5)]",title:"Confirm",children:e.jsx(J,{size:14})}),e.jsx("button",{onClick:()=>h(null),className:"p-1.5 bg-red-600 text-white rounded-full hover:scale-110 transition-transform shadow-[0_0_10px_rgba(239,68,68,0.5)]",title:"Cancel",children:e.jsx(D,{size:14})})]})]})]})]})]})},Ee=(t,l)=>[t,l].sort().join("_"),ze=(t,l,c)=>{try{if(!t)return"";const i=Ee(l,c);return se.AES.encrypt(t,i).toString()}catch(i){return console.error("Encryption failed:",i),t}},B=(t,l,c)=>{try{if(!t)return"";const i=Ee(l,c),a=se.AES.decrypt(t,i).toString(se.enc.Utf8);return a||t}catch{return t}},yt=()=>{const{user:t}=U(),{removeUnreadSender:l,unreadSenders:c}=W(),i=q(),[s,a]=r.useState(null),[m,_]=r.useState([]),[d,j]=r.useState([]),[g,p]=r.useState(""),[S,v]=r.useState(!1),f=r.useRef(null),h=()=>{f.current?.scrollIntoView({behavior:"smooth"})};r.useEffect(()=>{t&&P()},[t]),r.useEffect(()=>{if(s){l(s.id),C(s.id);const o=k.channel(`chat_mobile:${s.id}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:`sender_id=eq.${s.id}`},x=>{if(x.new.receiver_id===t.id){const N=B(x.new.content,x.new.sender_id,x.new.receiver_id),w={...x.new,content:N};j(u=>[...u,w]),h()}}).subscribe();return()=>k.removeChannel(o)}},[s]);const P=async()=>{v(!0);try{const{data:o}=await k.from("friendships").select("*").or(`user1_id.eq.${t.id},user2_id.eq.${t.id}`).eq("status","accepted");if(!o?.length){_([]);return}const x=o.map(w=>w.user1_id===t.id?w.user2_id:w.user1_id),{data:N}=await k.from("profiles").select("*").in("id",x);_(N||[])}catch(o){console.error("Error fetching friends:",o)}finally{v(!1)}},C=async o=>{v(!0);try{const{data:x}=await k.from("messages").select("*").or(`and(sender_id.eq.${t.id},receiver_id.eq.${o}),and(sender_id.eq.${o},receiver_id.eq.${t.id})`).order("created_at",{ascending:!0}),N=(x||[]).map(w=>({...w,content:B(w.content,w.sender_id,w.receiver_id)}));j(N),setTimeout(h,100)}catch(x){console.error("Error fetching messages:",x)}finally{v(!1)}},y=async o=>{if(o.preventDefault(),!g.trim()||!s)return;const x=g.trim();p("");const N={id:Date.now(),sender_id:t.id,receiver_id:s.id,content:x,created_at:new Date().toISOString()};j(w=>[...w,N]),h();try{const w=ze(x,t.id,s.id);await k.from("messages").insert({sender_id:t.id,receiver_id:s.id,content:w})}catch(w){console.error("Error sending message:",w)}},E=async()=>{if(!(!s||!window.confirm("Clear all messages with this person?")))try{await k.from("messages").delete().eq("sender_id",t.id).eq("receiver_id",s.id),await k.from("messages").delete().eq("sender_id",s.id).eq("receiver_id",t.id),j([])}catch(o){console.error("Failed to clear chat",o)}};return t?e.jsxs("div",{className:"min-h-screen bg-background pt-4 pb-28",children:[e.jsx("div",{className:"sticky top-0 bg-background/80 backdrop-blur-xl z-20 px-4 py-3 border-b border-white/10",children:e.jsx("div",{className:"flex items-center gap-3",children:s?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>a(null),className:"p-2 -ml-2 hover:bg-white/10 rounded-full",children:e.jsx(X,{size:24,className:"text-white"})}),e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-700 overflow-hidden border border-white/20",children:s.avatar_url?e.jsx("img",{src:s.avatar_url,alt:"",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-sm font-bold text-white",children:s.first_name?.[0]})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h1",{className:"font-bold text-white",children:[s.first_name," ",s.last_name]}),e.jsxs("p",{className:"text-xs text-gray-500 flex items-center gap-1",children:[e.jsx(we,{size:10})," End-to-end encrypted"]})]}),e.jsx("button",{onClick:E,className:"p-2 hover:bg-red-500/20 rounded-full text-gray-400 hover:text-red-400",children:e.jsx(ce,{size:18})})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>i(-1),className:"p-2 -ml-2 hover:bg-white/10 rounded-full",children:e.jsx(X,{size:24,className:"text-white"})}),e.jsx("h1",{className:"text-xl font-bold text-white",children:"Messages"})]})})}),s?e.jsxs("div",{className:"flex flex-col h-[calc(100vh-180px)]",children:[e.jsxs("div",{className:"flex-1 overflow-y-auto px-4 py-4 space-y-3",children:[d.length===0?e.jsxs("div",{className:"text-center py-10 text-gray-500",children:[e.jsx("p",{children:"No messages yet."}),e.jsx("p",{className:"text-sm",children:"Say hi! ðŸ‘‹"})]}):d.map(o=>e.jsx("div",{className:`flex ${o.sender_id===t.id?"justify-end":"justify-start"}`,children:e.jsx("div",{className:`max-w-[80%] px-4 py-2 rounded-2xl ${o.sender_id===t.id?"bg-accent text-black rounded-br-md":"bg-white/10 text-white rounded-bl-md"}`,children:e.jsx("p",{className:"text-sm",children:o.content})})},o.id)),e.jsx("div",{ref:f})]}),e.jsx("form",{onSubmit:y,className:"px-4 py-3 bg-background border-t border-white/10",children:e.jsxs("div",{className:"flex items-center gap-2 bg-white/5 rounded-full px-4 py-2",children:[e.jsx("input",{type:"text",value:g,onChange:o=>p(o.target.value),placeholder:"Type a message...",className:"flex-1 bg-transparent text-white placeholder:text-gray-500 focus:outline-none text-sm"}),e.jsx("button",{type:"submit",disabled:!g.trim(),className:"p-2 bg-accent text-black rounded-full disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(ye,{size:16})})]})})]}):e.jsx("div",{className:"px-4 py-4 space-y-2",children:S?e.jsx("div",{className:"text-center py-10 text-gray-500",children:"Loading..."}):m.length===0?e.jsxs("div",{className:"text-center py-20",children:[e.jsx("p",{className:"text-gray-400 text-lg",children:"No friends yet."}),e.jsx("p",{className:"text-gray-500 text-sm mt-1",children:"Connect with people to chat!"})]}):m.map(o=>e.jsxs("button",{onClick:()=>a(o),className:"w-full flex items-center gap-3 p-3 bg-white/5 hover:bg-white/10 rounded-xl transition-all",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gray-700 overflow-hidden border border-white/20",children:o.avatar_url?e.jsx("img",{src:o.avatar_url,alt:"",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-sm font-bold text-white",children:o.first_name?.[0]})}),c.has(o.id)&&e.jsx("div",{className:"absolute -top-1 -right-1 w-4 h-4 bg-red-500 rounded-full border-2 border-background"})]}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsxs("h3",{className:"font-semibold text-white",children:[o.first_name," ",o.last_name]}),e.jsx("p",{className:"text-sm text-gray-500",children:o.role||"Student"})]})]},o.id))})]}):e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center px-6",children:e.jsx("p",{className:"text-gray-400",children:"Please log in to access messages."})})},Nt=()=>{const t=r.useRef(null),l=q(),[c,i]=r.useState(!1),[s,a]=r.useState(null),[m,_]=r.useState(""),[d,j]=r.useState("");r.useEffect(()=>{H({targets:t.current,translateY:[20,0],opacity:[0,1],easing:"easeOutExpo",duration:800})},[]);const g=async p=>{p.preventDefault(),i(!0),a(null);try{const{data:S,error:v}=await k.auth.signInWithPassword({email:m,password:d});if(v)throw v;l("/")}catch(S){a(S.message)}finally{i(!1)}};return e.jsxs("div",{className:"min-h-screen flex items-center justify-center bg-background relative overflow-hidden px-4",children:[e.jsx("div",{className:"absolute top-0 right-0 w-96 h-96 bg-accent/5 rounded-full blur-[100px] pointer-events-none"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-64 h-64 bg-white/5 rounded-full blur-[80px] pointer-events-none"}),e.jsxs("div",{ref:t,className:"w-full max-w-md bg-surface/50 backdrop-blur-md border border-white/10 p-8 md:p-12 relative z-10 opacity-0 rounded-sm shadow-2xl",children:[e.jsxs("div",{className:"mb-8 text-center",children:[e.jsx("h1",{className:"text-3xl font-display font-bold text-white mb-2",children:"Welcome Back"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Sign in to access your dashboard"})]}),s&&e.jsx("div",{className:"mb-4 p-3 bg-red-500/10 border border-red-500/50 text-red-500 text-xs rounded-sm",children:s}),e.jsxs("form",{onSubmit:g,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs uppercase tracking-wider text-gray-500 mb-2 font-bold",children:"Email or NMIMS ID"}),e.jsx("input",{type:"email",value:m,onChange:p=>_(p.target.value),className:"w-full bg-black/20 border border-white/10 p-3 text-white focus:outline-none focus:border-accent transition-colors text-sm",placeholder:"student@nmims.edu",required:!0})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("label",{className:"block text-xs uppercase tracking-wider text-gray-500 font-bold",children:"Password"}),e.jsx(L,{to:"/forgot-password",class:"text-xs text-accent hover:text-white transition-colors",children:"Forgot?"})]}),e.jsx("input",{type:"password",value:d,onChange:p=>j(p.target.value),className:"w-full bg-black/20 border border-white/10 p-3 text-white focus:outline-none focus:border-accent transition-colors text-sm",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",required:!0})]}),e.jsx(A,{type:"submit",variant:"accent",fullWidth:!0,disabled:c,children:c?"Signing In...":"Sign In"})]}),e.jsxs("div",{className:"mt-8 text-center text-sm text-gray-400",children:["Don't have an account? ",e.jsx(L,{to:"/signup",className:"text-white hover:text-accent font-bold transition-colors",children:"Sign Up"})]})]})]})},kt={success:e.jsx(J,{size:18}),error:e.jsx(D,{size:18}),warning:e.jsx(We,{size:18}),info:e.jsx(Ue,{size:18})},_t={success:"bg-green-500/20 border-green-500/50 text-green-400",error:"bg-red-500/20 border-red-500/50 text-red-400",warning:"bg-yellow-500/20 border-yellow-500/50 text-yellow-400",info:"bg-accent/20 border-accent/50 text-accent"},Ct=({message:t,type:l="info",onClose:c,duration:i=4e3,isInsideContainer:s=!1})=>(r.useEffect(()=>{const a=setTimeout(c,i);return()=>clearTimeout(a)},[c,i]),e.jsxs("div",{className:`${s?"":"fixed top-6 left-1/2 -translate-x-1/2 z-[10001]"} px-5 py-3 rounded-xl border backdrop-blur-xl shadow-2xl flex items-center gap-3 ${_t[l]}`,children:[e.jsx("div",{className:"shrink-0",children:kt[l]}),e.jsx("span",{className:"text-sm font-medium text-white",children:t}),e.jsx("button",{onClick:c,className:"shrink-0 ml-2 text-white/50 hover:text-white transition-colors",children:e.jsx(D,{size:14})})]})),St=({toasts:t,removeToast:l})=>e.jsx("div",{className:"fixed top-6 left-1/2 -translate-x-1/2 z-[10001] pointer-events-none flex flex-col items-center gap-3",children:e.jsx(V,{children:t.map(c=>e.jsx(I.div,{initial:{opacity:0,y:-20,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-20,scale:.95},className:"pointer-events-auto",children:e.jsx(Ct,{message:c.message,type:c.type,onClose:()=>l(c.id),duration:c.duration,isInsideContainer:!0})},c.id))})});let Et=0;const zt=()=>{const[t,l]=r.useState([]);return r.useEffect(()=>()=>{},[]),{toasts:t,addToast:(s,a="info",m=4e3)=>{const _=++Et;return l(d=>[...d,{id:_,message:s,type:a,duration:m}]),_},removeToast:s=>{l(a=>a.filter(m=>m.id!==s))}}},Mt=()=>{const t=r.useRef(null),l=q(),[c,i]=r.useState(!1),[s,a]=r.useState(null),[m,_]=r.useState(!1),[d,j]=r.useState(!1),[g,p]=r.useState(""),{toasts:S,addToast:v,removeToast:f}=zt(),[h,P]=r.useState({firstName:"",lastName:"",email:"",password:""});r.useEffect(()=>{H({targets:t.current,translateY:[20,0],opacity:[0,1],easing:"easeOutExpo",duration:800})},[m]);const C=x=>{P({...h,[x.target.name]:x.target.value})},y=async x=>{if(x.preventDefault(),i(!0),a(null),console.log("Starting signup process"),console.log("Email:",h.email),!(h.email.includes(".")&&(h.email.endsWith("@nmims.edu.in")||h.email.endsWith("@nmims.in")))){a("Email must follow the format: firstname.lastname@nmims.edu.in"),i(!1);return}try{const{data:w,error:u}=await k.auth.signUp({email:h.email,password:h.password,options:{data:{first_name:h.firstName,last_name:h.lastName}}});if(console.log("Signup response:",{data:w,error:u}),u)throw u;_(!0),i(!1),console.log("Signup successful, OTP sent")}catch(w){console.error("Signup error:",w),a(w.message),i(!1)}},E=async x=>{x.preventDefault(),i(!0),a(null),console.log("Starting OTP verification"),console.log("Email:",h.email),console.log("OTP token:",g),console.log("OTP length:",g.length);try{const{data:N,error:w}=await k.auth.verifyOtp({email:h.email,token:g,type:"signup"});if(console.log("Supabase response:",{data:N,error:w}),w)throw console.error("OTP verification failed:",w),w.message.includes("Invalid")?a("Invalid verification code. Please check the code and try again."):w.message.includes("expired")?a("Verification code has expired. Please request a new code."):a(w.message||"Verification failed. Please try again."),w;const{error:u}=await k.from("profiles").upsert({id:N.user.id,first_name:h.firstName,last_name:h.lastName,role:"Student",email:h.email},{onConflict:"id"});u&&console.warn("Profile creation note:",u),v("Verification successful! Account created.","success"),j(!0),setTimeout(()=>l("/"),2e3)}catch(N){console.error("Full error object:",N),a(N.message||"Invalid verification code. Please check the code and try again.")}finally{i(!1)}},o=async()=>{i(!0),a(null),console.log("Resending OTP to:",h.email);try{const{data:x,error:N}=await k.auth.resend({type:"signup",email:h.email});if(console.log("Resend response:",{data:x,error:N}),N)throw console.error("Resend error:",N),N;v("Verification code resent! Check your inbox.","success")}catch(x){console.error("Resend error:",x),a(x.message)}finally{i(!1)}};return e.jsxs("div",{className:"min-h-screen flex items-center justify-center bg-background relative overflow-hidden px-4 py-20",children:[e.jsx(St,{toasts:S,removeToast:f}),e.jsx("div",{className:"absolute top-0 left-0 w-96 h-96 bg-accent/5 rounded-full blur-[100px] pointer-events-none"}),e.jsx("div",{ref:t,className:"w-full max-w-md bg-surface/50 backdrop-blur-md border border-white/10 p-8 md:p-12 relative z-10 opacity-0 rounded-sm shadow-2xl",children:d?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx(I.div,{initial:{scale:0},animate:{scale:1,rotate:360},transition:{type:"spring",stiffness:260,damping:20},className:"w-20 h-20 bg-green-500/20 rounded-full flex items-center justify-center mb-6 text-green-500 border border-green-500/30",children:e.jsx(J,{size:40})}),e.jsx("h2",{className:"text-3xl font-display font-bold text-white mb-2",children:"Success!"}),e.jsx("p",{className:"text-gray-400",children:"Your account has been verified."}),e.jsx("p",{className:"text-gray-500 text-sm mt-1",children:"Redirecting to campus nodes..."})]}):m?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-8 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-accent/20 rounded-full flex items-center justify-center mx-auto mb-4 text-accent",children:e.jsx(Be,{size:32})}),e.jsx("h1",{className:"text-2xl font-display font-bold text-white mb-2",children:"Check Your Email"}),e.jsxs("p",{className:"text-gray-400 text-sm",children:["We sent a 6-digit code to ",e.jsx("span",{className:"text-white font-bold",children:h.email})]})]}),s&&e.jsx("div",{className:"mb-4 p-3 bg-red-500/10 border border-red-500/50 text-red-500 text-xs rounded-sm",children:s}),e.jsxs("form",{onSubmit:E,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs uppercase tracking-wider text-gray-500 mb-2 font-bold text-center",children:"Verification Code"}),e.jsx("input",{type:"text",value:g,onChange:x=>p(x.target.value.replace(/\D/g,"").slice(0,6)),className:"w-full bg-black/20 border border-white/10 p-4 text-center text-2xl font-mono tracking-[0.5em] text-white focus:outline-none focus:border-accent transition-colors",placeholder:"000000",required:!0})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"button",onClick:o,disabled:c,className:"text-xs text-accent hover:text-white underline disabled:opacity-50",children:"Resend Code"})}),e.jsx(A,{type:"submit",variant:"accent",fullWidth:!0,disabled:c||g.length<6,children:c?"Verifying...":"Verify Email"}),e.jsx("button",{type:"button",onClick:()=>_(!1),className:"w-full text-xs text-gray-500 hover:text-white transition-colors mt-4",children:"Incorrect email? Go back"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-8 text-center",children:[e.jsx("h1",{className:"text-3xl font-display font-bold text-white mb-2",children:"Join Campus Nodes"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Create an account to start trading & connecting"})]}),s&&e.jsx("div",{className:"mb-4 p-3 bg-red-500/10 border border-red-500/50 text-red-500 text-xs rounded-sm",children:s}),e.jsxs("form",{onSubmit:y,className:"space-y-5",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs uppercase tracking-wider text-gray-500 mb-2 font-bold",children:"First Name"}),e.jsx("input",{type:"text",name:"firstName",value:h.firstName,onChange:C,className:"w-full bg-black/20 border border-white/10 p-3 text-white focus:outline-none focus:border-accent transition-colors text-sm",placeholder:"Rohan",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs uppercase tracking-wider text-gray-500 mb-2 font-bold",children:"Last Name"}),e.jsx("input",{type:"text",name:"lastName",value:h.lastName,onChange:C,className:"w-full bg-black/20 border border-white/10 p-3 text-white focus:outline-none focus:border-accent transition-colors text-sm",placeholder:"Sharma",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs uppercase tracking-wider text-gray-500 mb-2 font-bold",children:"Student Email"}),e.jsx("input",{type:"email",name:"email",value:h.email,onChange:C,className:"w-full bg-black/20 border border-white/10 p-3 text-white focus:outline-none focus:border-accent transition-colors text-sm",placeholder:"firstname.lastname@nmims.edu",required:!0}),e.jsx("p",{className:"text-[10px] text-gray-500 mt-1",children:"We'll need this to verify your student status later."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs uppercase tracking-wider text-gray-500 mb-2 font-bold",children:"Create Password"}),e.jsx("input",{type:"password",name:"password",value:h.password,onChange:C,className:"w-full bg-black/20 border border-white/10 p-3 text-white focus:outline-none focus:border-accent transition-colors text-sm",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",required:!0})]}),e.jsxs("div",{className:"pt-2",children:[e.jsxs("div",{className:"flex items-start gap-2 mb-4",children:[e.jsx("input",{type:"checkbox",className:"mt-1 bg-black border-white/20 accent-accent",required:!0}),e.jsxs("span",{className:"text-xs text-gray-400 leading-tight",children:["I agree to the ",e.jsx("a",{href:"#",className:"text-white hover:underline",children:"Terms of Service"})," and ",e.jsx("a",{href:"#",className:"text-white hover:underline",children:"Privacy Policy"}),"."]})]}),e.jsx(A,{type:"submit",variant:"primary",fullWidth:!0,disabled:c,children:c?"Sending Code...":"Create Account"})]})]}),e.jsxs("div",{className:"mt-8 text-center text-sm text-gray-400",children:["Already have an account? ",e.jsx(L,{to:"/login",className:"text-white hover:text-accent font-bold transition-colors",children:"Sign In"})]})]})})]})},Pt=()=>{const{user:t,signOut:l}=U(),[c,i]=r.useState(!1),[s,a]=r.useState(!1),[m,_]=r.useState(!1),[d,j]=r.useState(!1),g=r.useRef(null),[p,S]=r.useState({firstName:t?.user_metadata?.first_name||"",lastName:t?.user_metadata?.last_name||"",bio:t?.user_metadata?.bio||""});if(r.useEffect(()=>{H({targets:".trust-score-counter",innerHTML:[0,95],round:1,easing:"easeInOutExpo",duration:2e3}),H({targets:".trust-ring-path",strokeDashoffset:[283,283-283*95/100],easing:"easeInOutExpo",duration:2500,delay:500})},[]),!t)return e.jsx("div",{className:"pt-32 px-12 text-white",children:"Please log in to view profile."});const v=t.user_metadata?.first_name?t.user_metadata.first_name[0]:t.email[0].toUpperCase(),f=t.user_metadata?.avatar_url,h=()=>{i(!0)},P=async()=>{await l(),i(!1)},C=async o=>{o.preventDefault(),_(!0);const{error:x}=await k.auth.updateUser({data:{first_name:p.firstName,last_name:p.lastName,bio:p.bio}}),{error:N}=await k.from("profiles").update({first_name:p.firstName,last_name:p.lastName,bio:p.bio}).eq("id",t.id);_(!1),N&&console.error("Profile update failed:",N),!x&&!N&&a(!1)},y=async o=>{try{j(!0);const x=o.target.files[0];if(!x)return;const N=x.name.split(".").pop(),u=`${`${t.id}/${Date.now()}.${N}`}`,{error:n}=await k.storage.from("avatars").upload(u,x);if(n)throw n;const{data:{publicUrl:b}}=k.storage.from("avatars").getPublicUrl(u),{error:z}=await k.auth.updateUser({data:{avatar_url:b}});if(await k.from("profiles").update({avatar_url:b}).eq("id",t.id),z||z)throw z}catch(x){console.error("Error uploading avatar:",x.message),alert(`Error: ${x.message}`)}finally{j(!1)}},E=async()=>{try{j(!0);const{error:o}=await k.auth.updateUser({data:{avatar_url:null}});if(await k.from("profiles").update({avatar_url:null}).eq("id",t.id),o)throw o}catch(o){console.error("Error removing avatar:",o.message)}finally{j(!1)}};return e.jsxs("div",{className:"min-h-screen bg-background pt-32 pb-20 px-6 md:px-12",children:[e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-8 items-start mb-12 relative group/profile",children:[!s&&e.jsxs("div",{className:"absolute top-0 right-0 flex gap-2 z-50",children:[e.jsx("button",{onClick:h,className:"p-3 text-red-500 hover:text-red-400 border border-red-500/30 rounded-full hover:bg-red-500/10 transition-colors",title:"Sign Out",children:e.jsx(Ve,{size:20})}),e.jsx("button",{onClick:o=>{o.preventDefault(),a(!0)},className:"p-3 text-gray-400 hover:text-white border border-white/10 rounded-full hover:bg-white/10 transition-colors cursor-pointer",title:"Edit Profile",children:e.jsx(He,{size:20})})]}),e.jsxs("div",{className:"relative group w-32 h-32 shrink-0",children:[e.jsx("div",{className:"w-full h-full rounded-full bg-gradient-to-br from-gray-800 to-black border-2 border-white/20 flex items-center justify-center text-4xl font-bold text-white shadow-2xl overflow-hidden relative",children:d?e.jsx(Ye,{className:"animate-spin text-white",size:32}):f?e.jsx("img",{src:f,alt:"Profile",className:"w-full h-full object-cover"}):v}),e.jsxs("div",{className:"absolute inset-0 bg-black/60 rounded-full opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-center justify-center gap-2 backdrop-blur-sm z-10",children:[e.jsx("button",{onClick:()=>g.current.click(),className:"p-2 bg-white/10 rounded-full hover:bg-white/20 text-white transition-colors",title:"Upload Photo",children:e.jsx(je,{size:18})}),f&&e.jsx("button",{onClick:E,className:"p-2 bg-red-500/20 rounded-full hover:bg-red-500/40 text-red-500 transition-colors",title:"Remove Photo",children:e.jsx(ce,{size:18})})]}),e.jsx("input",{type:"file",ref:g,onChange:y,className:"hidden",accept:"image/*"})]}),e.jsx("div",{className:"flex-1 w-full relative",children:s?e.jsxs("form",{onSubmit:C,className:"bg-white/5 border border-white/10 p-6 rounded-lg space-y-4 animate-fade-in relative",children:[e.jsx("button",{type:"button",onClick:()=>a(!1),className:"absolute top-4 right-4 text-gray-400 hover:text-white",children:e.jsx(D,{size:20})}),e.jsx("h3",{className:"text-xl font-bold text-white mb-4",children:"Edit Profile"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs uppercase tracking-wider text-gray-500 mb-1",children:"First Name"}),e.jsx("input",{type:"text",value:p.firstName,onChange:o=>S({...p,firstName:o.target.value}),className:"w-full bg-black border border-white/20 p-2 text-white focus:border-accent outline-none rounded"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs uppercase tracking-wider text-gray-500 mb-1",children:"Last Name"}),e.jsx("input",{type:"text",value:p.lastName,onChange:o=>S({...p,lastName:o.target.value}),className:"w-full bg-black border border-white/20 p-2 text-white focus:border-accent outline-none rounded"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs uppercase tracking-wider text-gray-500 mb-1",children:"Bio"}),e.jsx("textarea",{rows:"3",value:p.bio,onChange:o=>S({...p,bio:o.target.value}),className:"w-full bg-black border border-white/20 p-2 text-white focus:border-accent outline-none rounded"})]}),e.jsxs("button",{type:"submit",disabled:m,className:"px-6 py-2 bg-white text-black font-bold uppercase tracking-widest hover:bg-gray-200 transition-colors rounded flex items-center gap-2",children:[e.jsx(Ge,{size:16})," ",m?"Saving...":"Save Changes"]})]}):e.jsxs("div",{className:"animate-fade-in",children:[e.jsxs("h1",{className:"text-4xl font-display font-bold text-white mb-2",children:[t.user_metadata?.first_name||"Student"," ",t.user_metadata?.last_name||""]}),e.jsx("p",{className:"text-gray-400 mb-4",children:t.email}),e.jsx("p",{className:"text-gray-300 italic mb-6 max-w-xl",children:t.user_metadata?.bio||"No bio yet."}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-6 bg-white/5 border border-white/10 rounded-xl flex flex-col items-center justify-center relative overflow-hidden group",children:[e.jsx("div",{className:"absolute inset-0 bg-accent/5 opacity-0 group-hover:opacity-100 transition-opacity"}),e.jsxs("div",{className:"relative w-32 h-32 flex items-center justify-center mb-4",children:[e.jsxs("svg",{className:"absolute inset-0 w-full h-full rotate-[-90deg]",viewBox:"0 0 100 100",children:[e.jsx("circle",{cx:"50",cy:"50",r:"45",fill:"none",stroke:"#222",strokeWidth:"2"}),e.jsx("circle",{className:"trust-ring-path",cx:"50",cy:"50",r:"45",fill:"none",stroke:"#fff",strokeWidth:"2",strokeDasharray:"283",strokeDashoffset:"283",strokeLinecap:"round"})]}),e.jsx("div",{className:"text-center z-10",children:e.jsx("span",{className:"trust-score-counter text-3xl font-display font-bold text-white",children:"0"})})]}),e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wider font-bold",children:"Trust Score"})]}),e.jsxs("div",{className:"p-4 bg-white/5 border border-white/10 rounded flex items-center gap-3",children:[e.jsx(ve,{className:"text-blue-400",size:20}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wider",children:"Major"}),e.jsx("p",{className:"text-white",children:"Computer Engineering"})]})]})]})]})})]}),e.jsxs("div",{className:"mt-8 border-t border-white/10 pt-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-6",children:"Recent Activity"}),e.jsx("div",{className:"p-12 text-center border border-dashed border-white/10 rounded-lg text-gray-500",children:"No recent trades or services."})]})]}),c&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center px-4",children:[e.jsx("div",{className:"absolute inset-0 bg-transparent",onClick:()=>i(!1)}),e.jsxs("div",{className:"relative bg-black border border-white/10 p-6 rounded-xl w-full max-w-sm shadow-2xl animate-fade-in",children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"Sign Out"}),e.jsx("p",{className:"text-gray-400 mb-6",children:"Are you sure you want to sign out of your account?"}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>i(!1),className:"px-4 py-2 text-sm font-medium text-gray-300 hover:text-white transition-all border border-transparent hover:border-white hover:shadow-[0_0_15px_rgba(255,255,255,0.2)] rounded",children:"Cancel"}),e.jsx("button",{onClick:P,className:"px-4 py-2 text-sm font-bold bg-red-600 hover:bg-red-500 text-white rounded transition-all shadow-lg hover:shadow-[0_0_20px_rgba(220,38,38,0.6)]",children:"Sign Out"})]})]})]})]})},Tt=()=>e.jsxs("div",{className:"min-h-screen bg-background flex flex-col justify-center items-center",children:[e.jsx(Z,{className:"w-20 h-20 mb-8 opacity-50"}),e.jsx("h1",{className:"text-2xl font-display font-bold text-white tracking-widest",children:"SETTINGS"}),e.jsx("p",{className:"text-gray-500 mt-2",children:"Nothing to see here yet."})]}),Rt=()=>e.jsxs("div",{className:"min-h-screen bg-background flex flex-col justify-center items-center",children:[e.jsx(Z,{className:"w-16 h-16 mb-8"}),e.jsxs("h1",{className:"text-3xl font-display font-bold text-white tracking-widest uppercase text-center max-w-lg leading-relaxed",children:["Payment Gateway ",e.jsx("br",{})," Integration Pending"]}),e.jsx("p",{className:"text-gray-500 mt-4 text-sm",children:"This is a secure checkout placeholder."})]}),It=()=>{const{id:t}=Ke(),l=q(),{addToCart:c}=ct(),{user:i}=U(),{openAuthModal:s}=W(),a=ae.find(g=>g.id===parseInt(t)),[m,_]=r.useState(0),d=()=>{if(!i){s();return}l("/payment")},j=()=>{if(!i){s();return}c(a)};return a?e.jsx("div",{className:"min-h-screen bg-background pt-24 pb-20 px-6 md:px-12",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("button",{onClick:()=>l(-1),className:"flex items-center gap-2 text-gray-400 hover:text-white mb-8 transition-colors",children:[e.jsx(be,{size:20})," Back to Market"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-12",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"aspect-[4/3] bg-surface border border-white/10 rounded-lg overflow-hidden relative",children:a.images&&a.images.length>0?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:a.images[m],alt:a.title,className:"w-full h-full object-cover",onError:g=>{g.currentTarget.style.display="none";const p=g.currentTarget.parentElement.querySelector(".fallback-placeholder");p&&p.classList.remove("hidden"),p&&p.classList.add("flex")}}),e.jsxs("div",{className:"fallback-placeholder hidden absolute inset-0 bg-zinc-900 flex-col items-center justify-center gap-4",children:[e.jsx("div",{className:"w-24 h-24 rounded-full bg-white/5 flex items-center justify-center border border-white/10",children:e.jsx("span",{className:"font-display font-bold text-5xl text-white",children:"C"})}),e.jsx("p",{className:"text-gray-400 font-bold uppercase tracking-widest text-xs",children:"Seller did not upload an image"})]})]}):e.jsxs("div",{className:"absolute inset-0 bg-zinc-900 flex flex-col items-center justify-center gap-4",children:[e.jsx("div",{className:"w-24 h-24 rounded-full bg-white/5 flex items-center justify-center border border-white/10",children:e.jsx("span",{className:"font-display font-bold text-5xl text-white",children:"C"})}),e.jsx("p",{className:"text-gray-400 font-bold uppercase tracking-widest text-xs",children:"Seller did not upload an image"})]})}),a.images&&a.images.length>1&&e.jsx("div",{className:"flex gap-4 overflow-x-auto pb-2",children:a.images.map((g,p)=>e.jsx("button",{onClick:()=>_(p),className:`w-24 h-24 shrink-0 rounded-lg overflow-hidden border-2 transition-all ${m===p?"border-accent":"border-transparent opacity-50 hover:opacity-100"}`,children:e.jsx("img",{src:g,alt:"",className:"w-full h-full object-cover"})},p))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("span",{className:"text-accent font-bold uppercase tracking-wider text-sm",children:a.category}),e.jsxs("div",{className:"flex items-center gap-1 text-yellow-500",children:[e.jsx(oe,{size:16,fill:"currentColor"}),e.jsx("span",{className:"text-white font-bold",children:a.trustScore})]})]}),e.jsx("h1",{className:"text-4xl md:text-5xl font-display font-bold text-white mb-4",children:a.title}),e.jsx("p",{className:"text-3xl text-white font-light mb-8",children:a.price}),e.jsxs("div",{className:"bg-surface border border-white/5 p-6 rounded-lg mb-8",children:[e.jsx("p",{className:"text-gray-300 leading-relaxed mb-4",children:a.description||"No description provided."}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Sold by ",e.jsxs("span",{className:"text-white font-bold",children:["@",a.seller]})]})]}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs(A,{onClick:d,variant:"primary",fullWidth:!0,className:"flex items-center justify-center gap-2",children:[e.jsx(Xe,{size:18})," Buy Now"]}),e.jsxs(A,{onClick:j,variant:"outline",fullWidth:!0,className:"flex items-center justify-center gap-2",children:[e.jsx(Je,{size:18})," Add to Cart"]})]})]})]})]})}):e.jsx("div",{className:"text-white pt-32 text-center",children:"Product not found"})},me="7.9.0",$t=[{title:"OTP Verification Fix",description:"Fixed critical email verification error that prevented users from completing signup."},{title:"Enhanced Error Handling",description:"Added detailed debug logging and better error messages for troubleshooting verification issues."},{title:"Chat Crash Fix",description:"Resolved ChatWidget crash that occurred when non-logged-in users tried to open chat."},{title:"Vercel Deployment",description:"Migrated to Vercel for faster builds, better performance, and preview deployments."},{title:"Publishing Workflow Update",description:"Added changelog documentation to publishing process for better release tracking."},{title:"Lighter & Faster",description:"Removed heavy 3D rendering. The app now loads faster and uses less resources."},{title:"Mobile Text Fix",description:"Loading screen text now wraps properly on smaller screens."},{title:"End-to-End Encrypted Chat",description:"Your messages are encrypted client-side. Only you and your friend can read them."},{title:"Storage Optimization",description:"Removing a friend clears chat history to save database space."},{title:"Mobile Bottom Bar",description:"New 5-icon navigation bar: Services, Market, Home, Chat, and Profile."}],At=()=>{const[t,l]=r.useState(!1),[c,i]=r.useState(!1),[s,a]=r.useState(!1),m=Y();r.useEffect(()=>{const d=()=>a(window.innerWidth<768);return d(),window.addEventListener("resize",d),()=>window.removeEventListener("resize",d)},[]),r.useEffect(()=>{const d=m.pathname==="/"||m.pathname==="/campusnodes/"||m.pathname==="/CampusNodes/";l(!!d)},[m]);const _=()=>{l(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(V,{children:t&&e.jsx(I.div,{initial:{y:-50,x:"-50%",opacity:0},animate:{y:0,x:"-50%",opacity:1},exit:{y:-50,x:"-50%",opacity:0},className:"fixed top-6 left-1/2 -translate-x-1/2 w-[95%] md:w-auto min-w-[320px] md:min-w-[500px] z-[40] group",children:e.jsx("div",{className:"relative overflow-hidden rounded-full bg-black/80 backdrop-blur-md border border-blue-500/30 shadow-[0_0_15px_rgba(59,130,246,0.1)] transition-all duration-300 hover:shadow-[0_0_25px_rgba(59,130,246,0.4)] hover:border-blue-500/50",children:e.jsxs("div",{className:"px-4 py-2 flex items-center justify-between gap-4 text-xs md:text-sm",children:[e.jsxs("div",{className:"flex items-center gap-3 text-white shrink-0",children:[e.jsx("span",{className:"bg-blue-600 text-white font-bold px-2 py-0.5 rounded text-[10px] uppercase tracking-wider shadow-[0_0_10px_rgba(37,99,235,0.4)]",children:"New"}),e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx(te,{size:12,className:"text-blue-400 animate-pulse"}),e.jsx("span",{className:"text-gray-200",children:"Updated to"}),e.jsx("span",{className:"font-bold font-mono text-blue-400",children:me})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I.button,{onClick:()=>i(!0),initial:"idle",whileHover:"hover",animate:"idle",className:"relative flex items-center justify-center h-8 rounded-full transition-all duration-300 border border-transparent",children:e.jsxs(I.div,{variants:{idle:{width:"auto",paddingLeft:0,paddingRight:0,backgroundColor:"rgba(59, 130, 246, 0)"},hover:s?{width:"auto",paddingLeft:0,paddingRight:0,backgroundColor:"rgba(59, 130, 246, 0)"}:{width:"auto",paddingLeft:"12px",paddingRight:"12px",backgroundColor:"rgba(37, 99, 235, 1)"}},className:"flex items-center gap-2 overflow-hidden h-full rounded-full",children:[e.jsx("span",{className:"flex items-center justify-center w-8 h-8 rounded-full shrink-0 bg-blue-500/0 hover:bg-blue-500 hover:shadow-[0_0_15px_rgba(59,130,246,0.6)] transition-all duration-300 group/btn",children:e.jsx(Ze,{size:14,className:"text-blue-400 group-hover/btn:text-white transition-colors"})}),!s&&e.jsx(I.span,{variants:{idle:{width:0,opacity:0,display:"none"},hover:{width:"auto",opacity:1,display:"block"}},transition:{duration:.2},className:"whitespace-nowrap font-medium text-white",children:"Patch Notes"})]})}),e.jsx(I.button,{onClick:_,initial:"idle",whileHover:"hover",animate:"idle",className:"relative flex items-center justify-center h-8 rounded-full transition-all duration-300 border border-transparent",children:e.jsxs(I.div,{variants:{idle:{width:"auto",paddingLeft:0,paddingRight:0,backgroundColor:"rgba(239, 68, 68, 0)"},hover:s?{width:"auto",paddingLeft:0,paddingRight:0,backgroundColor:"rgba(239, 68, 68, 0)"}:{width:"auto",paddingLeft:"12px",paddingRight:"12px",backgroundColor:"rgba(220, 38, 38, 1)"}},className:"flex items-center gap-2 overflow-hidden h-full rounded-full",children:[e.jsx("span",{className:"flex items-center justify-center w-8 h-8 rounded-full shrink-0 bg-red-500/0 hover:bg-red-500 hover:shadow-[0_0_15px_rgba(239,68,68,0.6)] transition-all duration-300 group/btn",children:e.jsx(D,{size:14,className:"text-red-400 group-hover/btn:text-white transition-colors"})}),!s&&e.jsx(I.span,{variants:{idle:{width:0,opacity:0,display:"none"},hover:{width:"auto",opacity:1,display:"block"}},transition:{duration:.2},className:"whitespace-nowrap font-medium text-white",children:"Close"})]})})]})]})})})}),e.jsx(V,{children:c&&e.jsxs("div",{className:"fixed inset-0 z-[110] flex items-center justify-center p-4",children:[e.jsx(I.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>i(!1),className:"absolute inset-0 bg-black/80"}),e.jsxs(I.div,{initial:{scale:.9,opacity:0,y:20},animate:{scale:1,opacity:1,y:0},exit:{scale:.9,opacity:0,y:20},className:"relative bg-[#0f1115] border border-blue-500/20 w-full max-w-lg rounded-2xl shadow-[0_0_50px_rgba(59,130,246,0.15)] overflow-hidden flex flex-col max-h-[70vh]",children:[e.jsxs("div",{className:"p-6 border-b border-white/5 bg-gradient-to-r from-blue-900/20 to-transparent flex items-center justify-between shrink-0",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:[e.jsx(te,{className:"text-blue-400",size:20}),"Patch Notes"]}),e.jsxs("p",{className:"text-blue-400/60 text-xs font-mono mt-1",children:["Version ",me]})]}),e.jsx("button",{onClick:()=>i(!1),className:"p-2 hover:bg-white/10 rounded-full transition-colors text-gray-400 hover:text-white",children:e.jsx(D,{size:20})})]}),e.jsx("div",{className:"p-6 overflow-y-auto custom-scrollbar",children:e.jsx("div",{className:"space-y-6",children:$t.map((d,j)=>e.jsxs("div",{className:"group",children:[e.jsxs("h3",{className:"text-white font-medium mb-1 group-hover:text-blue-400 transition-colors flex items-center gap-2",children:[e.jsx(ne,{size:14,className:"text-blue-500/50 group-hover:text-blue-500 transition-colors"}),d.title]}),e.jsx("p",{className:"text-gray-400 text-sm leading-relaxed pl-6",children:d.description})]},j))})}),e.jsx("div",{className:"p-4 border-t border-white/5 bg-black/20 shrink-0 text-center",children:e.jsx("p",{className:"text-xs text-gray-500",children:"Thank you for being part of our beta."})})]})]})})]})},Lt=()=>{const{isAuthModalOpen:t,closeAuthModal:l}=W(),c=q(),i=s=>{l(),c(s)};return e.jsx(V,{children:t&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center px-4",children:[e.jsx(I.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:l,className:"absolute inset-0 bg-transparent"}),e.jsxs(I.div,{initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},className:"relative bg-black border border-white/10 p-8 rounded-2xl w-full max-w-sm shadow-2xl z-10",children:[e.jsx("button",{onClick:l,className:"absolute top-4 right-4 text-gray-500 hover:text-white transition-colors",children:e.jsx(D,{size:20})}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h2",{className:"text-2xl font-display font-bold text-white mb-2",children:"Join Campus Nodes"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Connect, trade, and collaborate with your campus community."})]}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("button",{onClick:()=>i("/signup"),className:"w-full py-3 bg-white text-black font-bold uppercase tracking-wider rounded flex items-center justify-center gap-2 transition-all shadow-[0_0_15px_rgba(255,255,255,0.3)] hover:shadow-[0_0_25px_rgba(255,255,255,0.5)] hover:scale-[1.02]",children:[e.jsx(Qe,{size:18}),"Sign Up"]}),e.jsxs("button",{onClick:()=>i("/login"),className:"w-full py-3 border border-white/10 hover:border-white text-white font-medium uppercase tracking-wider rounded flex items-center justify-center gap-2 transition-all hover:shadow-[0_0_15px_rgba(255,255,255,0.2)] hover:scale-[1.02]",children:[e.jsx(et,{size:18}),"Sign In"]})]})]})]})})},Dt=()=>{const{user:t}=U(),{isChatOpen:l,openChat:c,closeChat:i,addUnreadSender:s,removeUnreadSender:a,unreadSenders:m,openAuthModal:_}=W(),[d,j]=r.useState(null),[g,p]=r.useState([]),[S,v]=r.useState([]),[f,h]=r.useState(""),[P,C]=r.useState(!1),y=r.useRef(null),E=()=>{y.current?.scrollIntoView({behavior:"smooth"})};r.useEffect(()=>{if(!t)return;const u=k.channel("global_chat_listener").on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:`receiver_id=eq.${t.id}`},n=>{(!l||d&&d.id!==n.new.sender_id||!d)&&s(n.new.sender_id)}).subscribe();return()=>{k.removeChannel(u)}},[t,l,d]),r.useEffect(()=>{d&&a(d.id)},[d]),r.useEffect(()=>{l&&t&&o()},[l,t]),r.useEffect(()=>{if(d){x(d.id);const u=k.channel(`chat:${d.id}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:`sender_id=eq.${d.id}`},n=>{if(n.new.receiver_id===t.id){const b=B(n.new.content,n.new.sender_id,n.new.receiver_id),z={...n.new,content:b};v(R=>[...R,z]),E()}}).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:`sender_id=eq.${t.id}`},n=>{if(n.new.receiver_id===d.id){const b=B(n.new.content,n.new.sender_id,n.new.receiver_id),z={...n.new,content:b};v(R=>R.find(T=>T.id===n.new.id)?R:[...R,z]),E()}}).subscribe();return()=>{k.removeChannel(u)}}},[d,t]);const o=async()=>{try{const{data:u,error:n}=await k.from("friendships").select("*").or(`user1_id.eq.${t.id},user2_id.eq.${t.id}`).eq("status","accepted");if(n)throw n;const b=u.map(R=>R.user1_id===t.id?R.user2_id:R.user1_id);if(b.length===0){p([]);return}const{data:z}=await k.from("profiles").select("*").in("id",b);p(z||[])}catch(u){console.error(u)}},x=async u=>{try{C(!0);const n=new Date(Date.now()-1440*60*1e3).toISOString(),{data:b,error:z}=await k.from("messages").select("*").or(`and(sender_id.eq.${t.id},receiver_id.eq.${u}),and(sender_id.eq.${u},receiver_id.eq.${t.id})`).gt("created_at",n).order("created_at",{ascending:!0}).limit(100);if(z)throw z;const R=b.filter(T=>!(T.sender_id===t.id&&T.deleted_by_sender||T.receiver_id===t.id&&T.deleted_by_receiver)).map(T=>({...T,content:B(T.content,T.sender_id,T.receiver_id)}));v(R||[]),setTimeout(E,100)}catch(n){console.error(n)}finally{C(!1)}},N=async()=>{if(!(!d||!confirm("Clear chat history? This cannot be undone.")))try{await k.from("messages").update({deleted_by_sender:!0}).eq("sender_id",t.id).eq("receiver_id",d.id),await k.from("messages").update({deleted_by_receiver:!0}).eq("receiver_id",t.id).eq("sender_id",d.id),v([])}catch(u){console.error("Failed to clear chat",u)}},w=async u=>{if(u.preventDefault(),!f.trim()||!d)return;const n=f.trim();h("");const b={id:Date.now(),sender_id:t.id,receiver_id:d.id,content:n,created_at:new Date().toISOString(),is_temp:!0};v(z=>[...z,b]),E();try{const z=ze(n,t.id,d.id),{error:R,data:T}=await k.from("messages").insert({sender_id:t.id,receiver_id:d.id,content:z}).select();if(R)throw R;const O=T[0],G={...O,content:B(O.content,O.sender_id,O.receiver_id)};v(Q=>Q.map(K=>K.id===b.id?G:K))}catch(z){console.error("Failed to send",z)}};return e.jsx(e.Fragment,{children:e.jsx(V,{children:l&&e.jsxs(I.div,{initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},transition:{type:"spring",stiffness:300,damping:30},className:`fixed z-[60] bg-black border-b border-white/20 shadow-2xl overflow-hidden\r
                                   inset-x-0 top-0 bottom-24 md:z-[9999] md:border md:inset-auto md:bottom-6 md:right-6 md:w-96 md:h-[500px] md:rounded-2xl flex flex-col`,children:[e.jsxs("div",{className:"h-16 bg-black/50 backdrop-blur-md border-b border-white/10 flex items-center justify-between px-4 shrink-0",children:[e.jsx("div",{className:"flex items-center gap-3",children:d?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>j(null),className:"md:hidden p-1 hover:bg-white/10 rounded-full",children:e.jsx(X,{size:24})}),e.jsx("button",{onClick:()=>j(null),className:"hidden md:block p-1 hover:bg-white/10 rounded-full mr-1",children:e.jsx(X,{size:18})}),e.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-700 overflow-hidden border border-white/20",children:d.avatar_url?e.jsx("img",{src:d.avatar_url,alt:"",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-xs",children:d.first_name?.[0]})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-white text-sm",children:[d.first_name," ",d.last_name]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500 animate-pulse"}),e.jsx("span",{className:"text-[10px] text-gray-400",children:"Online"})]})]})]}):e.jsxs("h3",{className:"font-bold text-white text-lg flex items-center gap-2",children:[e.jsx(le,{size:20,className:"text-accent"}),"Messages ",e.jsx(we,{size:12,className:"text-green-500/50 ml-1",title:"End-to-End Encrypted"})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[d&&e.jsx("button",{onClick:N,className:"p-2 hover:bg-white/10 rounded-full text-gray-400 hover:text-red-500 transition-colors",title:"Clear Chat",children:e.jsx(ce,{size:18})}),e.jsx("button",{onClick:i,className:"hidden md:block p-2 hover:bg-white/10 rounded-full text-gray-400 hover:text-white",children:e.jsx(D,{size:20})})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto bg-zinc-900/50 relative",children:[d&&e.jsx("div",{className:"sticky top-4 z-10 flex justify-center w-full pointer-events-none mb-2",children:e.jsxs("div",{className:"bg-black/60 backdrop-blur-md border border-white/10 px-3 py-1 rounded-full flex items-center gap-1.5 shadow-xl",children:[e.jsx(tt,{size:12,className:"text-accent"}),e.jsx("span",{className:"text-[10px] text-white font-medium",children:"1-Day Disappearing Messages"})]})}),d?e.jsxs("div",{className:"p-4 space-y-4 min-h-full flex flex-col justify-end",children:[S.map((u,n)=>e.jsx("div",{className:`flex ${u.sender_id===t.id?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[75%] px-4 py-2 rounded-2xl text-sm ${u.sender_id===t.id?"bg-accent text-black rounded-tr-sm":"bg-white/10 text-white rounded-tl-sm border border-white/10"}`,children:[e.jsx("p",{children:u.content}),e.jsx("span",{className:`text-[9px] block mt-1 opacity-50 ${u.sender_id===t.id?"text-black":"text-gray-400"}`,children:new Date(u.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})},u.id||n)),e.jsx("div",{ref:y})]}):e.jsx("div",{className:"p-4 space-y-2",children:g.length===0?e.jsxs("div",{className:"text-center text-gray-500 mt-10",children:[e.jsx("p",{children:"No friends yet."}),e.jsx("p",{className:"text-xs",children:"Connect with people to chat!"})]}):g.map(u=>e.jsxs("button",{onClick:()=>j(u),className:"w-full p-3 rounded-lg hover:bg-white/5 flex items-center gap-3 transition-colors text-left group border border-transparent hover:border-white/10 relative",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-700 overflow-hidden border border-white/10 group-hover:border-accent/50 transition-colors",children:u.avatar_url?e.jsx("img",{src:u.avatar_url,alt:"",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-400",children:e.jsx(ee,{size:20})})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h4",{className:"font-bold text-white text-sm",children:[u.first_name," ",u.last_name]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Click to chat"})]}),m.has(u.id)&&e.jsx("div",{className:"w-3 h-3 bg-accent rounded-full animate-pulse shadow-[0_0_10px_rgba(34,211,238,0.5)]"})]},u.id))})]}),d&&e.jsxs("form",{onSubmit:w,className:"p-3 bg-black/50 border-t border-white/10 shrink-0 flex gap-2",children:[e.jsx("input",{type:"text",value:f,onChange:u=>h(u.target.value),placeholder:"Type a message...",className:"flex-1 bg-white/5 border border-white/10 rounded-full px-4 py-2 text-sm text-white focus:outline-none focus:border-accent/50 transition-colors"}),e.jsx("button",{type:"submit",disabled:!f.trim(),className:"w-9 h-9 bg-accent text-black rounded-full flex items-center justify-center hover:scale-105 active:scale-95 disabled:opacity-50 disabled:hover:scale-100 transition-all font-bold",children:e.jsx(ye,{size:16,className:f.trim()?"ml-0.5":""})})]})]})})})},Ot=()=>{const{pathname:t}=Y();return r.useEffect(()=>{window.scrollTo(0,0)},[t]),null},Ft=()=>{const t=Y(),l=t.pathname==="/"||t.pathname==="/campusnodes/"||t.pathname==="/CampusNodes/";return e.jsx("div",{className:`fixed inset-0 z-0 transition-opacity duration-1000 ${l?"opacity-100 pointer-events-auto":"opacity-10 pointer-events-none"}`,children:e.jsx(Se,{})})},qt=({children:t})=>{const l=Y(),{isSidebarCollapsed:c}=W(),i=l.pathname==="/"||l.pathname==="/campusnodes/"||l.pathname==="/CampusNodes/";return e.jsx("div",{className:`min-h-screen text-white font-sans selection:bg-accent selection:text-white cursor-none relative z-10 transition-all duration-300 ${i?"bg-transparent":"bg-background"} ${c?"md:pl-0":"md:pl-[260px]"}`,children:t})},Ut=()=>e.jsx(lt,{children:e.jsx(ot,{children:e.jsx(dt,{children:e.jsxs(st,{children:[e.jsx(mt,{}),e.jsx(Ot,{}),e.jsx(At,{}),e.jsx(Ft,{}),e.jsx(ht,{}),e.jsx(qt,{children:e.jsxs(rt,{children:[e.jsx($,{path:"/",element:e.jsx(pt,{})}),e.jsx($,{path:"/market",element:e.jsx(gt,{})}),e.jsx($,{path:"/services",element:e.jsx(jt,{})}),e.jsx($,{path:"/connections",element:e.jsx(wt,{})}),e.jsx($,{path:"/login",element:e.jsx(Nt,{})}),e.jsx($,{path:"/signup",element:e.jsx(Mt,{})}),e.jsx($,{path:"/profile",element:e.jsx(Pt,{})}),e.jsx($,{path:"/messages",element:e.jsx(yt,{})}),e.jsx($,{path:"/settings",element:e.jsx(Tt,{})}),e.jsx($,{path:"/payment",element:e.jsx(Rt,{})}),e.jsx($,{path:"/market/:id",element:e.jsx(It,{})})]})}),e.jsx(Lt,{}),e.jsx(Dt,{}),e.jsx(ut,{})]})})})});class Wt extends Ne.Component{constructor(l){super(l),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(l){return{hasError:!0,error:l}}componentDidCatch(l,c){console.error("Uncaught error:",l,c),this.setState({errorInfo:c})}render(){return this.state.hasError?e.jsxs("div",{className:"min-h-screen bg-black text-red-500 p-8 font-mono overflow-auto",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Something went wrong."}),e.jsxs("div",{className:"bg-gray-900 p-4 rounded border border-red-900",children:[e.jsx("h2",{className:"font-bold text-white",children:"Error Message:"}),e.jsx("pre",{className:"whitespace-pre-wrap",children:this.state.error&&this.state.error.toString()}),e.jsx("br",{}),e.jsx("h2",{className:"font-bold text-white",children:"Stack Trace:"}),e.jsx("pre",{className:"text-xs text-gray-400 whitespace-pre-wrap",children:this.state.errorInfo&&this.state.errorInfo.componentStack})]})]}):this.props.children}}at.createRoot(document.getElementById("root")).render(e.jsx(Ne.StrictMode,{children:e.jsx(Wt,{children:e.jsx(Ut,{})})}));
