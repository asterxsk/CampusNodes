import{c as Te,r,j as e,m as I,u as H,a as F,R as ne,L as A,C as ie,U as ee,W as le,S as fe,M as oe,b as ge,Z as Re,A as he,d as ce,H as Ie,X as D,e as be,f as te,g as ve,T as $e,h as V,i as K,B as je,P as Ae,k as Le,l as we,n as De,o as Oe,p as qe,q as Fe,s as Z,t as ue,v as se,w as ye,x as de,y as Ne,z as X,I as Ue,D as We,E as Be,F as Ve,G as He,J as Ye,K as Ge,N as Ke,O as Xe,Q as Je,V as Ze,Y as Qe,_ as et,$ as tt,a0 as st,a1 as rt,a2 as $,a3 as at}from"./vendor-BA4QalRR.js";(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))c(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const u of n.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&c(u)}).observe(document,{childList:!0,subtree:!0});function l(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function c(s){if(s.ep)return;s.ep=!0;const n=l(s);fetch(s.href,n)}})();const nt="https://bvmcchnxpcvifcblbisa.supabase.co",it="sb_publishable_lfQTIS91bkBxwjrVzI-x6w_JE45Bmzg",_=Te(nt,it),ke=r.createContext({}),U=()=>r.useContext(ke),lt=({children:t})=>{const[i,l]=r.useState(null),[c,s]=r.useState(!0);r.useEffect(()=>{(async()=>{const{data:{session:d}}=await _.auth.getSession();l(d?.user??null),s(!1)})();const{data:{subscription:g}}=_.auth.onAuthStateChange((d,w)=>{l(w?.user??null),s(!1)});return()=>g.unsubscribe()},[]);const n=async()=>{await _.auth.signOut()};return e.jsx(ke.Provider,{value:{user:i,loading:c,signOut:n},children:!c&&t})},_e=r.createContext(),ot=({children:t})=>{const[i,l]=r.useState([]),c=n=>{l(u=>[...u,n])},s=n=>{l(u=>u.filter(g=>g.id!==n))};return e.jsx(_e.Provider,{value:{cartItems:i,addToCart:c,removeFromCart:s},children:t})},ct=()=>r.useContext(_e),Ce=r.createContext(),dt=({children:t})=>{const[i,l]=r.useState(new Set),[c,s]=r.useState(!1),[n,u]=r.useState(!1),[g,d]=r.useState(!0),w=()=>s(!0),b=()=>s(!1),m=()=>u(S=>!S),E=()=>u(!0),v=()=>u(!1),x=S=>{l(C=>{const N=new Set(C);return N.add(S),N})},p=S=>{l(C=>{const N=new Set(C);return N.delete(S),N})};return e.jsx(Ce.Provider,{value:{isAuthModalOpen:c,openAuthModal:w,closeAuthModal:b,isChatOpen:n,toggleChat:m,openChat:E,closeChat:v,unreadCount:i.size,unreadSenders:i,addUnreadSender:x,removeUnreadSender:p,isSidebarCollapsed:g,setIsSidebarCollapsed:d},children:t})},W=()=>{const t=r.useContext(Ce);if(!t)throw new Error("useUI must be used within a UIProvider");return t},J=({className:t="w-10 h-10"})=>e.jsxs("svg",{viewBox:"0 0 100 100",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:t,children:[e.jsx("path",{d:"M 80 30 C 70 10, 30 10, 20 50 C 10 90, 70 90, 80 70",stroke:"white",strokeWidth:"4",strokeLinecap:"round"}),e.jsx("circle",{cx:"80",cy:"30",r:"6",fill:"white"}),e.jsx("circle",{cx:"20",cy:"50",r:"6",fill:"white"}),e.jsx("circle",{cx:"80",cy:"70",r:"6",fill:"white"}),e.jsx("line",{x1:"80",y1:"30",x2:"50",y2:"20",stroke:"white",strokeWidth:"2",opacity:"0.5"}),e.jsx("line",{x1:"50",y1:"20",x2:"20",y2:"50",stroke:"white",strokeWidth:"2",opacity:"0.5"}),e.jsx("line",{x1:"20",y1:"50",x2:"50",y2:"80",stroke:"white",strokeWidth:"2",opacity:"0.5"}),e.jsx("line",{x1:"50",y1:"80",x2:"80",y2:"70",stroke:"white",strokeWidth:"2",opacity:"0.5"}),e.jsx("circle",{cx:"50",cy:"20",r:"4",fill:"white"}),e.jsx("circle",{cx:"50",cy:"80",r:"4",fill:"white"})]}),re=({children:t})=>{const i=r.useRef(null),[l,c]=r.useState({x:0,y:0}),s=d=>{const{clientX:w,clientY:b}=d,{height:m,width:E,left:v,top:x}=i.current.getBoundingClientRect(),p=w-(v+E/2),S=b-(x+m/2);c({x:p*.3,y:S*.3})},n=()=>{c({x:0,y:0})},{x:u,y:g}=l;return e.jsx(I.div,{ref:i,className:"magnetic-wrap inline-block",onMouseMove:s,onMouseLeave:n,animate:{x:u,y:g},transition:{type:"spring",stiffness:150,damping:15,mass:.1},children:t})},xt=[{name:"Market",path:"/market",icon:e.jsx(fe,{size:20})},{name:"Services",path:"/services",icon:e.jsx(le,{size:20})},{name:"Connections",path:"/connections",icon:e.jsx(ge,{size:20})},{name:"Chat",path:"/messages",icon:e.jsx(oe,{size:20}),isMessages:!0}],ht=()=>{const[t,i]=r.useState(!1),{user:l}=U(),{openAuthModal:c,toggleChat:s,isChatOpen:n,unreadCount:u,isSidebarCollapsed:g,setIsSidebarCollapsed:d}=W(),w=H(),b=F(),[m,E]=r.useState(0);ne.useEffect(()=>{},[l]);const v=()=>{l?b("/profile"):c()};return e.jsxs(e.Fragment,{children:[e.jsxs(I.div,{initial:!1,animate:{width:g?"auto":"260px",transition:{duration:.4,type:"spring",stiffness:200,damping:25,mass:.8}},className:`hidden md:flex flex-col fixed left-0 z-50 bg-black/80 backdrop-blur-xl border border-white/10 ${g?"top-1/2 -translate-y-1/2 left-3 rounded-2xl h-auto w-fit shadow-2xl":"top-0 h-screen border-r rounded-none"}`,children:[e.jsx("div",{className:`flex items-center w-full ${g?"py-3 justify-center px-0":"h-16 px-5 border-b border-white/5"}`,children:g?e.jsx(A,{to:"/",className:"flex items-center justify-center",children:e.jsx("div",{className:"shrink-0 scale-75",children:e.jsx(J,{})})}):e.jsxs(A,{to:"/",className:"flex items-center gap-3 overflow-hidden w-full",children:[e.jsx("div",{className:"shrink-0 scale-75",children:e.jsx(J,{})}),e.jsxs(I.span,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},exit:{opacity:0,x:-10},className:"font-display font-bold text-lg text-white whitespace-nowrap",children:[e.jsx("span",{className:"text-accent",children:"Campus"}),"Nodes"]})]})}),e.jsx("div",{className:`flex-1 overflow-y-auto custom-scrollbar ${g?"py-2 px-2":"py-4 px-3"}`,children:e.jsx("div",{className:"space-y-1 w-full flex flex-col items-center",children:xt.map((x,p)=>{const S=w.pathname===x.path;return e.jsx(A,{to:x.path,className:"block w-full",children:e.jsx(re,{children:e.jsxs(I.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:p*.05},className:`flex items-center gap-4 py-3.5 rounded-xl transition-all group relative overflow-hidden w-full ${S?"bg-accent/15 text-white":"text-gray-400 hover:text-white hover:bg-white/5"} ${g?"justify-center px-1":"px-5"}`,children:[e.jsxs("div",{className:`relative z-10 transition-all ${S?"text-accent drop-shadow-[0_0_8px_rgba(34,211,238,0.5)]":"group-hover:text-white"} ${g?"flex items-center justify-center":""}`,children:[x.icon,x.isMessages&&u>0&&g&&e.jsx("div",{className:"absolute -top-1 -right-1 w-2.5 h-2.5 bg-red-500 rounded-full border border-black"})]}),!g&&e.jsxs("div",{className:"flex-1 flex items-center justify-between z-10 relative",children:[e.jsx("span",{className:"font-semibold whitespace-nowrap text-base",children:x.name}),x.isMessages&&u>0&&e.jsx("span",{className:"bg-red-500 text-white text-[10px] font-bold px-1.5 py-0.5 rounded-full min-w-[18px] text-center",children:u})]}),S&&e.jsx(I.div,{layoutId:"activeTab",className:"absolute inset-0 bg-accent/10 rounded-xl border border-accent/20"})]})})},x.name)})})}),e.jsx("div",{className:`border-t ${g?"border-white/10 py-2 px-2":"border-white/5 py-2 px-3"}`,children:e.jsxs("button",{onClick:()=>d(!g),className:`flex items-center gap-4 py-3.5 rounded-xl transition-all group relative overflow-hidden w-full text-gray-400 hover:text-white hover:bg-white/5 ${g?"justify-center px-1":"px-5"}`,children:[e.jsx("div",{className:"relative z-10 transition-all group-hover:text-white",children:e.jsx("div",{className:"w-6 h-6 flex items-center justify-center",children:e.jsx(ie,{size:20,className:`transition-transform duration-300 ${g?"":"rotate-180"}`})})}),!g&&e.jsx("span",{className:"font-semibold whitespace-nowrap z-10 relative text-base",children:"Minimize"})]})}),e.jsx("div",{className:`border-t ${g?"border-white/10 p-2":"border-white/5 p-3"} w-full`,children:e.jsxs("button",{onClick:v,className:`flex items-center gap-3 w-full p-2 rounded-xl hover:bg-white/5 transition-all ${g?"justify-center":""}`,children:[e.jsx("div",{className:"w-9 h-9 rounded-full bg-gray-700 overflow-hidden border border-white/20 shrink-0",children:l?.user_metadata?.avatar_url?e.jsx("img",{src:l.user_metadata.avatar_url,alt:"",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-xs font-bold text-white",children:l?.user_metadata?.first_name?l.user_metadata.first_name[0]:e.jsx(ee,{size:16})})}),!g&&e.jsx("div",{className:"text-left overflow-hidden",children:l?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm font-bold text-white truncate",children:l.user_metadata?.first_name||"User"}),e.jsx("p",{className:"text-xs text-gray-500 truncate",children:l.email})]}):e.jsx("p",{className:"text-sm font-medium text-gray-400",children:"Sign In"})})]})})]}),e.jsx("div",{className:"md:hidden fixed bottom-0 left-0 right-0 bg-black/95 backdrop-blur-xl border-t border-white/10 z-[70] safe-area-bottom",children:e.jsxs("div",{className:"flex items-center justify-around py-2 px-2",children:[e.jsxs(A,{to:"/services",className:`flex flex-col items-center gap-1 py-2 px-3 rounded-xl transition-all ${w.pathname==="/services"?"text-accent":"text-white/50"}`,children:[e.jsx(le,{size:22}),e.jsx("span",{className:"text-[10px] font-medium",children:"Services"})]}),e.jsxs(A,{to:"/market",className:`flex flex-col items-center gap-1 py-2 px-3 rounded-xl transition-all ${w.pathname==="/market"?"text-accent":"text-white/50"}`,children:[e.jsx(fe,{size:22}),e.jsx("span",{className:"text-[10px] font-medium",children:"Market"})]}),e.jsxs("button",{onClick:v,className:`flex flex-col items-center gap-1 py-1 px-3 rounded-xl transition-all relative ${w.pathname==="/profile"?"text-accent":"text-white/50"}`,children:[e.jsx("div",{className:`w-10 h-10 rounded-full overflow-hidden border-2 ${w.pathname==="/profile"?"border-accent":"border-white/20"}`,children:l?l.user_metadata?.avatar_url?e.jsx("img",{src:l.user_metadata.avatar_url,alt:"Profile",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-gray-700 flex items-center justify-center text-sm font-bold text-white",children:l.user_metadata?.first_name?l.user_metadata.first_name[0]:"U"}):e.jsx("div",{className:"w-full h-full bg-gray-700 flex items-center justify-center",children:e.jsx(ee,{size:18,className:"text-white/60"})})}),m>0&&e.jsx("div",{className:"absolute top-0 right-2 w-4 h-4 bg-red-500 rounded-full flex items-center justify-center border border-black z-50",children:e.jsx("span",{className:"text-[9px] font-bold text-white",children:m})})]}),e.jsxs(A,{to:"/messages",className:`flex flex-col items-center gap-1 py-2 px-3 rounded-xl transition-all relative ${w.pathname==="/messages"?"text-accent":"text-white/50"}`,children:[e.jsx(oe,{size:22}),e.jsx("span",{className:"text-[10px] font-medium",children:"Chat"}),u>0&&e.jsx("div",{className:"absolute top-1 right-1 w-4 h-4 bg-red-500 rounded-full flex items-center justify-center border border-black z-50",children:e.jsx("span",{className:"text-[9px] font-bold text-white",children:u})})]}),e.jsxs(A,{to:"/connections",className:`flex flex-col items-center gap-1 py-2 px-3 rounded-xl transition-all ${w.pathname==="/connections"?"text-accent":"text-white/50"}`,children:[e.jsx(ge,{size:22}),e.jsx("span",{className:"text-[10px] font-medium",children:"Connections"})]})]})})]})},ut=()=>{const t=r.useRef(null),i=r.useRef(null),l=H(),c=r.useRef({x:0,y:0}),s=r.useRef({x:0,y:0}),[n,u]=r.useState(!1),[g,d]=r.useState(!1),[w,b]=r.useState(!1),[m,E]=r.useState(!1);r.useEffect(()=>{E(window.matchMedia("(pointer: coarse)").matches)},[]);const v=.15;return r.useEffect(()=>{const S=C=>{const N=C.target.closest('a, button, [role="button"], input[type="submit"], .clickable');b(!!N)};return document.addEventListener("mouseover",S),()=>document.removeEventListener("mouseover",S)},[l]),r.useEffect(()=>{let S;const C=f=>{u(!1),c.current={x:f.clientX,y:f.clientY},t.current&&(t.current.style.transform=`translate(${f.clientX-4}px, ${f.clientY-4}px)`),Math.random()>.7&&k(f.clientX,f.clientY)},N=()=>d(!0),z=()=>d(!1),o=()=>u(!1),h=f=>{f.relatedTarget===null&&u(!0)},k=(f,a)=>{if(!document.body)return;const j=document.createElement("div"),M=Math.random()*4+2,R=w?"polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%)":"polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%)",T=Math.random()*360;Object.assign(j.style,{position:"fixed",left:"0",top:"0",width:`${M}px`,height:`${M}px`,backgroundColor:"white",clipPath:R,pointerEvents:"none",zIndex:9998,transform:`translate(${f}px, ${a}px) rotate(${T}deg)`,opacity:.6,transition:"transform 0.6s ease-out, opacity 0.6s ease-out",willChange:"transform, opacity"}),document.body.appendChild(j);const O=(Math.random()-.5)*60,Y=(Math.random()-.5)*60;requestAnimationFrame(()=>{j&&(j.style.transform=`translate(${f-O}px, ${a-Y}px) rotate(${T+180}deg) scale(0)`,j.style.opacity=0)}),setTimeout(()=>{j&&j.parentNode&&j.remove()},600)},y=()=>{i.current&&(s.current.x+=(c.current.x-s.current.x)*v,s.current.y+=(c.current.y-s.current.y)*v,i.current.style.transform=`translate(${s.current.x-20}px, ${s.current.y-20}px)`,S=requestAnimationFrame(y))};return y(),document.addEventListener("mousemove",C),document.addEventListener("mousedown",N),document.addEventListener("mouseup",z),document.addEventListener("mouseenter",o),document.addEventListener("mouseout",h),()=>{cancelAnimationFrame(S),document.removeEventListener("mousemove",C),document.removeEventListener("mousedown",N),document.removeEventListener("mouseup",z),document.removeEventListener("mouseenter",o),document.removeEventListener("mouseout",h)}},[w]),m?null:e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:t,className:"fixed top-0 left-0 z-[9999] pointer-events-none will-change-transform",style:{top:0,left:0},children:e.jsx("div",{className:`w-2 h-2 bg-white rounded-full shadow-[0_0_10px_rgba(255,255,255,0.8)] transition-all duration-300 ease-out ${n?"scale-0 opacity-0":g?"scale-50 opacity-100":w?"scale-150 opacity-100":"scale-100 opacity-100"}`})}),e.jsx("div",{ref:i,className:"fixed top-0 left-0 w-10 h-10 pointer-events-none z-[9998] mix-blend-difference will-change-transform",style:{top:0,left:0},children:e.jsx("svg",{className:`w-full h-full transition-all duration-500 ease-out ${n?"scale-0 opacity-0":g?"scale-75 opacity-100":w?"scale-125 rotate-180 opacity-100":"scale-100 opacity-100"}`,viewBox:"0 0 40 40",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:w?"M 20 1 L 37 10.5 L 37 29.5 L 20 39 L 3 29.5 L 3 10.5 Z":"M 20 1 A 19 19 0 1 1 20 39 A 19 19 0 1 1 20 1 Z",stroke:"white",strokeWidth:"2",strokeLinecap:"round",style:{transition:"d 0.3s ease-out"}})})})]})},Se=()=>{const t=r.useRef(null),i=r.useRef(null),l=r.useRef([]),c=r.useRef({width:0,height:0}),s=2,n=25,u=100,g=35,d=.08,w=4,b=r.useCallback((v,x)=>{const p=[],S=Math.floor(v/n),C=Math.floor(x/n);for(let z=0;z<C;z++)for(let o=0;o<S;o++)p.push({x:o*n+n/2,y:z*n+n/2,brightness:0,targetBrightness:0,pulsePhase:Math.random()*Math.PI*2});const N=[...Array(p.length).keys()].sort(()=>Math.random()-.5);for(let z=0;z<Math.min(g,p.length);z++)p[N[z]].targetBrightness=1;return p},[]),m=r.useCallback(()=>{const v=l.current;if(v.length===0)return;const x=[],p=[];v.forEach((C,N)=>{C.targetBrightness>.5?x.push(N):p.push(N)});const S=Math.min(w,x.length,p.length);for(let C=0;C<S&&!(x.length===0||p.length===0);C++){const N=x.splice(Math.floor(Math.random()*x.length),1)[0],z=p.splice(Math.floor(Math.random()*p.length),1)[0];v[N].targetBrightness=0,v[z].targetBrightness=1}},[]),E=r.useCallback(()=>{const v=t.current;if(!v)return;const x=v.getContext("2d"),{width:p,height:S}=c.current;x.clearRect(0,0,p,S);const C=l.current,N=Date.now()*.002;for(let o=0;o<C.length;o++){const h=C[o],k=Math.sin(N+h.pulsePhase)*.3+.7,y=h.targetBrightness*k;h.brightness+=(y-h.brightness)*d}x.lineWidth=1;const z=[];for(let o=0;o<C.length;o++)C[o].brightness>.15&&z.push(C[o]);x.beginPath();for(let o=0;o<z.length;o++)for(let h=o+1;h<z.length;h++){const k=z[o],y=z[h],f=y.x-k.x,a=y.y-k.y,j=f*f+a*a;if(j<u*u){const M=(1-Math.sqrt(j)/u)*Math.min(k.brightness,y.brightness)*.4;x.strokeStyle=`rgba(255, 255, 255, ${M})`,x.beginPath(),x.moveTo(k.x,k.y),x.lineTo(y.x,y.y),x.stroke()}}for(let o=0;o<C.length;o++){const h=C[o];if(h.brightness>.05){const k=h.brightness;x.beginPath(),x.arc(h.x,h.y,s*2,0,Math.PI*2),x.fillStyle=`rgba(255, 255, 255, ${k*.15})`,x.fill(),x.beginPath(),x.arc(h.x,h.y,s,0,Math.PI*2),x.fillStyle=`rgba(255, 255, 255, ${k*.9})`,x.fill()}else x.beginPath(),x.arc(h.x,h.y,s*.5,0,Math.PI*2),x.fillStyle="rgba(255, 255, 255, 0.03)",x.fill()}i.current=requestAnimationFrame(E)},[]);return r.useEffect(()=>{const v=()=>{if(t.current){const x=window.innerWidth,p=window.innerHeight;c.current={width:x,height:p},t.current.width=x,t.current.height=p,l.current=b(x,p)}};return v(),window.addEventListener("resize",v),()=>window.removeEventListener("resize",v)},[b]),r.useEffect(()=>{E();const v=setInterval(m,300);return()=>{i.current&&cancelAnimationFrame(i.current),clearInterval(v)}},[E,m]),e.jsx("canvas",{ref:t,className:"absolute inset-0 z-0 pointer-events-none",style:{background:"transparent"}})},me=["Finishing the prompt...","Stuck in traffic...","Uploading the assignment...","Wearing ID card...","Taking the fish for a walk...","Mass bunking...","Eating ice cream...","ICA farming...","Checking Defalter List...","Avoiding eye contact with faculty...","Avoiding the library...","Connecting to VPN...","Pretending to understand quantum physics...","Attempting Re-Exam... ","Finding an empty class...","Scrolling Reels..."],mt=()=>{const[t,i]=r.useState(!0),[l,c]=r.useState([]),[s,n]=r.useState(0),[u,g]=r.useState(!1),[d,w]=r.useState(0);return r.useEffect(()=>{const b=[...me];for(let m=b.length-1;m>0;m--){const E=Math.floor(Math.random()*(m+1));[b[m],b[E]]=[b[E],b[m]]}c(b),n(Math.floor(Math.random()*b.length))},[]),r.useEffect(()=>{if(!t)return;const b=setInterval(()=>{n(m=>(m+1)%me.length)},1500);return()=>clearInterval(b)},[t]),r.useEffect(()=>{const b=setInterval(()=>{w(m=>m>=100?100:m+Math.random()*15+5)},200);return()=>clearInterval(b)},[]),r.useEffect(()=>{const b=setTimeout(()=>{g(!0),setTimeout(()=>i(!1),500)},2e3);return()=>clearTimeout(b)},[]),t?e.jsxs("div",{className:`fixed inset-0 z-[10000] bg-black flex flex-col items-center justify-center transition-opacity duration-500 ${u?"opacity-0":"opacity-100"}`,children:[e.jsx("div",{className:"absolute inset-0 opacity-30",children:e.jsx(Se,{})}),e.jsxs("div",{className:"relative z-10 flex flex-col items-center",children:[e.jsx("div",{className:"text-white text-3xl md:text-4xl font-display font-bold mb-4 tracking-widest animate-pulse text-center px-4",children:"CAMPUS NODES"}),e.jsx("div",{className:"text-zinc-400 font-mono text-xs md:text-sm h-6 text-center px-4",children:l.length>0?l[s]:"Loading..."}),e.jsx("div",{className:"w-48 md:w-64 h-1 bg-zinc-800 mt-8 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-white transition-all duration-300 ease-out",style:{width:`${Math.min(d,100)}%`}})})]})]}):null},L=({children:t,variant:i="primary",onClick:l,className:c="",type:s="button",fullWidth:n=!1,to:u,href:g,withDoodles:d=!0,disabled:w})=>{const b=r.useRef(null),[m,E]=r.useState(!1),v=h=>{w||(E(!0),setTimeout(()=>E(!1),700),l&&l(h))},x="relative group/btn font-display font-bold uppercase tracking-widest text-xs px-8 py-4 transition-all duration-300 transform active:scale-95 disabled:opacity-50 disabled:cursor-none flex items-center justify-center gap-2",p={primary:"bg-white text-black border border-transparent hover:bg-zinc-200",outline:"border border-white/20 text-white hover:border-white hover:bg-white/5",ghost:"text-gray-400 hover:text-white hover:bg-white/5",accent:"bg-accent text-white border border-transparent hover:bg-accent/90"},S=n?"w-full":"",C=`${x} ${p[i]} ${S} ${c}`,N=(h,k,y)=>m?`opacity-0 ${y} transition-all duration-700 ease-out z-50`:`opacity-0 group-hover/btn:opacity-100 ${k} transition-all duration-300 ease-out ${h}`,z=()=>e.jsxs("span",{className:"absolute inset-0 pointer-events-none overflow-visible",children:[e.jsx("span",{className:`absolute left-1/2 -translate-x-1/2 ${N("-top-12","-top-8","-translate-y-[80vh]")} delay-75 text-white`,children:e.jsx(Re,{size:20,fill:"currentColor"})}),e.jsx("span",{className:`absolute left-0 ${N("-top-10","-top-6","-translate-y-[80vh] -translate-x-[20vw]")} delay-0 text-white -rotate-12`,children:e.jsx(he,{size:20,strokeWidth:3})}),e.jsx("span",{className:`absolute right-0 ${N("-top-10","-top-6","-translate-y-[80vh] translate-x-[20vw]")} delay-100 text-white rotate-12`,children:e.jsx(ce,{size:16,fill:"currentColor"})}),e.jsx("span",{className:`absolute left-1/2 -translate-x-1/2 ${N("-bottom-12","-bottom-8","translate-y-[80vh]")} delay-75 text-white`,children:e.jsx(Ie,{size:18,strokeWidth:3})}),e.jsx("span",{className:`absolute left-0 ${N("-bottom-10","-bottom-6","translate-y-[80vh] -translate-x-[20vw]")} delay-0 text-white rotate-12`,children:e.jsx(D,{size:16,strokeWidth:4})}),e.jsx("span",{className:`absolute right-0 ${N("-bottom-10","-bottom-6","translate-y-[80vh] translate-x-[20vw]")} delay-100 text-white -rotate-12`,children:e.jsx(he,{size:20,strokeWidth:3,className:"rotate-180"})}),e.jsx("span",{className:`absolute top-1/2 -translate-y-1/2 ${N("-left-12","-left-8","-translate-x-[80vw]")} delay-50 text-white`,children:e.jsx(be,{size:20,strokeWidth:3})}),e.jsx("span",{className:`absolute top-0 ${N("-left-8","-left-5","-translate-x-[80vw] -translate-y-[20vh]")} delay-100 text-white`,children:e.jsx(te,{size:16,fill:"currentColor"})}),e.jsx("span",{className:`absolute top-1/2 -translate-y-1/2 ${N("-right-12","-right-8","translate-x-[80vw]")} delay-50 text-white`,children:e.jsx(ve,{size:20,strokeWidth:3})}),e.jsx("span",{className:`absolute bottom-0 ${N("-right-8","-right-5","translate-x-[80vw] translate-y-[20vh]")} delay-100 text-white rotate-45`,children:e.jsx($e,{size:16,fill:"currentColor"})})]}),o=e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"relative z-10",children:t}),d&&e.jsx(z,{})]});return u?e.jsx(A,{to:u,className:C,ref:b,onClick:v,children:o}):g?e.jsx("a",{href:g,className:C,target:"_blank",rel:"noopener noreferrer",ref:b,onClick:v,children:o}):e.jsx("button",{ref:b,type:s,className:C,onClick:v,disabled:w,children:o})},pt=()=>{const{user:t}=U();return e.jsxs("section",{className:"relative w-full h-screen flex flex-col justify-center items-center overflow-hidden bg-transparent",children:[e.jsx("div",{className:"absolute inset-0 bg-grid-white/[0.02] -z-10"}),e.jsx("div",{className:"absolute top-1/4 -left-20 w-96 h-96 bg-accent/10 rounded-full blur-[100px] pointer-events-none"}),e.jsxs("div",{className:"z-10 text-center px-4 max-w-5xl mx-auto pointer-events-none",children:[e.jsx("h1",{className:"text-6xl md:text-9xl font-bold font-display tracking-tighter text-white mb-6 animate-fade-in pointer-events-auto",children:"CAMPUS NODES"}),e.jsxs("p",{className:"text-gray-400 text-lg md:text-2xl max-w-2xl mx-auto font-light tracking-wide mb-12 animate-fade-in pointer-events-auto",style:{animationDelay:"200ms"},children:["The decentralized marketplace for everything on campus.",e.jsx("br",{}),"Trade gears, find mentors, build your network."]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-6 justify-center items-center animate-fade-in pointer-events-auto",style:{animationDelay:"400ms"},children:[e.jsx(re,{children:e.jsxs(L,{to:t?"/market":"/signup",variant:"primary",className:"px-8 py-4 text-sm",children:[t?"Go to Market":"Start Trading"," ",e.jsx(be,{size:18,className:"inline ml-2"})]})}),e.jsx(re,{children:e.jsx(L,{to:"/services",variant:"outline",className:"px-8 py-4 text-sm",children:"Explore Services"})})]})]})]})},ae=[{id:1,title:"Casio FX-991EX Classwiz (Used)",category:"Stationary",price:"â‚¹600",images:[],seller:"Aarya Nadiger",trustScore:95,description:"Used for 1 semester. Perfect condition. Includes original sliding cover. Essential for engineering exams."},{id:2,title:"Engineering Drafter & Roller Scale",category:"Stationary",price:"â‚¹450",images:[],seller:"Rushi Shah",trustScore:98,description:"Mini drafter suitable for ED/EGD labs. Roller scale included. Brand: Omega."},{id:3,title:"Arduino Uno Starter Kit",category:"Tech",price:"â‚¹850",images:[],seller:"Meemoh Shukla",trustScore:90,description:"Includes Uno board, breadboard, jumper wires, LEDs, resistors, and sensors. Great for First Year projects."},{id:4,title:"Electric Kettle (1.5L)",category:"Essentials",price:"â‚¹500",images:[],seller:"Prithish Gurbani",trustScore:85,description:"Prestige 1.5L Kettle. Works perfectly. Boils water in 2 mins. Cable included."},{id:5,title:"Lab Coat (Size M) + Goggles",category:"Essentials",price:"â‚¹200",images:[],seller:"Tanish Parekh",trustScore:100,description:"Cotton lab coat, Size M. Hardly used. Safety goggles included for Chem lab."},{id:6,title:"Hercules Cycle (Black)",category:"Transport",price:"â‚¹2,500",images:[],seller:"Sarvesh Nimbalkar",trustScore:92,description:"Single speed Hercules cycle. Tyres replaced recently. Good condition for campus commuting."},{id:7,title:"Engineering Math (K.A. Stroud)",category:"Textbooks",price:"â‚¹350",images:[],seller:"Arjun Shetty",trustScore:97,description:"Fifth Edition. No highlighting/markings inside. Essential for first year calculus."},{id:8,title:"Extension Board (4 Socket)",category:"Essentials",price:"â‚¹300",images:[],seller:"Viyomm",trustScore:88,description:"Belkin 4-socket surge protector. 1.5m wire length. Must have for hostel rooms."}],ft=({item:t})=>{const i=r.useRef(null),l=t.images&&t.images.length>0,c=s=>{if(i.current){const{clientWidth:n}=i.current,u=s==="left"?-n:n;i.current.scrollBy({left:u,behavior:"smooth"})}};return e.jsxs("div",{className:"group relative bg-surface border border-white/5 hover:border-white/20 hover:z-[50] transition-colors duration-300",children:[e.jsx("div",{className:"relative aspect-[4/3] overflow-hidden bg-white/5",children:l?e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:i,className:"w-full h-full overflow-x-auto flex snap-x snap-mandatory scrollbar-hide",children:t.images.map((s,n)=>e.jsx("img",{src:s,alt:`${t.title} ${n+1}`,className:"w-full h-full object-cover shrink-0 snap-center"},n))}),e.jsx("button",{onClick:s=>{s.preventDefault(),c("left")},className:"absolute left-2 top-1/2 -translate-y-1/2 bg-black/50 text-white p-1 rounded-full opacity-0 group-hover:opacity-100 transition-opacity hover:bg-black/70 z-10",children:e.jsx(K,{size:20})}),e.jsx("button",{onClick:s=>{s.preventDefault(),c("right")},className:"absolute right-2 top-1/2 -translate-y-1/2 bg-black/50 text-white p-1 rounded-full opacity-0 group-hover:opacity-100 transition-opacity hover:bg-black/70 z-10",children:e.jsx(ie,{size:20})})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full p-6 text-center opacity-50",children:[e.jsx(J,{className:"w-12 h-12 mb-3"}),e.jsx("p",{className:"text-[10px] uppercase tracking-wider text-gray-400 font-medium",children:"Seller has not uploaded any images for this product"})]})}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("span",{className:"text-xs font-bold text-accent uppercase tracking-wider",children:t.category}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-400",children:[e.jsx(ce,{size:12,className:"text-yellow-500 fill-current"})," ",t.trustScore]})]}),e.jsx("h3",{className:"text-white font-medium truncate mb-1",children:t.title}),e.jsx("p",{className:"text-lg font-bold text-white",children:t.price}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-white/10 flex justify-between items-center text-sm text-gray-400",children:[e.jsxs("span",{children:["@",t.seller]}),e.jsx(L,{to:`/market/${t.id}`,variant:"primary",className:"px-4 py-2 text-xs",children:"View"})]})]})]})},gt=()=>{const[t,i]=r.useState("All"),l=["All","Stationary","Tech","Essentials","Transport","Textbooks"],c=t==="All"?ae:ae.filter(s=>s.category===t);return r.useEffect(()=>{V({targets:".market-card",opacity:[0,1],translateY:[20,0],delay:V.stagger(100),easing:"easeOutExpo"})},[t]),e.jsx("div",{className:"min-h-screen bg-background pt-24 pb-20 px-6 md:px-12",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center mb-12",children:[e.jsx("h1",{className:"text-5xl font-display font-bold text-white mb-6 md:mb-0",children:"Marketplace"}),e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2 md:pb-0 w-full md:w-auto p-1",children:l.map(s=>e.jsx("button",{onClick:()=>i(s),className:`px-4 py-2 text-sm font-medium border transition-all duration-300 whitespace-nowrap
                  ${t===s?"bg-white text-black border-white":"text-gray-400 border-white/10 hover:border-white/50 hover:text-white"}`,children:s},s))})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:c.map((s,n)=>e.jsx("div",{className:"market-card opacity-0",children:e.jsx(ft,{item:s})},s.id))})]})})},bt=[{id:"tutoring",title:"Peer Tutoring",description:"Ace your mid-terms with help from seniors who topped the class.",icon:e.jsx(je,{size:40}),availableCount:42,provider:"Aarya Nadiger"},{id:"printing",title:"Print & Bind",description:"Fast, cheap printing delivered to your hostel room. Assignments & theses.",icon:e.jsx(Ae,{size:40}),availableCount:8,provider:"Rushi Shah"},{id:"repair",title:"Tech Repair",description:"Broken laptop screen or phone issues? Student-run reliable fixes.",icon:e.jsx(le,{size:40}),availableCount:12,provider:"Meemoh Shukla"},{id:"coding",title:"Coding Mentorship",description:"Debug help for C++, Python, and Java semester projects.",icon:e.jsx(Le,{size:40}),availableCount:25,provider:"Prithish Gurbani"},{id:"photography",title:"Event Media",description:"Hire photographers and videographers for your club events.",icon:e.jsx(we,{size:40}),availableCount:5,provider:"Tanish Parekh"},{id:"events",title:"Committee Events",description:"Find committees recruiting new members or hosting workshops.",icon:e.jsx(De,{size:40}),availableCount:7,provider:"Sarvesh Nimbalkar"}],vt=({service:t,index:i})=>e.jsxs("div",{className:"service-card group relative p-8 bg-surface border border-white/5 hover:border-white/20 hover:z-[50] transition-all duration-500 min-h-[300px] flex flex-col justify-end",children:[e.jsx("div",{className:"absolute top-8 right-8 text-gray-700 group-hover:text-accent transition-colors duration-500",children:t.icon}),e.jsxs("div",{className:"relative z-10",children:[e.jsx("h3",{className:"text-3xl font-display font-bold text-white mb-4 group-hover:translate-x-2 transition-transform duration-300",children:t.title}),e.jsx("p",{className:"text-gray-400 max-w-sm mb-6 opacity-80 group-hover:opacity-100 transition-opacity",children:t.description}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:"text-xs font-bold uppercase tracking-wider text-accent mb-1",children:[t.availableCount," Active Listed"]}),e.jsxs("span",{className:"text-[10px] uppercase tracking-widest text-gray-500",children:["Head: ",t.provider]})]}),e.jsx(L,{variant:"outline",className:"px-6 py-2 ml-auto",children:"View"})]})]}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/80 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500 pointer-events-none"})]}),jt=()=>e.jsx("div",{className:"min-h-screen bg-background pt-32 pb-20 px-6 md:px-12",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-16 animate-fade-in",children:[e.jsx("span",{className:"text-accent text-sm font-bold uppercase tracking-widest mb-2 block",children:"Our Ecosystem"}),e.jsx("h1",{className:"text-5xl md:text-7xl font-display font-bold text-white mb-8",children:"Campus Services"}),e.jsx("p",{className:"text-xl text-gray-400 max-w-2xl font-light",children:"Everything you need to survive and thrive on campus. From academic support to logistical solutions."})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:bt.map((t,i)=>e.jsx("div",{style:{animationDelay:`${i*150}ms`},className:"opacity-0 animate-fade-in fill-mode-forwards",children:e.jsx(vt,{service:t,index:i})},t.id))}),e.jsxs("div",{className:"mt-20 p-12 bg-zinc-900 border border-white/5 relative overflow-hidden text-center opacity-0 animate-fade-in fill-mode-forwards",style:{animationDelay:"600ms"},children:[e.jsx("h2",{className:"text-3xl font-display font-bold text-white mb-6",children:"Need a custom service?"}),e.jsx("p",{className:"text-gray-400 mb-8 max-w-xl mx-auto",children:"Post a request for tasks, tutoring, or help. The community is here to support you."}),e.jsx(L,{variant:"primary",className:"px-8 py-3",children:"Post Request"})]})]})}),wt=()=>{const{user:t}=U(),{openAuthModal:i}=W();F();const[l,c]=r.useState([]),[s,n]=r.useState([]),[u,g]=r.useState([]),[d,w]=r.useState(!0),[b,m]=r.useState(""),[E,v]=r.useState(null),[x,p]=r.useState(null),[S,C]=r.useState({top:0,left:0}),N=async()=>{try{w(!0);let a=[];if(t){const{data:P,error:q}=await _.from("friendships").select("*").or(`user1_id.eq.${t.id},user2_id.eq.${t.id}`);if(q)throw q;a=P||[]}const{data:j,error:M}=await _.from("profiles").select("*").order("created_at",{ascending:!1}).limit(50);if(M)throw M;if(!t){g(j),c([]);return}const R=a.filter(P=>P.status==="accepted"),T=R.map(P=>P.user1_id===t.id?P.user2_id:P.user1_id),Y=j.filter(P=>T.includes(P.id)).map(P=>{const q=R.find(xe=>xe.user1_id===P.id||xe.user2_id===P.id);return{...P,friendship_id:q?.id}});c(Y);const Q=a.filter(P=>P.status==="pending"&&P.user1_id===t.id).map(P=>P.user2_id),G=a.filter(P=>P.status==="pending"&&P.user2_id===t.id).map(P=>P.user1_id),Me=j.filter(P=>G.includes(P.id));n(Me);const Pe=j.filter(P=>P.id!==t.id&&!T.includes(P.id)&&!G.includes(P.id)).map(P=>{let q="none";return Q.includes(P.id)&&(q="sent"),{...P,status:q}});g(Pe)}catch(a){console.error("Error fetching connections:",a)}finally{w(!1)}};r.useEffect(()=>{N();const a=_.channel("connections_page_realtime").on("postgres_changes",{event:"*",schema:"public",table:"friendships"},()=>N()).subscribe();return()=>_.removeChannel(a)},[t]);const z=async a=>{if(!t)return i();v(a);try{const{error:j}=await _.from("friendships").insert({user1_id:t.id,user2_id:a,status:"pending"});if(j)throw j;N()}catch(j){console.error(j),alert("Action failed")}finally{v(null)}},o=async a=>{v(a);try{const{error:j}=await _.from("friendships").update({status:"accepted"}).eq("user1_id",a).eq("user2_id",t.id);if(j)throw j;N()}catch(j){console.error(j)}finally{v(null)}},h=async a=>{v(a);try{const{error:j}=await _.from("friendships").delete().eq("user1_id",a).eq("user2_id",t.id);if(j)throw j;N()}catch(j){console.error(j)}finally{v(null)}},k=(a,j)=>{const M=j.currentTarget,R=M.closest(".group");if(R){const T=R.getBoundingClientRect();C({top:T.top-60,left:T.left+T.width/2-105})}else{const T=M.getBoundingClientRect();C({top:T.top-60,left:T.left-100})}p(a)},y=async()=>{if(x)try{const j=l.find(M=>M.friendship_id===x)?.id;await _.from("friendships").delete().eq("id",x),j&&t&&(await _.from("messages").delete().eq("sender_id",t.id).eq("receiver_id",j),await _.from("messages").delete().eq("sender_id",j).eq("receiver_id",t.id)),p(null),N()}catch(a){console.error(a)}},f=u.filter(a=>(a.first_name+" "+a.last_name).toLowerCase().includes(b.toLowerCase()));return e.jsxs("div",{className:"min-h-screen bg-background pt-32 pb-20 px-6 md:px-12 relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 w-[500px] h-[500px] bg-blue-500/10 rounded-full blur-[100px] pointer-events-none"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-[500px] h-[500px] bg-purple-500/10 rounded-full blur-[100px] pointer-events-none"}),e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("header",{className:"mb-12",children:[e.jsx("h1",{className:"text-5xl font-display font-bold text-white mb-4",children:"Network & Circle"}),e.jsx("p",{className:"text-gray-400",children:"Manage your close circle and discover new connections."})]}),t&&e.jsxs("section",{className:"mb-16",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(Oe,{className:"text-accent",size:24}),e.jsxs("h2",{className:"text-2xl font-bold text-white",children:["Your Circle (",l.length,")"]})]}),l.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:l.map(a=>e.jsxs("div",{className:"bg-white/5 border border-white/10 p-5 rounded-xl flex items-center justify-between group hover:bg-white/10 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-gray-800 rounded-full border border-white/20 overflow-hidden",children:a.avatar_url?e.jsx("img",{src:a.avatar_url,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-white font-bold",children:a.first_name?.[0]})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-white font-bold",children:[a.first_name," ",a.last_name]}),e.jsx("p",{className:"text-gray-400 text-xs",children:a.role||"Student"})]})]}),e.jsx("button",{onClick:j=>k(a.friendship_id,j),className:"p-2 bg-white/5 text-gray-400 rounded-full hover:bg-red-600 hover:text-white transition-all opacity-100",title:"Remove Connection",children:e.jsx(qe,{size:20})})]},a.id))}):e.jsx("div",{className:"p-8 border border-dashed border-white/10 rounded-xl text-center text-gray-500",children:"You haven't connected with anyone yet."})]}),t&&s.length>0&&e.jsxs("section",{className:"mb-16 animate-fade-in-up",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(Fe,{className:"text-yellow-400",size:24}),e.jsxs("h2",{className:"text-2xl font-bold text-white",children:["Pending Requests (",s.length,")"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:s.map(a=>e.jsxs("div",{className:"bg-white/5 border border-yellow-500/20 p-5 rounded-xl flex items-center justify-between group hover:bg-white/10 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-gray-800 rounded-full border border-white/20 overflow-hidden",children:a.avatar_url?e.jsx("img",{src:a.avatar_url,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-white font-bold",children:a.first_name?.[0]})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-white font-bold text-lg",children:[a.first_name," ",a.last_name]}),e.jsx("p",{className:"text-yellow-400 text-xs font-semibold uppercase tracking-wider",children:"Wants to join"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>o(a.id),className:"p-2 bg-green-500/20 text-green-400 rounded-full hover:bg-green-500 hover:text-black transition-colors",title:"Accept",disabled:E===a.id,children:e.jsx(Z,{size:18})}),e.jsx("button",{onClick:()=>h(a.id),className:"p-2 bg-red-500/20 text-red-400 rounded-full hover:bg-red-500 hover:text-white transition-colors",title:"Decline",disabled:E===a.id,children:e.jsx(D,{size:18})})]})]},a.id))})]}),e.jsxs("section",{children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-end mb-8 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ue,{className:"text-purple-400",size:24}),e.jsx("h2",{className:"text-2xl font-bold text-white",children:"Discover People"})]}),e.jsxs("div",{className:"relative w-full md:w-80",children:[e.jsx("input",{type:"text",placeholder:"Search students...",value:b,onChange:a=>m(a.target.value),className:"w-full bg-black border border-white/20 rounded-full px-4 py-2 pl-10 text-white focus:outline-none focus:border-accent"}),e.jsx(ue,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",size:16})]})]}),d?e.jsx("div",{className:"flex justify-center py-20",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-white"})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:f.map(a=>e.jsxs("div",{className:"bg-white/5 border border-white/10 p-6 rounded-xl hover:border-accent/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("div",{className:"w-14 h-14 bg-gray-800 rounded-full border border-white/20 overflow-hidden",children:a.avatar_url?e.jsx("img",{src:a.avatar_url,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-white font-bold",children:a.first_name?.[0]})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-white font-bold text-lg",children:[a.first_name," ",a.last_name]}),e.jsx("p",{className:"text-accent text-xs font-bold uppercase tracking-wider",children:a.role||"Student"})]})]}),e.jsx("div",{className:"pt-4 border-t border-white/10 flex justify-end",children:e.jsx(L,{onClick:()=>z(a.id),variant:a.status==="sent"||a.status==="accepted"?"outline":"primary",disabled:a.status==="sent"||E===a.id,className:"px-6 py-2 text-sm",children:E===a.id?"...":a.status==="sent"?"Requested":a.status==="received"?"Accept Request":"Connect"})})]},a.id))})]}),x&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-[99] bg-transparent",onClick:()=>p(null)}),e.jsxs("div",{className:"fixed z-[100] bg-black border border-white/20 p-2 pl-4 rounded-full flex items-center gap-3 shadow-[0_0_20px_rgba(255,255,255,0.1)] animate-fade-in",style:{top:S.top,left:S.left},children:[e.jsx("span",{className:"text-xs font-bold text-white whitespace-nowrap",children:"Remove Connection?"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:y,className:"p-1.5 bg-green-500 text-black rounded-full hover:scale-110 transition-transform shadow-[0_0_10px_rgba(34,197,94,0.5)]",title:"Confirm",children:e.jsx(Z,{size:14})}),e.jsx("button",{onClick:()=>p(null),className:"p-1.5 bg-red-600 text-white rounded-full hover:scale-110 transition-transform shadow-[0_0_10px_rgba(239,68,68,0.5)]",title:"Cancel",children:e.jsx(D,{size:14})})]})]})]})]})]})},Ee=(t,i)=>[t,i].sort().join("_"),ze=(t,i,l)=>{try{if(!t)return"";const c=Ee(i,l);return se.AES.encrypt(t,c).toString()}catch(c){return console.error("Encryption failed:",c),t}},B=(t,i,l)=>{try{if(!t)return"";const c=Ee(i,l),n=se.AES.decrypt(t,c).toString(se.enc.Utf8);return n||t}catch{return t}},yt=()=>{const{user:t}=U(),{removeUnreadSender:i,unreadSenders:l}=W(),c=F(),[s,n]=r.useState(null),[u,g]=r.useState([]),[d,w]=r.useState([]),[b,m]=r.useState(""),[E,v]=r.useState(!1),x=r.useRef(null),p=()=>{x.current?.scrollIntoView({behavior:"smooth"})};r.useEffect(()=>{t&&S()},[t]),r.useEffect(()=>{if(s){i(s.id),C(s.id);const o=_.channel(`chat_mobile:${s.id}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:`sender_id=eq.${s.id}`},h=>{if(h.new.receiver_id===t.id){const k=B(h.new.content,h.new.sender_id,h.new.receiver_id),y={...h.new,content:k};w(f=>[...f,y]),p()}}).subscribe();return()=>_.removeChannel(o)}},[s]);const S=async()=>{v(!0);try{const{data:o}=await _.from("friendships").select("*").or(`user1_id.eq.${t.id},user2_id.eq.${t.id}`).eq("status","accepted");if(!o?.length){g([]);return}const h=o.map(y=>y.user1_id===t.id?y.user2_id:y.user1_id),{data:k}=await _.from("profiles").select("*").in("id",h);g(k||[])}catch(o){console.error("Error fetching friends:",o)}finally{v(!1)}},C=async o=>{v(!0);try{const{data:h}=await _.from("messages").select("*").or(`and(sender_id.eq.${t.id},receiver_id.eq.${o}),and(sender_id.eq.${o},receiver_id.eq.${t.id})`).order("created_at",{ascending:!0}),k=(h||[]).map(y=>({...y,content:B(y.content,y.sender_id,y.receiver_id)}));w(k),setTimeout(p,100)}catch(h){console.error("Error fetching messages:",h)}finally{v(!1)}},N=async o=>{if(o.preventDefault(),!b.trim()||!s)return;const h=b.trim();m("");const k={id:Date.now(),sender_id:t.id,receiver_id:s.id,content:h,created_at:new Date().toISOString()};w(y=>[...y,k]),p();try{const y=ze(h,t.id,s.id);await _.from("messages").insert({sender_id:t.id,receiver_id:s.id,content:y})}catch(y){console.error("Error sending message:",y)}},z=async()=>{if(!(!s||!window.confirm("Clear all messages with this person?")))try{await _.from("messages").delete().eq("sender_id",t.id).eq("receiver_id",s.id),await _.from("messages").delete().eq("sender_id",s.id).eq("receiver_id",t.id),w([])}catch(o){console.error("Failed to clear chat",o)}};return t?e.jsxs("div",{className:"min-h-screen bg-background pt-4 pb-28",children:[e.jsx("div",{className:"sticky top-0 bg-background/80 backdrop-blur-xl z-20 px-4 py-3 border-b border-white/10",children:e.jsx("div",{className:"flex items-center gap-3",children:s?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>n(null),className:"p-2 -ml-2 hover:bg-white/10 rounded-full",children:e.jsx(K,{size:24,className:"text-white"})}),e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-700 overflow-hidden border border-white/20",children:s.avatar_url?e.jsx("img",{src:s.avatar_url,alt:"",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-sm font-bold text-white",children:s.first_name?.[0]})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h1",{className:"font-bold text-white",children:[s.first_name," ",s.last_name]}),e.jsxs("p",{className:"text-xs text-gray-500 flex items-center gap-1",children:[e.jsx(ye,{size:10})," End-to-end encrypted"]})]}),e.jsx("button",{onClick:z,className:"p-2 hover:bg-red-500/20 rounded-full text-gray-400 hover:text-red-400",children:e.jsx(de,{size:18})})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>c(-1),className:"p-2 -ml-2 hover:bg-white/10 rounded-full",children:e.jsx(K,{size:24,className:"text-white"})}),e.jsx("h1",{className:"text-xl font-bold text-white",children:"Messages"})]})})}),s?e.jsxs("div",{className:"flex flex-col h-[calc(100vh-180px)]",children:[e.jsxs("div",{className:"flex-1 overflow-y-auto px-4 py-4 space-y-3",children:[d.length===0?e.jsxs("div",{className:"text-center py-10 text-gray-500",children:[e.jsx("p",{children:"No messages yet."}),e.jsx("p",{className:"text-sm",children:"Say hi! ðŸ‘‹"})]}):d.map(o=>e.jsx("div",{className:`flex ${o.sender_id===t.id?"justify-end":"justify-start"}`,children:e.jsx("div",{className:`max-w-[80%] px-4 py-2 rounded-2xl ${o.sender_id===t.id?"bg-accent text-black rounded-br-md":"bg-white/10 text-white rounded-bl-md"}`,children:e.jsx("p",{className:"text-sm",children:o.content})})},o.id)),e.jsx("div",{ref:x})]}),e.jsx("form",{onSubmit:N,className:"px-4 py-3 bg-background border-t border-white/10",children:e.jsxs("div",{className:"flex items-center gap-2 bg-white/5 rounded-full px-4 py-2",children:[e.jsx("input",{type:"text",value:b,onChange:o=>m(o.target.value),placeholder:"Type a message...",className:"flex-1 bg-transparent text-white placeholder:text-gray-500 focus:outline-none text-sm"}),e.jsx("button",{type:"submit",disabled:!b.trim(),className:"p-2 bg-accent text-black rounded-full disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(Ne,{size:16})})]})})]}):e.jsx("div",{className:"px-4 py-4 space-y-2",children:E?e.jsx("div",{className:"text-center py-10 text-gray-500",children:"Loading..."}):u.length===0?e.jsxs("div",{className:"text-center py-20",children:[e.jsx("p",{className:"text-gray-400 text-lg",children:"No friends yet."}),e.jsx("p",{className:"text-gray-500 text-sm mt-1",children:"Connect with people to chat!"})]}):u.map(o=>e.jsxs("button",{onClick:()=>n(o),className:"w-full flex items-center gap-3 p-3 bg-white/5 hover:bg-white/10 rounded-xl transition-all",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gray-700 overflow-hidden border border-white/20",children:o.avatar_url?e.jsx("img",{src:o.avatar_url,alt:"",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-sm font-bold text-white",children:o.first_name?.[0]})}),l.has(o.id)&&e.jsx("div",{className:"absolute -top-1 -right-1 w-4 h-4 bg-red-500 rounded-full border-2 border-background"})]}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsxs("h3",{className:"font-semibold text-white",children:[o.first_name," ",o.last_name]}),e.jsx("p",{className:"text-sm text-gray-500",children:o.role||"Student"})]})]},o.id))})]}):e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center px-6",children:e.jsx("p",{className:"text-gray-400",children:"Please log in to access messages."})})},Nt=()=>{const t=r.useRef(null),i=F(),[l,c]=r.useState(!1),[s,n]=r.useState(null),[u,g]=r.useState(""),[d,w]=r.useState("");r.useEffect(()=>{V({targets:t.current,translateY:[20,0],opacity:[0,1],easing:"easeOutExpo",duration:800})},[]);const b=async m=>{m.preventDefault(),c(!0),n(null);try{const{data:E,error:v}=await _.auth.signInWithPassword({email:u,password:d});if(v)throw v;i("/")}catch(E){n(E.message)}finally{c(!1)}};return e.jsxs("div",{className:"min-h-screen flex items-center justify-center bg-background relative overflow-hidden px-4",children:[e.jsx("div",{className:"absolute top-0 right-0 w-96 h-96 bg-accent/5 rounded-full blur-[100px] pointer-events-none"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-64 h-64 bg-white/5 rounded-full blur-[80px] pointer-events-none"}),e.jsxs("div",{ref:t,className:"w-full max-w-md bg-surface/50 backdrop-blur-md border border-white/10 p-8 md:p-12 relative z-10 opacity-0 rounded-sm shadow-2xl",children:[e.jsxs("div",{className:"mb-8 text-center",children:[e.jsx("h1",{className:"text-3xl font-display font-bold text-white mb-2",children:"Welcome Back"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Sign in to access your dashboard"})]}),s&&e.jsx("div",{className:"mb-4 p-3 bg-red-500/10 border border-red-500/50 text-red-500 text-xs rounded-sm",children:s}),e.jsxs("form",{onSubmit:b,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs uppercase tracking-wider text-gray-500 mb-2 font-bold",children:"Email or NMIMS ID"}),e.jsx("input",{type:"email",value:u,onChange:m=>g(m.target.value),className:"w-full bg-black/20 border border-white/10 p-3 text-white focus:outline-none focus:border-accent transition-colors text-sm",placeholder:"student@nmims.edu",required:!0})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("label",{className:"block text-xs uppercase tracking-wider text-gray-500 font-bold",children:"Password"}),e.jsx(A,{to:"/forgot-password",class:"text-xs text-accent hover:text-white transition-colors",children:"Forgot?"})]}),e.jsx("input",{type:"password",value:d,onChange:m=>w(m.target.value),className:"w-full bg-black/20 border border-white/10 p-3 text-white focus:outline-none focus:border-accent transition-colors text-sm",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",required:!0})]}),e.jsx(L,{type:"submit",variant:"accent",fullWidth:!0,disabled:l,children:l?"Signing In...":"Sign In"})]}),e.jsxs("div",{className:"mt-8 text-center text-sm text-gray-400",children:["Don't have an account? ",e.jsx(A,{to:"/signup",className:"text-white hover:text-accent font-bold transition-colors",children:"Sign Up"})]})]})]})},kt={success:e.jsx(Z,{size:18}),error:e.jsx(D,{size:18}),warning:e.jsx(We,{size:18}),info:e.jsx(Ue,{size:18})},_t={success:"bg-green-500/20 border-green-500/50 text-green-400",error:"bg-red-500/20 border-red-500/50 text-red-400",warning:"bg-yellow-500/20 border-yellow-500/50 text-yellow-400",info:"bg-accent/20 border-accent/50 text-accent"},Ct=({message:t,type:i="info",onClose:l,duration:c=4e3,isInsideContainer:s=!1})=>(r.useEffect(()=>{const n=setTimeout(l,c);return()=>clearTimeout(n)},[l,c]),e.jsxs("div",{className:`${s?"":"fixed top-6 left-1/2 -translate-x-1/2 z-[10001]"} px-5 py-3 rounded-xl border backdrop-blur-xl shadow-2xl flex items-center gap-3 ${_t[i]}`,children:[e.jsx("div",{className:"shrink-0",children:kt[i]}),e.jsx("span",{className:"text-sm font-medium text-white",children:t}),e.jsx("button",{onClick:l,className:"shrink-0 ml-2 text-white/50 hover:text-white transition-colors",children:e.jsx(D,{size:14})})]})),St=({toasts:t,removeToast:i})=>e.jsx("div",{className:"fixed top-6 left-1/2 -translate-x-1/2 z-[10001] pointer-events-none flex flex-col items-center gap-3",children:e.jsx(X,{children:t.map(l=>e.jsx(I.div,{initial:{opacity:0,y:-20,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-20,scale:.95},className:"pointer-events-auto",children:e.jsx(Ct,{message:l.message,type:l.type,onClose:()=>i(l.id),duration:l.duration,isInsideContainer:!0})},l.id))})});let Et=0;const zt=()=>{const[t,i]=r.useState([]);return r.useEffect(()=>()=>{},[]),{toasts:t,addToast:(s,n="info",u=4e3)=>{const g=++Et;return i(d=>[...d,{id:g,message:s,type:n,duration:u}]),g},removeToast:s=>{i(n=>n.filter(u=>u.id!==s))}}},Mt=()=>{const t=r.useRef(null),i=F(),[l,c]=r.useState(!1),[s,n]=r.useState(null),[u,g]=r.useState(!1),[d,w]=r.useState(!1),[b,m]=r.useState(""),{toasts:E,addToast:v,removeToast:x}=zt(),[p,S]=r.useState({firstName:"",lastName:"",email:"",password:""});r.useEffect(()=>{V({targets:t.current,translateY:[20,0],opacity:[0,1],easing:"easeOutExpo",duration:800})},[u]);const C=h=>{S({...p,[h.target.name]:h.target.value})},N=async h=>{if(h.preventDefault(),c(!0),n(null),console.log("Starting signup process"),console.log("Email:",p.email),!(p.email.includes(".")&&(p.email.endsWith("@nmims.edu.in")||p.email.endsWith("@nmims.in")))){n("Email must follow the format: firstname.lastname@nmims.edu.in"),c(!1);return}try{const{data:y,error:f}=await _.auth.signUp({email:p.email,password:p.password,options:{data:{first_name:p.firstName,last_name:p.lastName}}});if(console.log("Signup response:",{data:y,error:f}),f)throw f;g(!0),c(!1),console.log("Signup successful, OTP sent")}catch(y){console.error("Signup error:",y),n(y.message),c(!1)}},z=async h=>{h.preventDefault(),c(!0),n(null),console.log("Starting OTP verification"),console.log("Email:",p.email),console.log("OTP token:",b),console.log("OTP length:",b.length);try{const{data:k,error:y}=await _.auth.verifyOtp({email:p.email,token:b,type:"signup"});if(console.log("Supabase response:",{data:k,error:y}),y)throw console.error("OTP verification failed:",y),y.message.includes("Invalid")?n("Invalid verification code. Please check the code and try again."):y.message.includes("expired")?n("Verification code has expired. Please request a new code."):n(y.message||"Verification failed. Please try again."),y;const{error:f}=await _.from("profiles").upsert({id:k.user.id,first_name:p.firstName,last_name:p.lastName,role:"Student",email:p.email},{onConflict:"id"});f&&console.warn("Profile creation note:",f),v("Verification successful! Account created.","success"),w(!0),setTimeout(()=>i("/"),2e3)}catch(k){console.error("Full error object:",k),n(k.message||"Invalid verification code. Please check the code and try again.")}finally{c(!1)}},o=async()=>{c(!0),n(null),console.log("Resending OTP to:",p.email);try{const{data:h,error:k}=await _.auth.resend({type:"signup",email:p.email});if(console.log("Resend response:",{data:h,error:k}),k)throw console.error("Resend error:",k),k;v("Verification code resent! Check your inbox.","success")}catch(h){console.error("Resend error:",h),n(h.message)}finally{c(!1)}};return e.jsxs("div",{className:"min-h-screen flex items-center justify-center bg-background relative overflow-hidden px-4 py-20",children:[e.jsx(St,{toasts:E,removeToast:x}),e.jsx("div",{className:"absolute top-0 left-0 w-96 h-96 bg-accent/5 rounded-full blur-[100px] pointer-events-none"}),e.jsx("div",{ref:t,className:"w-full max-w-md bg-surface/50 backdrop-blur-md border border-white/10 p-8 md:p-12 relative z-10 opacity-0 rounded-sm shadow-2xl",children:d?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx(I.div,{initial:{scale:0},animate:{scale:1,rotate:360},transition:{type:"spring",stiffness:260,damping:20},className:"w-20 h-20 bg-green-500/20 rounded-full flex items-center justify-center mb-6 text-green-500 border border-green-500/30",children:e.jsx(Z,{size:40})}),e.jsx("h2",{className:"text-3xl font-display font-bold text-white mb-2",children:"Success!"}),e.jsx("p",{className:"text-gray-400",children:"Your account has been verified."}),e.jsx("p",{className:"text-gray-500 text-sm mt-1",children:"Redirecting to campus nodes..."})]}):u?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-8 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-accent/20 rounded-full flex items-center justify-center mx-auto mb-4 text-accent",children:e.jsx(Be,{size:32})}),e.jsx("h1",{className:"text-2xl font-display font-bold text-white mb-2",children:"Check Your Email"}),e.jsxs("p",{className:"text-gray-400 text-sm",children:["We sent a 6-digit code to ",e.jsx("span",{className:"text-white font-bold",children:p.email})]})]}),s&&e.jsx("div",{className:"mb-4 p-3 bg-red-500/10 border border-red-500/50 text-red-500 text-xs rounded-sm",children:s}),e.jsxs("form",{onSubmit:z,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs uppercase tracking-wider text-gray-500 mb-2 font-bold text-center",children:"Verification Code"}),e.jsx("input",{type:"text",value:b,onChange:h=>m(h.target.value.replace(/\D/g,"").slice(0,6)),className:"w-full bg-black/20 border border-white/10 p-4 text-center text-2xl font-mono tracking-[0.5em] text-white focus:outline-none focus:border-accent transition-colors",placeholder:"000000",required:!0})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"button",onClick:o,disabled:l,className:"text-xs text-accent hover:text-white underline disabled:opacity-50",children:"Resend Code"})}),e.jsx(L,{type:"submit",variant:"accent",fullWidth:!0,disabled:l||b.length<6,children:l?"Verifying...":"Verify Email"}),e.jsx("button",{type:"button",onClick:()=>g(!1),className:"w-full text-xs text-gray-500 hover:text-white transition-colors mt-4",children:"Incorrect email? Go back"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-8 text-center",children:[e.jsx("h1",{className:"text-3xl font-display font-bold text-white mb-2",children:"Join Campus Nodes"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Create an account to start trading & connecting"})]}),s&&e.jsx("div",{className:"mb-4 p-3 bg-red-500/10 border border-red-500/50 text-red-500 text-xs rounded-sm",children:s}),e.jsxs("form",{onSubmit:N,className:"space-y-5",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs uppercase tracking-wider text-gray-500 mb-2 font-bold",children:"First Name"}),e.jsx("input",{type:"text",name:"firstName",value:p.firstName,onChange:C,className:"w-full bg-black/20 border border-white/10 p-3 text-white focus:outline-none focus:border-accent transition-colors text-sm",placeholder:"Rohan",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs uppercase tracking-wider text-gray-500 mb-2 font-bold",children:"Last Name"}),e.jsx("input",{type:"text",name:"lastName",value:p.lastName,onChange:C,className:"w-full bg-black/20 border border-white/10 p-3 text-white focus:outline-none focus:border-accent transition-colors text-sm",placeholder:"Sharma",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs uppercase tracking-wider text-gray-500 mb-2 font-bold",children:"Student Email"}),e.jsx("input",{type:"email",name:"email",value:p.email,onChange:C,className:"w-full bg-black/20 border border-white/10 p-3 text-white focus:outline-none focus:border-accent transition-colors text-sm",placeholder:"firstname.lastname@nmims.edu",required:!0}),e.jsx("p",{className:"text-[10px] text-gray-500 mt-1",children:"We'll need this to verify your student status later."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs uppercase tracking-wider text-gray-500 mb-2 font-bold",children:"Create Password"}),e.jsx("input",{type:"password",name:"password",value:p.password,onChange:C,className:"w-full bg-black/20 border border-white/10 p-3 text-white focus:outline-none focus:border-accent transition-colors text-sm",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",required:!0})]}),e.jsxs("div",{className:"pt-2",children:[e.jsxs("div",{className:"flex items-start gap-2 mb-4",children:[e.jsx("input",{type:"checkbox",className:"mt-1 bg-black border-white/20 accent-accent",required:!0}),e.jsxs("span",{className:"text-xs text-gray-400 leading-tight",children:["I agree to the ",e.jsx("a",{href:"#",className:"text-white hover:underline",children:"Terms of Service"})," and ",e.jsx("a",{href:"#",className:"text-white hover:underline",children:"Privacy Policy"}),"."]})]}),e.jsx(L,{type:"submit",variant:"primary",fullWidth:!0,disabled:l,children:l?"Sending Code...":"Create Account"})]})]}),e.jsxs("div",{className:"mt-8 text-center text-sm text-gray-400",children:["Already have an account? ",e.jsx(A,{to:"/login",className:"text-white hover:text-accent font-bold transition-colors",children:"Sign In"})]})]})})]})},Pt=()=>{const{user:t,signOut:i}=U(),[l,c]=r.useState(!1),[s,n]=r.useState(!1),[u,g]=r.useState(!1),[d,w]=r.useState(!1),b=r.useRef(null),[m,E]=r.useState({firstName:t?.user_metadata?.first_name||"",lastName:t?.user_metadata?.last_name||"",bio:t?.user_metadata?.bio||""});if(r.useEffect(()=>{V({targets:".trust-score-counter",innerHTML:[0,95],round:1,easing:"easeInOutExpo",duration:2e3}),V({targets:".trust-ring-path",strokeDashoffset:[283,283-283*95/100],easing:"easeInOutExpo",duration:2500,delay:500})},[]),!t)return e.jsx("div",{className:"pt-32 px-12 text-white",children:"Please log in to view profile."});const v=t.user_metadata?.first_name?t.user_metadata.first_name[0]:t.email[0].toUpperCase(),x=t.user_metadata?.avatar_url,p=()=>{c(!0)},S=async()=>{await i(),c(!1)},C=async o=>{o.preventDefault(),g(!0);const{error:h}=await _.auth.updateUser({data:{first_name:m.firstName,last_name:m.lastName,bio:m.bio}}),{error:k}=await _.from("profiles").update({first_name:m.firstName,last_name:m.lastName,bio:m.bio}).eq("id",t.id);g(!1),k&&console.error("Profile update failed:",k),!h&&!k&&n(!1)},N=async o=>{try{w(!0);const h=o.target.files[0];if(!h)return;const k=h.name.split(".").pop(),f=`${`${t.id}/${Date.now()}.${k}`}`,{error:a}=await _.storage.from("avatars").upload(f,h);if(a)throw a;const{data:{publicUrl:j}}=_.storage.from("avatars").getPublicUrl(f),{error:M}=await _.auth.updateUser({data:{avatar_url:j}});if(await _.from("profiles").update({avatar_url:j}).eq("id",t.id),M||M)throw M}catch(h){console.error("Error uploading avatar:",h.message),alert(`Error: ${h.message}`)}finally{w(!1)}},z=async()=>{try{w(!0);const{error:o}=await _.auth.updateUser({data:{avatar_url:null}});if(await _.from("profiles").update({avatar_url:null}).eq("id",t.id),o)throw o}catch(o){console.error("Error removing avatar:",o.message)}finally{w(!1)}};return e.jsxs("div",{className:"min-h-screen bg-background pt-32 pb-20 px-6 md:px-12",children:[e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-8 items-start mb-12 relative group/profile",children:[!s&&e.jsxs("div",{className:"absolute top-0 right-0 flex gap-2 z-50",children:[e.jsx("button",{onClick:p,className:"p-3 text-red-500 hover:text-red-400 border border-red-500/30 rounded-full hover:bg-red-500/10 transition-colors",title:"Sign Out",children:e.jsx(Ve,{size:20})}),e.jsx("button",{onClick:o=>{o.preventDefault(),n(!0)},className:"p-3 text-gray-400 hover:text-white border border-white/10 rounded-full hover:bg-white/10 transition-colors cursor-pointer",title:"Edit Profile",children:e.jsx(He,{size:20})})]}),e.jsxs("div",{className:"relative group w-32 h-32 shrink-0",children:[e.jsx("div",{className:"w-full h-full rounded-full bg-gradient-to-br from-gray-800 to-black border-2 border-white/20 flex items-center justify-center text-4xl font-bold text-white shadow-2xl overflow-hidden relative",children:d?e.jsx(Ye,{className:"animate-spin text-white",size:32}):x?e.jsx("img",{src:x,alt:"Profile",className:"w-full h-full object-cover"}):v}),e.jsxs("div",{className:"absolute inset-0 bg-black/60 rounded-full opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-center justify-center gap-2 backdrop-blur-sm z-10",children:[e.jsx("button",{onClick:()=>b.current.click(),className:"p-2 bg-white/10 rounded-full hover:bg-white/20 text-white transition-colors",title:"Upload Photo",children:e.jsx(we,{size:18})}),x&&e.jsx("button",{onClick:z,className:"p-2 bg-red-500/20 rounded-full hover:bg-red-500/40 text-red-500 transition-colors",title:"Remove Photo",children:e.jsx(de,{size:18})})]}),e.jsx("input",{type:"file",ref:b,onChange:N,className:"hidden",accept:"image/*"})]}),e.jsx("div",{className:"flex-1 w-full relative",children:s?e.jsxs("form",{onSubmit:C,className:"bg-white/5 border border-white/10 p-6 rounded-lg space-y-4 animate-fade-in relative",children:[e.jsx("button",{type:"button",onClick:()=>n(!1),className:"absolute top-4 right-4 text-gray-400 hover:text-white",children:e.jsx(D,{size:20})}),e.jsx("h3",{className:"text-xl font-bold text-white mb-4",children:"Edit Profile"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs uppercase tracking-wider text-gray-500 mb-1",children:"First Name"}),e.jsx("input",{type:"text",value:m.firstName,onChange:o=>E({...m,firstName:o.target.value}),className:"w-full bg-black border border-white/20 p-2 text-white focus:border-accent outline-none rounded"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs uppercase tracking-wider text-gray-500 mb-1",children:"Last Name"}),e.jsx("input",{type:"text",value:m.lastName,onChange:o=>E({...m,lastName:o.target.value}),className:"w-full bg-black border border-white/20 p-2 text-white focus:border-accent outline-none rounded"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs uppercase tracking-wider text-gray-500 mb-1",children:"Bio"}),e.jsx("textarea",{rows:"3",value:m.bio,onChange:o=>E({...m,bio:o.target.value}),className:"w-full bg-black border border-white/20 p-2 text-white focus:border-accent outline-none rounded"})]}),e.jsxs("button",{type:"submit",disabled:u,className:"px-6 py-2 bg-white text-black font-bold uppercase tracking-widest hover:bg-gray-200 transition-colors rounded flex items-center gap-2",children:[e.jsx(Ge,{size:16})," ",u?"Saving...":"Save Changes"]})]}):e.jsxs("div",{className:"animate-fade-in",children:[e.jsxs("h1",{className:"text-4xl font-display font-bold text-white mb-2",children:[t.user_metadata?.first_name||"Student"," ",t.user_metadata?.last_name||""]}),e.jsx("p",{className:"text-gray-400 mb-4",children:t.email}),e.jsx("p",{className:"text-gray-300 italic mb-6 max-w-xl",children:t.user_metadata?.bio||"No bio yet."}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-6 bg-white/5 border border-white/10 rounded-xl flex flex-col items-center justify-center relative overflow-hidden group",children:[e.jsx("div",{className:"absolute inset-0 bg-accent/5 opacity-0 group-hover:opacity-100 transition-opacity"}),e.jsxs("div",{className:"relative w-32 h-32 flex items-center justify-center mb-4",children:[e.jsxs("svg",{className:"absolute inset-0 w-full h-full rotate-[-90deg]",viewBox:"0 0 100 100",children:[e.jsx("circle",{cx:"50",cy:"50",r:"45",fill:"none",stroke:"#222",strokeWidth:"2"}),e.jsx("circle",{className:"trust-ring-path",cx:"50",cy:"50",r:"45",fill:"none",stroke:"#fff",strokeWidth:"2",strokeDasharray:"283",strokeDashoffset:"283",strokeLinecap:"round"})]}),e.jsx("div",{className:"text-center z-10",children:e.jsx("span",{className:"trust-score-counter text-3xl font-display font-bold text-white",children:"0"})})]}),e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wider font-bold",children:"Trust Score"})]}),e.jsxs("div",{className:"p-4 bg-white/5 border border-white/10 rounded flex items-center gap-3",children:[e.jsx(je,{className:"text-blue-400",size:20}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wider",children:"Major"}),e.jsx("p",{className:"text-white",children:"Computer Engineering"})]})]})]})]})})]}),e.jsxs("div",{className:"mt-8 border-t border-white/10 pt-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-6",children:"Recent Activity"}),e.jsx("div",{className:"p-12 text-center border border-dashed border-white/10 rounded-lg text-gray-500",children:"No recent trades or services."})]})]}),l&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center px-4",children:[e.jsx("div",{className:"absolute inset-0 bg-transparent",onClick:()=>c(!1)}),e.jsxs("div",{className:"relative bg-black border border-white/10 p-6 rounded-xl w-full max-w-sm shadow-2xl animate-fade-in",children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"Sign Out"}),e.jsx("p",{className:"text-gray-400 mb-6",children:"Are you sure you want to sign out of your account?"}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>c(!1),className:"px-4 py-2 text-sm font-medium text-gray-300 hover:text-white transition-all border border-transparent hover:border-white hover:shadow-[0_0_15px_rgba(255,255,255,0.2)] rounded",children:"Cancel"}),e.jsx("button",{onClick:S,className:"px-4 py-2 text-sm font-bold bg-red-600 hover:bg-red-500 text-white rounded transition-all shadow-lg hover:shadow-[0_0_20px_rgba(220,38,38,0.6)]",children:"Sign Out"})]})]})]})]})},Tt=()=>e.jsxs("div",{className:"min-h-screen bg-background flex flex-col justify-center items-center",children:[e.jsx(J,{className:"w-20 h-20 mb-8 opacity-50"}),e.jsx("h1",{className:"text-2xl font-display font-bold text-white tracking-widest",children:"SETTINGS"}),e.jsx("p",{className:"text-gray-500 mt-2",children:"Nothing to see here yet."})]}),Rt=()=>e.jsxs("div",{className:"min-h-screen bg-background flex flex-col justify-center items-center",children:[e.jsx(J,{className:"w-16 h-16 mb-8"}),e.jsxs("h1",{className:"text-3xl font-display font-bold text-white tracking-widest uppercase text-center max-w-lg leading-relaxed",children:["Payment Gateway ",e.jsx("br",{})," Integration Pending"]}),e.jsx("p",{className:"text-gray-500 mt-4 text-sm",children:"This is a secure checkout placeholder."})]}),It=()=>{const{id:t}=Ke(),i=F(),{addToCart:l}=ct(),{user:c}=U(),{openAuthModal:s}=W(),n=ae.find(b=>b.id===parseInt(t)),[u,g]=r.useState(0),d=()=>{if(!c){s();return}i("/payment")},w=()=>{if(!c){s();return}l(n)};return n?e.jsx("div",{className:"min-h-screen bg-background pt-24 pb-20 px-6 md:px-12",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("button",{onClick:()=>i(-1),className:"flex items-center gap-2 text-gray-400 hover:text-white mb-8 transition-colors",children:[e.jsx(ve,{size:20})," Back to Market"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-12",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"aspect-[4/3] bg-surface border border-white/10 rounded-lg overflow-hidden relative",children:n.images&&n.images.length>0?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:n.images[u],alt:n.title,className:"w-full h-full object-cover",onError:b=>{b.currentTarget.style.display="none";const m=b.currentTarget.parentElement.querySelector(".fallback-placeholder");m&&m.classList.remove("hidden"),m&&m.classList.add("flex")}}),e.jsxs("div",{className:"fallback-placeholder hidden absolute inset-0 bg-zinc-900 flex-col items-center justify-center gap-4",children:[e.jsx("div",{className:"w-24 h-24 rounded-full bg-white/5 flex items-center justify-center border border-white/10",children:e.jsx("span",{className:"font-display font-bold text-5xl text-white",children:"C"})}),e.jsx("p",{className:"text-gray-400 font-bold uppercase tracking-widest text-xs",children:"Seller did not upload an image"})]})]}):e.jsxs("div",{className:"absolute inset-0 bg-zinc-900 flex flex-col items-center justify-center gap-4",children:[e.jsx("div",{className:"w-24 h-24 rounded-full bg-white/5 flex items-center justify-center border border-white/10",children:e.jsx("span",{className:"font-display font-bold text-5xl text-white",children:"C"})}),e.jsx("p",{className:"text-gray-400 font-bold uppercase tracking-widest text-xs",children:"Seller did not upload an image"})]})}),n.images&&n.images.length>1&&e.jsx("div",{className:"flex gap-4 overflow-x-auto pb-2",children:n.images.map((b,m)=>e.jsx("button",{onClick:()=>g(m),className:`w-24 h-24 shrink-0 rounded-lg overflow-hidden border-2 transition-all ${u===m?"border-accent":"border-transparent opacity-50 hover:opacity-100"}`,children:e.jsx("img",{src:b,alt:"",className:"w-full h-full object-cover"})},m))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("span",{className:"text-accent font-bold uppercase tracking-wider text-sm",children:n.category}),e.jsxs("div",{className:"flex items-center gap-1 text-yellow-500",children:[e.jsx(ce,{size:16,fill:"currentColor"}),e.jsx("span",{className:"text-white font-bold",children:n.trustScore})]})]}),e.jsx("h1",{className:"text-4xl md:text-5xl font-display font-bold text-white mb-4",children:n.title}),e.jsx("p",{className:"text-3xl text-white font-light mb-8",children:n.price}),e.jsxs("div",{className:"bg-surface border border-white/5 p-6 rounded-lg mb-8",children:[e.jsx("p",{className:"text-gray-300 leading-relaxed mb-4",children:n.description||"No description provided."}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Sold by ",e.jsxs("span",{className:"text-white font-bold",children:["@",n.seller]})]})]}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs(L,{onClick:d,variant:"primary",fullWidth:!0,className:"flex items-center justify-center gap-2",children:[e.jsx(Xe,{size:18})," Buy Now"]}),e.jsxs(L,{onClick:w,variant:"outline",fullWidth:!0,className:"flex items-center justify-center gap-2",children:[e.jsx(Je,{size:18})," Add to Cart"]})]})]})]})]})}):e.jsx("div",{className:"text-white pt-32 text-center",children:"Product not found"})},pe="7.9.0",$t=[{title:"OTP Verification Fix",description:"Fixed critical email verification error that prevented users from completing signup."},{title:"Enhanced Error Handling",description:"Added detailed debug logging and better error messages for troubleshooting verification issues."},{title:"Chat Crash Fix",description:"Resolved ChatWidget crash that occurred when non-logged-in users tried to open chat."},{title:"Vercel Deployment",description:"Migrated to Vercel for faster builds, better performance, and preview deployments."},{title:"Publishing Workflow Update",description:"Added changelog documentation to publishing process for better release tracking."},{title:"Lighter & Faster",description:"Removed heavy 3D rendering. The app now loads faster and uses less resources."},{title:"Mobile Text Fix",description:"Loading screen text now wraps properly on smaller screens."},{title:"End-to-End Encrypted Chat",description:"Your messages are encrypted client-side. Only you and your friend can read them."},{title:"Storage Optimization",description:"Removing a friend clears chat history to save database space."},{title:"Mobile Bottom Bar",description:"New 5-icon navigation bar: Services, Market, Home, Chat, and Profile."}],At=()=>{const[t,i]=r.useState(!1),[l,c]=r.useState(!1),[s,n]=r.useState(!1),u=H();r.useEffect(()=>{const d=()=>n(window.innerWidth<768);return d(),window.addEventListener("resize",d),()=>window.removeEventListener("resize",d)},[]),r.useEffect(()=>{const d=u.pathname==="/"||u.pathname==="/campusnodes/"||u.pathname==="/CampusNodes/";i(!!d)},[u]);const g=()=>{i(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(X,{children:t&&e.jsx(I.div,{initial:{y:-50,x:"-50%",opacity:0},animate:{y:0,x:"-50%",opacity:1},exit:{y:-50,x:"-50%",opacity:0},className:"fixed top-6 left-1/2 -translate-x-1/2 w-[95%] md:w-auto min-w-[320px] md:min-w-[500px] z-[40] group",children:e.jsx("div",{className:"relative overflow-hidden rounded-full bg-black/80 backdrop-blur-md border border-blue-500/30 shadow-[0_0_15px_rgba(59,130,246,0.1)] transition-all duration-300 hover:shadow-[0_0_25px_rgba(59,130,246,0.4)] hover:border-blue-500/50",children:e.jsxs("div",{className:"px-4 py-2 flex items-center justify-between gap-4 text-xs md:text-sm",children:[e.jsxs("div",{className:"flex items-center gap-3 text-white shrink-0",children:[e.jsx("span",{className:"bg-blue-600 text-white font-bold px-2 py-0.5 rounded text-[10px] uppercase tracking-wider shadow-[0_0_10px_rgba(37,99,235,0.4)]",children:"New"}),e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx(te,{size:12,className:"text-blue-400 animate-pulse"}),e.jsx("span",{className:"text-gray-200",children:"Updated to"}),e.jsx("span",{className:"font-bold font-mono text-blue-400",children:pe})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I.button,{onClick:()=>c(!0),initial:"idle",whileHover:"hover",animate:"idle",className:"relative flex items-center justify-center h-8 rounded-full transition-all duration-300 border border-transparent",children:e.jsxs(I.div,{variants:{idle:{width:"auto",paddingLeft:0,paddingRight:0,backgroundColor:"rgba(59, 130, 246, 0)"},hover:s?{width:"auto",paddingLeft:0,paddingRight:0,backgroundColor:"rgba(59, 130, 246, 0)"}:{width:"auto",paddingLeft:"12px",paddingRight:"12px",backgroundColor:"rgba(37, 99, 235, 1)"}},className:"flex items-center gap-2 overflow-hidden h-full rounded-full",children:[e.jsx("span",{className:"flex items-center justify-center w-8 h-8 rounded-full shrink-0 bg-blue-500/0 hover:bg-blue-500 hover:shadow-[0_0_15px_rgba(59,130,246,0.6)] transition-all duration-300 group/btn",children:e.jsx(Ze,{size:14,className:"text-blue-400 group-hover/btn:text-white transition-colors"})}),!s&&e.jsx(I.span,{variants:{idle:{width:0,opacity:0,display:"none"},hover:{width:"auto",opacity:1,display:"block"}},transition:{duration:.2},className:"whitespace-nowrap font-medium text-white",children:"Patch Notes"})]})}),e.jsx(I.button,{onClick:g,initial:"idle",whileHover:"hover",animate:"idle",className:"relative flex items-center justify-center h-8 rounded-full transition-all duration-300 border border-transparent",children:e.jsxs(I.div,{variants:{idle:{width:"auto",paddingLeft:0,paddingRight:0,backgroundColor:"rgba(239, 68, 68, 0)"},hover:s?{width:"auto",paddingLeft:0,paddingRight:0,backgroundColor:"rgba(239, 68, 68, 0)"}:{width:"auto",paddingLeft:"12px",paddingRight:"12px",backgroundColor:"rgba(220, 38, 38, 1)"}},className:"flex items-center gap-2 overflow-hidden h-full rounded-full",children:[e.jsx("span",{className:"flex items-center justify-center w-8 h-8 rounded-full shrink-0 bg-red-500/0 hover:bg-red-500 hover:shadow-[0_0_15px_rgba(239,68,68,0.6)] transition-all duration-300 group/btn",children:e.jsx(D,{size:14,className:"text-red-400 group-hover/btn:text-white transition-colors"})}),!s&&e.jsx(I.span,{variants:{idle:{width:0,opacity:0,display:"none"},hover:{width:"auto",opacity:1,display:"block"}},transition:{duration:.2},className:"whitespace-nowrap font-medium text-white",children:"Close"})]})})]})]})})})}),e.jsx(X,{children:l&&e.jsxs("div",{className:"fixed inset-0 z-[110] flex items-center justify-center p-4",children:[e.jsx(I.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>c(!1),className:"absolute inset-0 bg-black/80"}),e.jsxs(I.div,{initial:{scale:.9,opacity:0,y:20},animate:{scale:1,opacity:1,y:0},exit:{scale:.9,opacity:0,y:20},className:"relative bg-[#0f1115] border border-blue-500/20 w-full max-w-lg rounded-2xl shadow-[0_0_50px_rgba(59,130,246,0.15)] overflow-hidden flex flex-col max-h-[70vh]",children:[e.jsxs("div",{className:"p-6 border-b border-white/5 bg-gradient-to-r from-blue-900/20 to-transparent flex items-center justify-between shrink-0",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:[e.jsx(te,{className:"text-blue-400",size:20}),"Patch Notes"]}),e.jsxs("p",{className:"text-blue-400/60 text-xs font-mono mt-1",children:["Version ",pe]})]}),e.jsx("button",{onClick:()=>c(!1),className:"p-2 hover:bg-white/10 rounded-full transition-colors text-gray-400 hover:text-white",children:e.jsx(D,{size:20})})]}),e.jsx("div",{className:"p-6 overflow-y-auto custom-scrollbar",children:e.jsx("div",{className:"space-y-6",children:$t.map((d,w)=>e.jsxs("div",{className:"group",children:[e.jsxs("h3",{className:"text-white font-medium mb-1 group-hover:text-blue-400 transition-colors flex items-center gap-2",children:[e.jsx(ie,{size:14,className:"text-blue-500/50 group-hover:text-blue-500 transition-colors"}),d.title]}),e.jsx("p",{className:"text-gray-400 text-sm leading-relaxed pl-6",children:d.description})]},w))})}),e.jsx("div",{className:"p-4 border-t border-white/5 bg-black/20 shrink-0 text-center",children:e.jsx("p",{className:"text-xs text-gray-500",children:"Thank you for being part of our beta."})})]})]})})]})},Lt=()=>{const{isAuthModalOpen:t,closeAuthModal:i}=W(),l=F(),c=s=>{i(),l(s)};return e.jsx(X,{children:t&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center px-4",children:[e.jsx(I.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:i,className:"absolute inset-0 bg-transparent"}),e.jsxs(I.div,{initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},className:"relative bg-black border border-white/10 p-8 rounded-2xl w-full max-w-sm shadow-2xl z-10",children:[e.jsx("button",{onClick:i,className:"absolute top-4 right-4 text-gray-500 hover:text-white transition-colors",children:e.jsx(D,{size:20})}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h2",{className:"text-2xl font-display font-bold text-white mb-2",children:"Join Campus Nodes"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Connect, trade, and collaborate with your campus community."})]}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("button",{onClick:()=>c("/signup"),className:"w-full py-3 bg-white text-black font-bold uppercase tracking-wider rounded flex items-center justify-center gap-2 transition-all shadow-[0_0_15px_rgba(255,255,255,0.3)] hover:shadow-[0_0_25px_rgba(255,255,255,0.5)] hover:scale-[1.02]",children:[e.jsx(Qe,{size:18}),"Sign Up"]}),e.jsxs("button",{onClick:()=>c("/login"),className:"w-full py-3 border border-white/10 hover:border-white text-white font-medium uppercase tracking-wider rounded flex items-center justify-center gap-2 transition-all hover:shadow-[0_0_15px_rgba(255,255,255,0.2)] hover:scale-[1.02]",children:[e.jsx(et,{size:18}),"Sign In"]})]})]})]})})},Dt=()=>{const{user:t}=U(),{isChatOpen:i,openChat:l,closeChat:c,addUnreadSender:s,removeUnreadSender:n,unreadSenders:u,openAuthModal:g}=W(),[d,w]=r.useState(null),[b,m]=r.useState([]),[E,v]=r.useState([]),[x,p]=r.useState(""),[S,C]=r.useState(!1),N=r.useRef(null),z=()=>{N.current?.scrollIntoView({behavior:"smooth"})};r.useEffect(()=>{if(!t)return;const f=_.channel("global_chat_listener").on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:`receiver_id=eq.${t.id}`},a=>{(!i||d&&d.id!==a.new.sender_id||!d)&&s(a.new.sender_id)}).subscribe();return()=>{_.removeChannel(f)}},[t,i,d]),r.useEffect(()=>{d&&n(d.id)},[d]),r.useEffect(()=>{i&&t&&o()},[i,t]),r.useEffect(()=>{if(d){h(d.id);const f=_.channel(`chat:${d.id}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:`sender_id=eq.${d.id}`},a=>{if(a.new.receiver_id===t.id){const j=B(a.new.content,a.new.sender_id,a.new.receiver_id),M={...a.new,content:j};v(R=>[...R,M]),z()}}).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:`sender_id=eq.${t.id}`},a=>{if(a.new.receiver_id===d.id){const j=B(a.new.content,a.new.sender_id,a.new.receiver_id),M={...a.new,content:j};v(R=>R.find(T=>T.id===a.new.id)?R:[...R,M]),z()}}).subscribe();return()=>{_.removeChannel(f)}}},[d,t]);const o=async()=>{try{const{data:f,error:a}=await _.from("friendships").select("*").or(`user1_id.eq.${t.id},user2_id.eq.${t.id}`).eq("status","accepted");if(a)throw a;const j=f.map(R=>R.user1_id===t.id?R.user2_id:R.user1_id);if(j.length===0){m([]);return}const{data:M}=await _.from("profiles").select("*").in("id",j);m(M||[])}catch(f){console.error(f)}},h=async f=>{try{C(!0);const a=new Date(Date.now()-1440*60*1e3).toISOString(),{data:j,error:M}=await _.from("messages").select("*").or(`and(sender_id.eq.${t.id},receiver_id.eq.${f}),and(sender_id.eq.${f},receiver_id.eq.${t.id})`).gt("created_at",a).order("created_at",{ascending:!0}).limit(100);if(M)throw M;const R=j.filter(T=>!(T.sender_id===t.id&&T.deleted_by_sender||T.receiver_id===t.id&&T.deleted_by_receiver)).map(T=>({...T,content:B(T.content,T.sender_id,T.receiver_id)}));v(R||[]),setTimeout(z,100)}catch(a){console.error(a)}finally{C(!1)}},k=async()=>{if(!(!d||!confirm("Clear chat history? This cannot be undone.")))try{await _.from("messages").update({deleted_by_sender:!0}).eq("sender_id",t.id).eq("receiver_id",d.id),await _.from("messages").update({deleted_by_receiver:!0}).eq("receiver_id",t.id).eq("sender_id",d.id),v([])}catch(f){console.error("Failed to clear chat",f)}},y=async f=>{if(f.preventDefault(),!x.trim()||!d)return;const a=x.trim();p("");const j={id:Date.now(),sender_id:t.id,receiver_id:d.id,content:a,created_at:new Date().toISOString(),is_temp:!0};v(M=>[...M,j]),z();try{const M=ze(a,t.id,d.id),{error:R,data:T}=await _.from("messages").insert({sender_id:t.id,receiver_id:d.id,content:M}).select();if(R)throw R;const O=T[0],Y={...O,content:B(O.content,O.sender_id,O.receiver_id)};v(Q=>Q.map(G=>G.id===j.id?Y:G))}catch(M){console.error("Failed to send",M)}};return e.jsx(e.Fragment,{children:e.jsx(X,{children:i&&e.jsxs(I.div,{initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},transition:{type:"spring",stiffness:300,damping:30},className:`fixed z-[60] bg-black border-b border-white/20 shadow-2xl overflow-hidden\r
                                   inset-x-0 top-0 bottom-24 md:z-[9999] md:border md:inset-auto md:bottom-6 md:right-6 md:w-96 md:h-[500px] md:rounded-2xl flex flex-col`,children:[e.jsxs("div",{className:"h-16 bg-black/50 backdrop-blur-md border-b border-white/10 flex items-center justify-between px-4 shrink-0",children:[e.jsx("div",{className:"flex items-center gap-3",children:d?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>w(null),className:"md:hidden p-1 hover:bg-white/10 rounded-full",children:e.jsx(K,{size:24})}),e.jsx("button",{onClick:()=>w(null),className:"hidden md:block p-1 hover:bg-white/10 rounded-full mr-1",children:e.jsx(K,{size:18})}),e.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-700 overflow-hidden border border-white/20",children:d.avatar_url?e.jsx("img",{src:d.avatar_url,alt:"",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-xs",children:d.first_name?.[0]})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-white text-sm",children:[d.first_name," ",d.last_name]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500 animate-pulse"}),e.jsx("span",{className:"text-[10px] text-gray-400",children:"Online"})]})]})]}):e.jsxs("h3",{className:"font-bold text-white text-lg flex items-center gap-2",children:[e.jsx(oe,{size:20,className:"text-accent"}),"Messages ",e.jsx(ye,{size:12,className:"text-green-500/50 ml-1",title:"End-to-End Encrypted"})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[d&&e.jsx("button",{onClick:k,className:"p-2 hover:bg-white/10 rounded-full text-gray-400 hover:text-red-500 transition-colors",title:"Clear Chat",children:e.jsx(de,{size:18})}),e.jsx("button",{onClick:c,className:"hidden md:block p-2 hover:bg-white/10 rounded-full text-gray-400 hover:text-white",children:e.jsx(D,{size:20})})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto bg-zinc-900/50 relative",children:[d&&e.jsx("div",{className:"sticky top-4 z-10 flex justify-center w-full pointer-events-none mb-2",children:e.jsxs("div",{className:"bg-black/60 backdrop-blur-md border border-white/10 px-3 py-1 rounded-full flex items-center gap-1.5 shadow-xl",children:[e.jsx(tt,{size:12,className:"text-accent"}),e.jsx("span",{className:"text-[10px] text-white font-medium",children:"1-Day Disappearing Messages"})]})}),d?e.jsxs("div",{className:"p-4 space-y-4 min-h-full flex flex-col justify-end",children:[E.map((f,a)=>e.jsx("div",{className:`flex ${f.sender_id===t.id?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[75%] px-4 py-2 rounded-2xl text-sm ${f.sender_id===t.id?"bg-accent text-black rounded-tr-sm":"bg-white/10 text-white rounded-tl-sm border border-white/10"}`,children:[e.jsx("p",{children:f.content}),e.jsx("span",{className:`text-[9px] block mt-1 opacity-50 ${f.sender_id===t.id?"text-black":"text-gray-400"}`,children:new Date(f.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})},f.id||a)),e.jsx("div",{ref:N})]}):e.jsx("div",{className:"p-4 space-y-2",children:b.length===0?e.jsxs("div",{className:"text-center text-gray-500 mt-10",children:[e.jsx("p",{children:"No friends yet."}),e.jsx("p",{className:"text-xs",children:"Connect with people to chat!"})]}):b.map(f=>e.jsxs("button",{onClick:()=>w(f),className:"w-full p-3 rounded-lg hover:bg-white/5 flex items-center gap-3 transition-colors text-left group border border-transparent hover:border-white/10 relative",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-700 overflow-hidden border border-white/10 group-hover:border-accent/50 transition-colors",children:f.avatar_url?e.jsx("img",{src:f.avatar_url,alt:"",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-400",children:e.jsx(ee,{size:20})})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h4",{className:"font-bold text-white text-sm",children:[f.first_name," ",f.last_name]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Click to chat"})]}),u.has(f.id)&&e.jsx("div",{className:"w-3 h-3 bg-accent rounded-full animate-pulse shadow-[0_0_10px_rgba(34,211,238,0.5)]"})]},f.id))})]}),d&&e.jsxs("form",{onSubmit:y,className:"p-3 bg-black/50 border-t border-white/10 shrink-0 flex gap-2",children:[e.jsx("input",{type:"text",value:x,onChange:f=>p(f.target.value),placeholder:"Type a message...",className:"flex-1 bg-white/5 border border-white/10 rounded-full px-4 py-2 text-sm text-white focus:outline-none focus:border-accent/50 transition-colors"}),e.jsx("button",{type:"submit",disabled:!x.trim(),className:"w-9 h-9 bg-accent text-black rounded-full flex items-center justify-center hover:scale-105 active:scale-95 disabled:opacity-50 disabled:hover:scale-100 transition-all font-bold",children:e.jsx(Ne,{size:16,className:x.trim()?"ml-0.5":""})})]})]})})})},Ot=()=>{const{pathname:t}=H();return r.useEffect(()=>{window.scrollTo(0,0)},[t]),null},qt=()=>{const t=H(),i=t.pathname==="/"||t.pathname==="/campusnodes/"||t.pathname==="/CampusNodes/";return e.jsx("div",{className:`fixed inset-0 z-0 transition-opacity duration-1000 ${i?"opacity-100 pointer-events-auto":"opacity-10 pointer-events-none"}`,children:e.jsx(Se,{})})},Ft=({children:t})=>{const i=H(),{isSidebarCollapsed:l}=W(),c=i.pathname==="/"||i.pathname==="/campusnodes/"||i.pathname==="/CampusNodes/";return e.jsx("div",{className:`min-h-screen text-white font-sans selection:bg-accent selection:text-white cursor-none relative z-10 transition-all duration-300 ${c?"bg-transparent":"bg-background"} ${l?"md:pl-0":"md:pl-[260px]"}`,children:t})},Ut=()=>e.jsx(lt,{children:e.jsx(ot,{children:e.jsx(dt,{children:e.jsxs(st,{children:[e.jsx(mt,{}),e.jsx(Ot,{}),e.jsx(At,{}),e.jsx(qt,{}),e.jsx(ht,{}),e.jsx(Ft,{children:e.jsxs(rt,{children:[e.jsx($,{path:"/",element:e.jsx(pt,{})}),e.jsx($,{path:"/market",element:e.jsx(gt,{})}),e.jsx($,{path:"/services",element:e.jsx(jt,{})}),e.jsx($,{path:"/connections",element:e.jsx(wt,{})}),e.jsx($,{path:"/login",element:e.jsx(Nt,{})}),e.jsx($,{path:"/signup",element:e.jsx(Mt,{})}),e.jsx($,{path:"/profile",element:e.jsx(Pt,{})}),e.jsx($,{path:"/messages",element:e.jsx(yt,{})}),e.jsx($,{path:"/settings",element:e.jsx(Tt,{})}),e.jsx($,{path:"/payment",element:e.jsx(Rt,{})}),e.jsx($,{path:"/market/:id",element:e.jsx(It,{})})]})}),e.jsx(Lt,{}),e.jsx(Dt,{}),e.jsx(ut,{})]})})})});class Wt extends ne.Component{constructor(i){super(i),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(i){return{hasError:!0,error:i}}componentDidCatch(i,l){console.error("Uncaught error:",i,l),this.setState({errorInfo:l})}render(){return this.state.hasError?e.jsxs("div",{className:"min-h-screen bg-black text-red-500 p-8 font-mono overflow-auto",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Something went wrong."}),e.jsxs("div",{className:"bg-gray-900 p-4 rounded border border-red-900",children:[e.jsx("h2",{className:"font-bold text-white",children:"Error Message:"}),e.jsx("pre",{className:"whitespace-pre-wrap",children:this.state.error&&this.state.error.toString()}),e.jsx("br",{}),e.jsx("h2",{className:"font-bold text-white",children:"Stack Trace:"}),e.jsx("pre",{className:"text-xs text-gray-400 whitespace-pre-wrap",children:this.state.errorInfo&&this.state.errorInfo.componentStack})]})]}):this.props.children}}at.createRoot(document.getElementById("root")).render(e.jsx(ne.StrictMode,{children:e.jsx(Wt,{children:e.jsx(Ut,{})})}));
